<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>Technical guide - WGTWO API v0 docs</title><meta name="gridsome:hash" content="b889a309e94abe6e5f2f6e74fea6e8b449df82e7"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.23"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/svg+xml" sizes="16x16" href="/assets/static/favicon.ce0531f.eedfceace0fdf708b118964642b27e62.svg"><link data-vue-tag="ssr" rel="icon" type="image/svg+xml" sizes="32x32" href="/assets/static/favicon.ac8d93a.eedfceace0fdf708b118964642b27e62.svg"><link data-vue-tag="ssr" rel="icon" type="image/svg+xml" sizes="96x96" href="/assets/static/favicon.b9532cc.eedfceace0fdf708b118964642b27e62.svg"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/svg+xml" sizes="76x76" href="/assets/static/favicon.f22e9f3.eedfceace0fdf708b118964642b27e62.svg"><link data-vue-tag="ssr" rel="stylesheet" href="https://cdn.materialdesignicons.com/5.4.55/css/materialdesignicons.min.css"><link data-vue-tag="ssr" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swagger-ui-dist@3.25.0/swagger-ui.css"><link rel="preload" href="/assets/css/0.styles.50f0e2fa.css" as="style"><link rel="preload" href="/assets/js/app.2b855c93.js" as="script"><link rel="preload" href="/assets/js/page--src--templates--doc-page-vue.6382a886.js" as="script"><link rel="preload" href="/assets/js/vue-remark--docs--number-lookup-how-to-md.73775d6b.js" as="script"><link rel="prefetch" href="/assets/js/page--node-modules--gridsome--app--pages--404-vue.386217dd.js"><link rel="prefetch" href="/assets/js/page--src--pages--index-vue.40f57a10.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--call-forwarding-api-reference-md.f08db191.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--call-forwarding-md.bf9609d6.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--events-api-reference-md.72881bd2.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--events-configuration-md.7e4afa3a.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--events-how-to-md.8c18b49e.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--intro-client-and-languages-md.31b4f824.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--intro-get-started-md.fa9d82e6.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--intro-sandbox-md.581c1dcd.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--metrics-how-to-md.4f681ea0.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--mms-api-reference-md.abb08409.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--mms-send-how-to-md.04d0bd1e.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--number-lookup-api-reference-md.b164edca.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--number-lookup-overview-md.87eb4ca5.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--oauth-2-create-client-how-to-md.f2c4c47c.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--oauth-2-get-client-access-token-md.aade293d.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--oauth-2-get-user-access-token-md.b7729045.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--oauth-2-overview-md.96835c86.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--oauth-2-subscriber-deauthorization-md.bc26bc4d.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--oauth-2-why-support-user-revoking-consent-md.2bf964ec.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--provision-api-reference-2-md.00aee472.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--provision-how-to-md.824f394e.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--provision-overview-md.ea8d36ca.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--provision-service-list-md.f1998732.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--sipbreakout-how-to-md.dad2c5f0.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--subscriber-location-how-to-md.3d3f1a63.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--subscriber-location-reference-md.399256d4.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--voicemail-api-reference-md.60bcbc99.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--voicemail-how-to-md.0438421f.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--webterminal-api-reference-md.c37c2e04.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--webterminal-how-to-md.0c086e30.js"><link rel="stylesheet" href="/assets/css/0.styles.50f0e2fa.css"><script data-vue-tag="ssr" src="https://cdn.jsdelivr.net/npm/swagger-ui-dist@3.25.0/swagger-ui-bundle.js"></script><script data-vue-tag="ssr" src="https://cdn.jsdelivr.net/npm/swagger-ui-dist@3.25.0/swagger-ui-standalone-preset.js"></script><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
  </head>
  <body >
    <div data-server-rendered="true" id="app" data-v-39f0b824 data-v-35cf879f><nav role="navigation" aria-label="main navigation" class="navbar topnav" data-v-c0e19ce6 data-v-39f0b824><div class="navbar-brand"><a href="/" exact="" to="/" class="navbar-item" data-v-c0e19ce6><svg id="logo_svg__aa853218-2cb3-4a2f-8b42-cf04e6fdcfc6" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 156.46 34.11" class="topnav__logo" data-v-c0e19ce6><defs><linearGradient id="logo_svg__ed710ca4-f54a-45c1-8930-1f1a79c7c165" x1="202.25" y1="417.5" x2="257.57" y2="417.5" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#009da5"></stop><stop offset="1" stop-color="#2a4292"></stop></linearGradient><linearGradient id="logo_svg__f5345778-3256-407e-a6a4-6478c034349f" x1="229.91" y1="426.57" x2="229.91" y2="426.57" xlink:href="#logo_svg__ed710ca4-f54a-45c1-8930-1f1a79c7c165"></linearGradient><style>.logo_svg__adfa6594-0c46-4152-b161-b53ae93774c2{fill:#221f20}</style></defs><path d="M257.25 401.71a2.42 2.42 0 00-2.1-1.22h-16.84a2.41 2.41 0 00-2.09 1.21l-14.77 25.57-12.59-22h11.24l5.27 9.22 2.89-4.71-4.65-8.13a2.43 2.43 0 00-2.11-1.22h-16.82a2.43 2.43 0 00-2.11 3.63l16.77 29.26a2.43 2.43 0 002.1 1.22 2.41 2.41 0 002.09-1.21l16.17-28H251l-12.68 21.93-3.93-6.86-2.89 4.71 4.7 8.21a2.44 2.44 0 002.1 1.22 2.41 2.41 0 002.09-1.21l16.9-29.21a2.43 2.43 0 00-.04-2.41z" transform="translate(-202.25 -400.44)" fill="url(#logo_svg__ed710ca4-f54a-45c1-8930-1f1a79c7c165)"></path><path d="M268.15 411.4l.38-.52h2.84l2.63 12.27h.29l3.1-12.27h3.92l3.1 12.27h.29l2.58-12.27h2.84l.38.52-3.25 14.71h-5.13l-2.78-11.43-2.76 11.43h-5.18zM293 421.53v-6.06q0-4.59 4.59-4.59h8.35v16.45q0 4.57-4.58 4.58h-5.57l-1.51-1.13V429h6.93a1.18 1.18 0 001.34-1.33v-1.51h-5q-4.55-.05-4.55-4.63zm3.4.29a1.17 1.17 0 001.33 1.33h4.82v-9.34h-4.85a1.19 1.19 0 00-1.33 1.36zM310.06 421.53V406.1h3.39v4.78h5.16v2.93h-5.16v8a1.17 1.17 0 001.33 1.33h4.12V425l-1.51 1.13h-2.75c-3.06-.02-4.58-1.55-4.58-4.6zM320.61 411.4l.38-.52h2.84l2.58 12.27h.29l3.1-12.27h3.92l3.1 12.27h.29l2.58-12.27h2.84l.38.52-3.25 14.71h-5.13l-2.78-11.43-2.75 11.43h-5.13zM345.52 421.53v-6.06q0-4.59 4.58-4.59h4.06q4.56 0 4.56 4.59v6.06q0 4.58-4.56 4.58h-4.06q-4.57 0-4.58-4.58zm3.39.29a1.18 1.18 0 001.34 1.33H354a1.19 1.19 0 001.36-1.33v-6.65a1.2 1.2 0 00-1.36-1.36h-3.74a1.2 1.2 0 00-1.34 1.36z" transform="translate(-202.25 -400.44)" class="logo_svg__adfa6594-0c46-4152-b161-b53ae93774c2"></path></svg></a></div><div class="navbar-menu"><div class="navbar-start"></div><div class="navbar-end"><div class="navbar-item has-dropdown" data-v-39f0b824><a aria-haspopup="true" tabindex="0" class="navbar-link">v0</a><div class="navbar-dropdown"><a href="https://v1.docs.wgtwo.com/" class="navbar-item" data-v-39f0b824>v1</a></div></div><!----><div class="role-selection-container"><button type="button" class="button button is-role role-selection-button"><!----><span><span>Viewing docs</span><span class="icon"><i class="mdi mdi-chevron-down mdi-24px"></i></span></span><!----></button></div></div></div></nav><main class="main" data-v-39f0b824><nav class="docsnav-container is-hidden-touch" data-v-39f0b824><div class="docsnav" data-v-39f0b824><div class="docs-nav__container" data-v-39f0b824 data-v-35cf879f><h3 class="is-uppercase" data-v-39f0b824 data-v-35cf879f>
        intro
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-35cf879f><li data-v-35cf879f><a href="/intro/get-started/" class="dosc_nav__anchor" data-v-35cf879f>Get started</a></li><li data-v-35cf879f><a href="/intro/api-structure-and-libraries/" class="dosc_nav__anchor" data-v-35cf879f>API structure and libraries</a></li><li data-v-35cf879f><a href="/intro/sandbox-environment/" class="dosc_nav__anchor" data-v-35cf879f>Sandbox Environment</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-35cf879f><h3 class="is-uppercase" data-v-39f0b824 data-v-35cf879f>
        oauth 2.0
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-35cf879f><li data-v-35cf879f><a href="/oauth-2-0/overview/" class="dosc_nav__anchor" data-v-35cf879f>Overview</a></li><li data-v-35cf879f><a href="/oauth-2-0/create-o-auth-2-0-client/" class="dosc_nav__anchor" data-v-35cf879f>Create OAuth 2.0 client</a></li><li data-v-35cf879f><a href="/oauth-2-0/get-user-access-token/" class="dosc_nav__anchor" data-v-35cf879f>Get user access token</a></li><li data-v-35cf879f><a href="/oauth-2-0/get-client-access-token/" class="dosc_nav__anchor" data-v-35cf879f>Get client access token</a></li><li data-v-35cf879f><a href="/oauth-2-0/support-revoking-consent/" class="dosc_nav__anchor" data-v-35cf879f>Support revoking consent</a></li><li data-v-35cf879f><a href="/oauth-2-0/why-support-user-revoking-of-consent/" class="dosc_nav__anchor" data-v-35cf879f>Why support user revoking of consent</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-35cf879f><h3 class="is-uppercase" data-v-39f0b824 data-v-35cf879f>
        mms
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-35cf879f><li data-v-35cf879f><a href="/mms/send-mms/" class="dosc_nav__anchor" data-v-35cf879f>Send MMS</a></li><li data-v-35cf879f><a href="/mms/mms-api-reference/" class="dosc_nav__anchor" data-v-35cf879f>MMS API reference</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-35cf879f><h3 class="is-uppercase" data-v-39f0b824 data-v-35cf879f>
        events
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-35cf879f><li data-v-35cf879f><a href="/events/listen-for-events/" class="dosc_nav__anchor" data-v-35cf879f>Listen for events</a></li><li data-v-35cf879f><a href="/events/configuration-and-types/" class="dosc_nav__anchor" data-v-35cf879f>Configuration and types</a></li><li data-v-35cf879f><a href="/events/events-api-reference/" class="dosc_nav__anchor" data-v-35cf879f>Events API reference</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-35cf879f><h3 class="is-uppercase" data-v-39f0b824 data-v-35cf879f>
        voicemail
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-35cf879f><li data-v-35cf879f><a href="/voicemail/list-play-delete-and-configure-voicemails/" class="dosc_nav__anchor" data-v-35cf879f>List, play, delete and configure voicemails</a></li><li data-v-35cf879f><a href="/voicemail/voicemail-api-reference/" class="dosc_nav__anchor" data-v-35cf879f>Voicemail API reference</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-35cf879f><h3 class="is-uppercase" data-v-39f0b824 data-v-35cf879f>
        subscription profile
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-35cf879f><li data-v-35cf879f><a href="/subscription-profile/overview/" class="dosc_nav__anchor" data-v-35cf879f>Overview</a></li><li data-v-35cf879f><a href="/subscription-profile/manage-subscriptions/" class="dosc_nav__anchor" data-v-35cf879f>Manage subscriptions</a></li><li data-v-35cf879f><a href="/subscription-profile/subscription-profile-api-reference/" class="dosc_nav__anchor" data-v-35cf879f>Subscription profile API reference</a></li><li data-v-35cf879f><a href="/subscription-profile/subscription-services/" class="dosc_nav__anchor" data-v-35cf879f>Subscription services</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-35cf879f><h3 class="is-uppercase" data-v-39f0b824 data-v-35cf879f>
        network information
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-35cf879f><li data-v-35cf879f><a href="/network-information/get-subscriber-network-information/" class="dosc_nav__anchor" data-v-35cf879f>Get subscriber network information</a></li><li data-v-35cf879f><a href="/network-information/network-info-api/" class="dosc_nav__anchor" data-v-35cf879f>Network info API</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-35cf879f><h3 class="is-uppercase" data-v-39f0b824 data-v-35cf879f>
        call forwarding
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-35cf879f><li data-v-35cf879f><a href="/call-forwarding/set-call-forwarding/" class="dosc_nav__anchor" data-v-35cf879f>Set call forwarding</a></li><li data-v-35cf879f><a href="/call-forwarding/call-forwarding-api-reference/" class="dosc_nav__anchor" data-v-35cf879f>Call forwarding API reference</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-35cf879f><h3 class="is-uppercase" data-v-39f0b824 data-v-35cf879f>
        pbx
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-35cf879f><li data-v-35cf879f><a href="/pbx/pbx-tas-integration/" class="dosc_nav__anchor" data-v-35cf879f>PBX/TAS integration</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-35cf879f><h3 class="is-uppercase" data-v-39f0b824 data-v-35cf879f>
        number lookup
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-35cf879f><li data-v-35cf879f><a href="/number-lookup/overview/" class="dosc_nav__anchor" data-v-35cf879f>Overview</a></li><li class="active--exact active" data-v-35cf879f><a href="/number-lookup/technical-guide/" aria-current="page" class="dosc_nav__anchor" data-v-35cf879f>Technical guide</a></li><li data-v-35cf879f><a href="/number-lookup/api-reference/" class="dosc_nav__anchor" data-v-35cf879f>API reference</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-35cf879f><h3 class="is-uppercase" data-v-39f0b824 data-v-35cf879f>
        metrics
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-35cf879f><li data-v-35cf879f><a href="/metrics/accessing-metrics/" class="dosc_nav__anchor" data-v-35cf879f>Accessing Metrics</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-35cf879f><h3 class="is-uppercase" data-v-39f0b824 data-v-35cf879f>
        web terminal
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-35cf879f><li data-v-35cf879f><a href="/web-terminal/create-a-web-terminal-to-make-and-receive-calls/" class="dosc_nav__anchor" data-v-35cf879f>Create a Web Terminal to make and receive calls</a></li><li data-v-35cf879f><a href="/web-terminal/web-terminal-api-reference/" class="dosc_nav__anchor" data-v-35cf879f>Web Terminal API reference</a></li></ul></div></div></nav><div class="doc-main-container" data-v-39f0b824><div class="article-container" data-v-39f0b824><div class="is-flex" data-v-39f0b824><div class="article" data-v-39f0b824><article role="alert" class="notification is-warning is-light" data-v-35cf879f><button type="button" aria-label="Close notification" class="delete"></button><div class="media"><!----><div class="media-content"><div class="is-flex" data-v-35cf879f><span class="icon is-large" style="margin-right:16px;" data-v-35cf879f><i class="mdi mdi-information mdi-48px"></i></span><div data-v-35cf879f>
        This documentation is for v0 of our APIs and might change. See
        <a href="https://v1.docs.wgtwo.com" data-v-35cf879f>https://v1.docs.wgtwo.com</a> for
        our guaranteed stable APIs.
      </div></div></div></div><!----></article><div data-v-39f0b824 data-v-35cf879f><div id="content" class="content" data-v-39f0b824 data-v-35cf879f><div><h1 id="number-lookup-api---technical-guide"><a href="#number-lookup-api---technical-guide" aria-hidden="true">#</a>Number Lookup API - Technical Guide</h1><blockquote><p><strong>This guide will show you how to set up a Number Lookup Provider.</strong></p><p>You should have an understanding of how this works before continuing,
see <a href="number-lookup/setup-number-lookup-overview/">Overview</a>.</p></blockquote><h2 id="prerequisites"><a href="#prerequisites" aria-hidden="true">#</a>Prerequisites</h2><p>This guide assumes you are able to create a OAuth 2.0 client and get an access token.</p><p>See <a href="https://docs.wgtwo.com/guide/oauth2/get-client-access-token.html" target="_blank" rel="nofollow noopener noreferrer">Get client access token</a> for how to get the
access token.</p><blockquote><p><strong>Note:</strong><br>
For testing using our sandbox endpoint, authentication headers may be skipped.</p></blockquote><h3 id="required-scope"><a href="#required-scope" aria-hidden="true">#</a>Required scope</h3><p><code>lookup.number:read</code></p><h2 id="how-to-use-the-api"><a href="#how-to-use-the-api" aria-hidden="true">#</a>How to use the API</h2><p>When you connect to this API, you will get a stream of number lookup requests for which you should respond with
information about the number.</p><div class="language-tabs" data-v-33cce47c><div class="b-tabs" data-v-33cce47c><nav role="tablist" aria-orientation="horizontal" class="tabs"><ul></ul></nav><section class="tab-content"><div class="tab-item" role="tabpanel" id="724-content" aria-labelledby="724-label" tabindex="-1" style="display:none;" data-v-33cce47c><div><pre class="language-bash"><code class="language-bash"><span class="token shebang important">#!/usr/bin/env bash</span>

<span class="token comment"># Download the API definition</span>
<span class="token function">curl</span> -sL <span class="token string">'https://github.com/working-group-two/wgtwoapis/blob/master/image.bin?raw=true'</span> -o proto/wgtwo.bin

<span class="token comment"># Access token must be obtained via the client credentials flow</span>
<span class="token assign-left variable">ACCESS_TOKEN</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>
  <span class="token function">curl</span> -s -u $CLIENT_ID:$CLIENT_SECRET <span class="token punctuation">\</span>
    --request POST <span class="token punctuation">\</span>
    --url <span class="token string">'https://id.wgtwo.com/oauth2/token'</span> <span class="token punctuation">\</span>
    --header <span class="token string">'content-type: application/x-www-form-urlencoded'</span> <span class="token punctuation">\</span>
    --data <span class="token assign-left variable">grant_type</span><span class="token operator">=</span><span class="token string">"client_credentials"</span> <span class="token punctuation">\</span>
    --data <span class="token assign-left variable">scope</span><span class="token operator">=</span><span class="token string">"lookup.number:read"</span> <span class="token punctuation">\</span>
  <span class="token operator">|</span> jq -r .access_token
<span class="token variable">)</span></span>

<span class="token comment"># We send data to grpcurl via a PIPE, and receive data via stdout.</span>
<span class="token assign-left variable">PIPE</span><span class="token operator">=</span>/tmp/provider-PIPE
<span class="token function">mkfifo</span> <span class="token variable">$PIPE</span>
<span class="token builtin class-name">exec</span> <span class="token operator"><span class="token file-descriptor important">3</span>&lt;></span> <span class="token variable">$PIPE</span>

<span class="token function-name function">cleanup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"Cleaning up..."</span>
    <span class="token function">rm</span> -f <span class="token variable">$PIPE</span>
    <span class="token builtin class-name">exec</span> <span class="token operator"><span class="token file-descriptor important">3</span>>&amp;</span>-
    <span class="token builtin class-name">exit</span>
<span class="token punctuation">}</span>
<span class="token builtin class-name">trap</span> cleanup INT <span class="token environment constant">TERM</span> EXIT

grpcurl <span class="token punctuation">\</span>
   -H <span class="token string">"Authorization: Bearer <span class="token variable">$ACCESS_TOKEN</span>"</span> <span class="token punctuation">\</span>
   -protoset wgtwo.bin <span class="token punctuation">\</span>
   -d @ <span class="token punctuation">\</span>
   api.wgtwo.com:443 <span class="token punctuation">\</span>
   wgtwo.lookup.v0.NumberLookupService/NumberLookup <span class="token operator">&lt;</span><span class="token file-descriptor important">&amp;3</span> <span class="token punctuation">\</span>
<span class="token operator">|</span> <span class="token keyword">while</span> <span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span> <span class="token builtin class-name">read</span> -r LINE<span class="token punctuation">;</span> <span class="token keyword">do</span>
    <span class="token comment"># grpcurl sends output line by line, so we buffer until we have a valid JSON object.</span>
    <span class="token assign-left variable">BUFFER</span><span class="token operator">+=</span><span class="token string">"<span class="token variable">$LINE</span>"</span>
    <span class="token keyword">if</span> <span class="token operator">!</span> jq <span class="token builtin class-name">.</span> <span class="token operator">></span>/dev/null <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&lt;&lt;&lt;</span><span class="token string">"<span class="token variable">$BUFFER</span>"</span><span class="token punctuation">;</span> <span class="token keyword">then</span> <span class="token builtin class-name">continue</span><span class="token punctuation">;</span> <span class="token keyword">fi</span>

    <span class="token comment"># Create a JSON response that includes the request and a dummy result.</span>
    <span class="token assign-left variable">RESPONSE_JSON</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>jq -c -n --argjson incoming_content <span class="token string">"<span class="token variable">$BUFFER</span>"</span> <span class="token punctuation">\</span>
      <span class="token string">'{
          number_lookup_request: $incoming_content,
          result: {
            name: "John Doe"
          }
      }'</span>
    <span class="token variable">)</span></span>

    <span class="token comment"># Send the response to grpcurl via the PIPE.</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$RESPONSE_JSON</span>"</span> <span class="token operator">></span> <span class="token variable">$PIPE</span>

    <span class="token builtin class-name">echo</span> <span class="token string">"Sent response:"</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$RESPONSE_JSON</span>"</span> <span class="token operator">|</span> jq <span class="token builtin class-name">.</span>
    <span class="token builtin class-name">echo</span> <span class="token string">""</span>

    <span class="token comment"># Clear the buffer.</span>
    <span class="token assign-left variable">BUFFER</span><span class="token operator">=</span><span class="token string">""</span>
<span class="token keyword">done</span>
</code></pre><figcaption><a href="https://github.com/working-group-two/docs.wgtwo.com/blob/master/examples/grpcurl/thirdpartydev/number-lookup/provider.sh" target="_blank" class="github-link">provider.sh</a></figcaption></div></div><!----><div class="tab-item" role="tabpanel" id="726-content" aria-labelledby="726-label" tabindex="-1" class="content" style="display:none;" data-v-33cce47c><div class="collapse card" data-v-33cce47c><div class="collapse-trigger"><div role="button" class="card-header" data-v-33cce47c><p class="card-header-title" data-v-33cce47c>
            Install dependencies
          </p><a class="card-header-icon" data-v-33cce47c><span class="icon" data-v-33cce47c><i class="mdi mdi-menu-up mdi-24px"></i></span></a></div></div><div id="" class="collapse-content" style="display:none;"><div class="card-content" data-v-33cce47c><div data-v-33cce47c><pre class="language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.wgtwo.api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>auth<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>0.0.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.wgtwo.api.v0.grpc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>lookup<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>0.1.6<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>depenencies</span><span class="token punctuation">></span></span></code></pre></div></div></div></div><div class="is-size-4 mt-4" data-v-33cce47c>
        Snippet
      </div><div><pre class="language-kt"><code class="language-kt"><span class="token keyword">package</span> com<span class="token punctuation">.</span>wgtwo<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>thirdpartydev<span class="token punctuation">.</span>numberlookup

<span class="token keyword">import</span> com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>protobuf<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Durations
<span class="token keyword">import</span> com<span class="token punctuation">.</span>wgtwo<span class="token punctuation">.</span>api<span class="token punctuation">.</span>v0<span class="token punctuation">.</span>lookup<span class="token punctuation">.</span>NumberLookupProto<span class="token punctuation">.</span>NumberLookupRequest
<span class="token keyword">import</span> com<span class="token punctuation">.</span>wgtwo<span class="token punctuation">.</span>api<span class="token punctuation">.</span>v0<span class="token punctuation">.</span>lookup<span class="token punctuation">.</span>NumberLookupProto<span class="token punctuation">.</span>NumberLookupResponse
<span class="token keyword">import</span> com<span class="token punctuation">.</span>wgtwo<span class="token punctuation">.</span>api<span class="token punctuation">.</span>v0<span class="token punctuation">.</span>lookup<span class="token punctuation">.</span>NumberLookupServiceGrpcKt
<span class="token keyword">import</span> com<span class="token punctuation">.</span>wgtwo<span class="token punctuation">.</span>api<span class="token punctuation">.</span>v0<span class="token punctuation">.</span>lookup<span class="token punctuation">.</span>cacheControl
<span class="token keyword">import</span> com<span class="token punctuation">.</span>wgtwo<span class="token punctuation">.</span>api<span class="token punctuation">.</span>v0<span class="token punctuation">.</span>lookup<span class="token punctuation">.</span>numberLookupResponse
<span class="token keyword">import</span> com<span class="token punctuation">.</span>wgtwo<span class="token punctuation">.</span>api<span class="token punctuation">.</span>v0<span class="token punctuation">.</span>lookup<span class="token punctuation">.</span>result
<span class="token keyword">import</span> com<span class="token punctuation">.</span>wgtwo<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>BearerTokenCallCredentials
<span class="token keyword">import</span> io<span class="token punctuation">.</span>grpc<span class="token punctuation">.</span>ManagedChannelBuilder
<span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>channels<span class="token punctuation">.</span>Channel
<span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>delay
<span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>catch
<span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>collect
<span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>flow
<span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>onEach
<span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>onStart
<span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>runBlocking
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>TimeUnit
<span class="token keyword">import</span> kotlin<span class="token punctuation">.</span>time<span class="token punctuation">.</span>Duration<span class="token punctuation">.</span>Companion<span class="token punctuation">.</span>seconds

<span class="token keyword">private</span> <span class="token keyword">val</span> grpcChannel <span class="token operator">=</span> ManagedChannelBuilder<span class="token punctuation">.</span><span class="token function">forTarget</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"api.wgtwo.com:443"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">keepAliveWithoutCalls</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">keepAliveTime</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> TimeUnit<span class="token punctuation">.</span>MINUTES<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">keepAliveTimeout</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> TimeUnit<span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">idleTimeout</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> TimeUnit<span class="token punctuation">.</span>HOURS<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">private</span> <span class="token keyword">val</span> stub <span class="token operator">=</span> NumberLookupServiceGrpcKt<span class="token punctuation">.</span><span class="token function">NumberLookupServiceCoroutineStub</span><span class="token punctuation">(</span>grpcChannel<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withCallCredentials</span><span class="token punctuation">(</span>BearerTokenCallCredentials <span class="token punctuation">{</span> <span class="token string-literal singleline"><span class="token string">"MY ACCESS TOKEN"</span></span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">val</span> phonebook <span class="token operator">=</span> <span class="token function">mapOf</span><span class="token punctuation">(</span>
    <span class="token string-literal singleline"><span class="token string">"+4799999999"</span></span> <span class="token keyword">to</span> <span class="token string-literal singleline"><span class="token string">"John Doe"</span></span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>

<span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">startStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> responseQueue <span class="token operator">=</span> Channel<span class="token operator">&lt;</span>NumberLookupResponse<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// Check queue to see if we have any responses and send them over the wire</span>
    <span class="token keyword">val</span> responseFlow <span class="token operator">=</span> flow <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>response <span class="token keyword">in</span> responseQueue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">emit</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    stub<span class="token punctuation">.</span><span class="token function">numberLookup</span><span class="token punctuation">(</span>responseFlow<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">onStart</span> <span class="token punctuation">{</span> <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"Starting new stream"</span></span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
        <span class="token punctuation">.</span><span class="token function">onEach</span> <span class="token punctuation">{</span> request<span class="token operator">:</span> NumberLookupRequest <span class="token operator">-></span>
            <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"Got request for </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">request<span class="token punctuation">.</span>number<span class="token punctuation">.</span>e164</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">val</span> displayName <span class="token operator">=</span> phonebook<span class="token punctuation">.</span><span class="token function">getOrDefault</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>number<span class="token punctuation">.</span>e164<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">""</span></span><span class="token punctuation">)</span>
            <span class="token keyword">val</span> response <span class="token operator">=</span> numberLookupResponse <span class="token punctuation">{</span>
                numberLookupRequest <span class="token operator">=</span> request
                result <span class="token operator">=</span> result <span class="token punctuation">{</span>
                    name <span class="token operator">=</span> displayName
                <span class="token punctuation">}</span>
                cacheControl <span class="token operator">=</span> cacheControl <span class="token punctuation">{</span>
                    maxAge <span class="token operator">=</span> Durations<span class="token punctuation">.</span><span class="token function">fromMinutes</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"Sending response for </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">response<span class="token punctuation">.</span>numberLookupRequest<span class="token punctuation">.</span>number<span class="token punctuation">.</span>e164</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">response<span class="token punctuation">.</span>result<span class="token punctuation">.</span>name</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            responseQueue<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token punctuation">.</span><span class="token function">catch</span> <span class="token punctuation">{</span> e <span class="token operator">-></span>
            <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"Got error: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">e<span class="token punctuation">.</span>message</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> - Will reconnect in 1s"</span></span><span class="token punctuation">)</span>
            <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">.</span>seconds<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> runBlocking <span class="token punctuation">{</span>
    <span class="token comment">// Run forever - if the stream fails we will reconnect</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">startStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><figcaption><a href="https://github.com/working-group-two/docs.wgtwo.com/blob/master/examples/kotlin/thirdpartydev/number-lookup/src/main/kotlin/com/wgtwo/examples/thirdpartydev/provider/Provider.kt" target="_blank" class="github-link">Provider.kt</a></figcaption></div></div></section></div></div><h2 id="flow"><a href="#flow" aria-hidden="true">#</a>Flow</h2><p>The API is implemented as a bidirectional gRPC service, where the provider responds to requests from the server.</p><p>The Number Provider sets up one or more connections to our API. This connection should use keep-alive, and has a max
connection age of one hour +/- a 10 % jitter. Once max connection age is reached, or any exception occurs, the
connection should be re-established.</p><blockquote><p><strong>Note:</strong><br>
Although the connection is set up from the provider to wg2, all requests are initiated from wg2.</p></blockquote><p><img src="data:image/svg+xml,%3csvg fill='none' viewBox='0 0 526 204' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-50161e55af42a7ead41d9f44bb86255d'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-50161e55af42a7ead41d9f44bb86255d)' width='526' height='204' xlink:href='data:image/svg%2bxml%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAAZCAYAAACB6CjhAAAACXBIWXMAAAsTAAALEwEAmpwYAAAF9ElEQVRYw82Y629TdRjHT7eh4C2%2bMPrGa/AFakJCi84JJPofYOIMGIy8MSZ4hUBMRE1UGMaAMSZEiK8IJK7GsURgkyBBtmXdBpu0Hem0957Tnt7v29qe9vf4POecjrbr1o6dgif55Jz2XJ/v7/k9lx9nMn34%2bPj4vifGx/c2A16796mRkfce4XAzmT7iWrW5XD9zrd5EsY/jMpnRRD5vzedy5jlkvgEZABtEIhf66AHZ7Hi71h/V22vg7PafdHRssRx%2b0us9vVsQjDt5/pe3BEETdiLv2GzH9PILyXiAAAB4EV8DPAwgAcnk1fN0ryTZWiJAKjUkP1cQencAiPheN71b/cbV4kJiEA6f/1F%2bIY08nWDMWcKTbCnwPFEACEEiceV3urdQmNZcAKNRj15pkp8bCPR1AwhkPA6SC7/PrQWyDdHoxaNlAeaV0XWyUtEBhZwdCvka8D/GHIyBUwIIkwDn6F6f72qHwWDgVoJer1/Y10JbT4%2bBpqUsgN//myqAW1IHQAskEiAS%2beNYlQBSwckCvhgE/VkICmkko5KGAJ%2bFeEgkT5DIfTKZIdkD8Ms0G3lVBJ3BoNcNDZ3qoP94/tc3AfhKAVQXvj3oGYoN4cUC5OZcjPcUIJ4AdA8kVg3vjrLZWatEHyQIgwN07%2b7dOx7C0by/WdBA2t9H4PE6ZC2yZtOmTbp6oszODrxOo4VTQCqVHLIAZVSDYCWiLCtAft7FBG8OYmhsJFKCqAod038z015mNl8out0jcOnSiWGOa3tu69YtXWjMS41AI2Uqj5FOlZeRV5CtyDZiy5auV/HT1vf3H3k/kzFDqURu62PKVHXhb0eVCJp5gM9VkEc7EqkmHMY84UvgzfQhUUilrpanQNtq3L6zs5PiAbq9oZ08AbmH2LPn7XV4eu2pU1/s9fmGYXLygmQ2D7JAYAKNIGOCckRHYeTfK2BpAUpFJ4sGAxD2hyEcqCYkhCGd8KkC3AqCmczf7SsNgGR0d3f3ssKgdToly1zcTu%2bjGJBKmZnd/ieMjBjh8OH96JXX1PRoRxxNYJcDPYpQXwA6KV/I7OrFtdxyn2RSESCXs7Y3a3i96F8vG3R26rl4fLhdyTLGhSBYmPeyRDgLdpsAx38wwuT4DESDaRAxcIt8fFmCQhwC3jhkkrcGcZEASpRFN4ElqHCfZPKvc8oI3WxBHVCbBv00f6VElGc%2brMNicYBcDiCO%2b1BImZ7NQNeG/CG0wd5AgCVx3lUBUnGeiX4KyCUQxTwaUMR4xTBjNQMGc8xsEZEEcNyuAHffA/hVe0B4aQ9YiAHQfAzAPmJVMaAeXV16LpEYWRQD8nIMmAXHTABOHu%2bDqYl/cUQzmJ1onicaEvAmqgL54ixQcrJY0I9RH8vESsQQzZ2qAFLOApHIWPtKy1/ab968mdu4ceNyWaBNEbicBTxSOm1hDsdlGB42wldf70MDJrTNApV1ALlMbR0gVtQB6fRCHaBbrcuTGChMG9Kh1gJrDhx4dy2euvf06S8/4fkRuQ64cWOQCcKYnPuVDlHjOmBxJchkypXgP2ol6PFQJXgSK0EdVYJUxb3YDDjy5ePaarBcCW6rqARfw0979uzZng/S6RtQLFLg8ra%2bEly2F3BFWTZroZIUfL4BuRfYteuNh9GwBxqBRi3s1WO5L1D7Aar%2b6laUc3OD2%2b9YLyB3g1gsUDcoLnSCCtQNxuRu0H0nukFudPRMbTdY0L4dHlycBYqSA6cC9f%2bOGuqvB3g8VzoaRfV6GaBeNqD/aDt0yMBls2MVCyLyfC8qK0KaUKRBjEYvHvtfrgjRklg8fllNg2dQgBnA9xTyeUsJ064WFGg6iGL/0Zo1wWbW3DwoUrzla4JTUwc5ddX5QYvlmxemp7/dYLUe2TA9rRnPT0zsf5RTOrrRFCosoSfkUOV8A2YxH%2bD8GehXFiwmNBegvN28%2bV3Ll8WdzpMcd%2b3agaenpj5/ZnLyM%2bTgsuDI0HXrTaaPH6MHXL/%2bKdcKD3A4TsjHVmsPTYM2v9%2boE4ReLWmz2b6Xa5j/AIcCuAHfalDIAAAAAElFTkSuQmCC' /%3e%3c/svg%3e" width="526" data-src="/assets/static/number-lookup-3.8623c19.1cbf28011a5f2cfd70c9e3076974c872.svg" data-srcset="/assets/static/number-lookup-3.8623c19.1cbf28011a5f2cfd70c9e3076974c872.svg 526w" data-sizes="(max-width: 526px) 100vw, 526px" class="g-image g-image--lazy g-image--loading"><noscript><img src="/assets/static/number-lookup-3.8623c19.1cbf28011a5f2cfd70c9e3076974c872.svg" class="g-image g-image--loaded" width="526"></noscript></p><p>Using round-robin, wg2 will send number lookup requests
over these connections for which the provider will respond with the display name.</p><p>Responses will be cached for a period of time to avoid unnecessary requests and latency.</p><p><img src="data:image/svg+xml,%3csvg fill='none' viewBox='0 0 884 647' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-41923df27ed88b3c57f9e6834fa71c87'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-41923df27ed88b3c57f9e6834fa71c87)' width='884' height='647' xlink:href='data:image/svg%2bxml%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAAvCAYAAABTy8xRAAAACXBIWXMAAAsTAAALEwEAmpwYAAAPh0lEQVRo3tUaB3iURfbf3ZCyyaYXSCGhpdBLEkIS0APBcqefot6J%2bAWxnHoq3FlpCihFqiCIIojnoRRFD/AoIhDTSIEs6WVD2qbsZtPbJluy/703/z%2bbTdhNNuHTD%2bf73jfzz8x7M/PmvTdv3j8MA6mmUsuQvELrqajSLVRU6%2bcrqnULauSaBVUV3QuqK7sh71qAdQDYdn%2btXBuMOCplD1Mp6zJDg/QjOBwNDcXnaeiNNOp4GjRVl2kEmFeWdPvVVumOVFdo/0z6KXoEZflqxlKqKOpiGhpZAb%2bmZbVy3f7SvE4JT4uRZXaYR1TW6kV8vlSnZdmmJpZtaWHZ9naW7exk2Y4OLse6xgaWJJj0V4jT2sEKq8u1fWnoemkgUBr0u7GxL42Wdo4GTcBUEc/MN7Ef0MzEbygK5Le6LTKAMvHYqiwRMIuMUl2ueRTrgJGi4sw284jQmU7%2baZxsQwOrU6l6etLSigzp6cWGlJR8Q2JitqGuTm%2bANq1GQyb/JWFAJzd5UxpqNdIw6KBvj6q%2bx5CVVWm4dq3AUFvbbYDFG%2brrDWZp0FRFJUDWPQZ28gx8L6ESADtqkQEoHcBMggsLfx1wT0CdOy8BAmsYsKS9jTCgGyapKy1t1hUUKHWFhUpdTk4VMgUX1YULhMkfssCAJSg5lAYyE/GBkTpgIPmG%2br40OvoyQHqpHnebyU6oty9O74wsSmsLpG3FN9osMoC2JcTnCGQZnUFlUm14ZrzCFmnlJjQxMmn7oAxYhmLT1cWyuEM9Pb2ASQvqgRPnxfeYBQb0oYE4iG8wcGWsM6FxHHHK5c2ivbsPMzNnziQgL9CTeZXndnuk/FISlZWiGIPfST8XWV4EMkDKMQBVJfVK6cRzpzKi22pYB6wrymxhijNbzSOCURLwejIVFvIJTGwH5DuVCv12RY3uAIKyVrcd6nZB23aATxU1%2bsWI09jECqpKNRZpYH/Er63WHuBxd0H99vo6dr9KyT7GT7jPfN5auZ7k2gYWDZjfhtUfe9A%2bFsXYpA362jy4cLEXFMOgbId1aVfKB8TFHTRb/8uhModLB8vszbWB6FpF48qXlfbHtieLzbU99NBfRkydOsVu%2bvTpAth9GwBHrF/z9mbC0GY568iqWSFhbjHLDJYaylnKBCEA2f36skHw6MRBfAWgnyLQU5GyRm%2bDdbeyO0YhkHaowzYEsNRkUm1qluFV4DYaIBWERmFmsy9Mxo1ODPNFix4Iio6OmQ4LngwQBYDlYIAw07lVF7Kj89ObXIgY32gdVAIKMppIueB6s6Qgo3ksGf9GiyA/vdEyLpyzDG85UYQJUF2D3BuBLxvb6bmPC68o7jLSiHvmeZKHh4czZ0%2bmkF1UK1mPV196c76bp9OomOhYV1ik24wZM9wgd%2bfBA2AU5liPEBszDxkm%2bfFYQijsquNg4t9fDSB3AhjNlwXMUJORECy%2bmGeANRPAhIbMNMGuS/712pq5QlvGff699znAAl2gjyvkpuBMy9gWG0sY4HT6eGJoQxnrNBwGyDLbA/mN%2b/0YYLr42bOjRgUE%2bo5b8Y93I3dsPjjew8vFJzIicsKsWbNsrJ2HQsb6g1hL/nAMiIyMZEDcnT29XX1Wv7Vp8tp3tkwc5eflFxk5OwD6iGhf2HGzcHj/KTLpwustgbCAPw4DqP73UwG3U0evBkHROXpOjBcs3NmcqvQ708mkYRGjizN/ZwYgkZKbnBHEE6BI2uLL%2bQt6G7lMwySfrmBKsjpIPxkFMJCYYx1a6/Kcbmbfzq/JwEkXi7yXx728EIqOUVFzRoIKEOMUPiuKmR0%2bj3k%2bbiUzfUoEEz4jGvJI4hcUgeXm5tKXAf0BFsnl0jbj%2bPyiwQhyDEAjaO3mGVNuInecXPmmxJFNZW2YYaTLZ7MY7vhq8XrxudcXODiJvGZHznayBhfOf7qQ0biYYUiwE0juaF6Khy4BTS3ceV2vZDfJihqTEhNyz8CRd7IsTz22IL3FBSblARx256DNHQbhAMsAMgTSp80Z8mBWzwagY9Jew7qChLirSlm3vdu%2b9tu56bD/TydTvTe9t2/01vUHArZt/Dyg7hbrVni9GXElsMOT8TgDcOFo82NK2/hx24xzkPF1kLtCnT/ATJiTDa9KQ2NAh4ZjQKOKPSYrbmi/nnFLpVIaLpbldhGvsLxQLShGseehGEVRyoGMz%2bn5C7nPzaTakVi%2b8EOG4G%2bPLyf1NjYjAkRC0VQbkc0YoVA0SygUzrGxsUFbwRzc872Qxw1EJlJR5saiKmAyLq8KdLchF8Oiw2Aj7KkPMwQGtDOZP6s4jyq9ObS5kh1p2g5MsZoOP3FvBNO6fuk2Ed30/h7CAPDgArNSlMQGLH1q%2baCiTHcaJEMMTAiF8eyGYsCp3jEFaa20PCEvtcGD6GUzK6it1NE7u5ldMN2ZPgbJyIDMxBpm7tx5TFjYRNIWGzO3/4nR5xu8SD/q03MnTAQer8ycOTEMGNTbIOFCAWfDUuvFMGYojG03DBVoZ0pzO%2bnkQ6grXJrXKeD9faaiSG0VI6kE3Mrq9Da3QNMUEhJCfQnviIjImWPGjg5%2bc8W62LilLwaHhgWHwvEaYO0a8BZYcrMjFOzN8CRAJm0zZYAXZYxMaj2YSgCIsQ%2bWV7zyrjAiIkJgDmB3hfPvXcjAMekIXuQYP38f/w1rd8586YWVQePGj/GHPt7gSAkiws3jIzy5%2bGmiOls37vcE9ZlYkae1G0D1LDOABhcAMRjKXqYBh6E6U2XZXd7HjlxA42YfEzNXAldfp4Fg2vRp4oX3PYATF5z7Pm38/l1HcXwRHKH2g%2bGC5DjZiQWOixY%2b%2bMQvZ27OAEkYcacSMAMgDN1R0HMPmZQeOe3ueJyBn%2b6Rl9bgATrnAVdQd9N2GddfAt%2bIj/oo4evcBwI4At2zr9V5SpNqXYDmFBhjdFaKwhXHGQyXBzym/QGiYGzx8CSgV3xDoOxFXUqsZzUsiphZXPD7iZ7zakCPQeOVGqRB0KlgmcGgFPqZOEJcaDtfNyge9iEebJZajBsHYw/PBhRlGk%2bBYNgNMvltHx4QhIaFMJMmTSSTg0uLLRgsCXefn%2bEDOeE2tmO/LRv2kX6wcz7Fma2ERj4fsBgswSWIMg%2bdIAlv2QfFy0lV8d5na59TYMgMKM/VUDc2BHbUxVw/MDpCMFi%2bsPAJAOEAZq10TxPrDjvvxQU6NdYZUKND08sAtEHW4PJrEBO14yVANlQGnP8xgwtM1rNBcUtfWAwWeRzc5DB64wU7jzc6b8wBPEyCGp5Yz4MXnMvejIhx3f7hZ5NSL5eSsFrC%2bQKr/PI7vQ0aGTBcCciIr2R4vZsAoo9xOsd75v3JkRd5J1isHYA9gAP/LUaV4OsRxHNj78GJ23312X/HSpNqiDdJ6d71DCjL6TZVAVfaBiJvDwueAjAVIALFng9oTuVh2kwuiU2cEueKXK0XNWR/CAaAETIawfT4CuLEwJVWiNEcDF1jYBNjd7j7GOAAcDEJcmKbLTo9iLd%2b9fYZ6VcriATs3nqILGzatGm/aUDkjhlwM7mWP046g//zxU/oxDjExszDwKUEwJEXeXG/soMJSObNvRfv8TbLnvn7E7%2bez/c1HSM2NvbulgDwoynBEHm%2b3nM4ARG0GbYOjMfZkykB3xw%2bFyS0ZdzAkHpGRUUxv3VI7I4ZYOoIYUQHyz9%2bmyCg/%2b8GA/6m5xoY5D/xn6%2btiV3z9uZwKE8CX348XTzYk7uYAVJjULTPZcjaZLq7aES/%2b/oyxuck0dHkKLW/%2byXgDhhAFwZiL%2bBiANU%2bcK2NRDuCQVFoD%2brPAJQG%2bo053OSMnuBwwuJ3BQPiz%2bWR/EZCldeSvy570tPbxWdOVDQ6SyPMSQB4lgzc6Eh5x%2bbPhbwbHZiZUE1CYsvjXhZQPEvSc9eoALn48L5EaZbaG32BgX6f0X8J%2bEPFNOkaWfyxam8Jrz9NOLW4O8E11fDvAjTExeugMSIEZYGsXzze9N9A33h9W5%2bgKKgB8QMOfnJCCJ4hYQ4etXDRMsLrr7wj4JkwEoxl5ITgcRNXvrpq3jNLngudNHkiGtAgXrWYy2ez%2b%2bAi5KbVM1nJit6IkLQ3IjSkoKhpZ5j8BLzfM3eQAN8TaA7lKB0REhrsywgZ783rP5n64vLX/B2dbX38Aka6WkvgjRXrMCIUCh7o4AxQVOuNL0XqlD02dQoOelhWWJLVPqskuyOkvFDtVJrX6V6W1%2blWlt/pdiunw4X8fpK2GwG/ob8ztmO/UoT8Dqey3K7x506lTvvg/V1%2b%2b3b9O3DPji8D9%2b48Erhj82cBG9bu9P1g3W7fjet2Qb7LdyN8wzV61MG9J7x2f3TI7dIZ6bTvj14Z9/FHh933bDvis3Et388cQNum9/f4vvPGxlFPP/Xsc/Hn86JBEmxxbfina0A1ACaYvaUln6x2Tv6uyux1uCSrA/XMgQIs3jHxW7mof7%2bk41WS%2bKPlEvPHXatjYUazA7je4sLrzWK8x6P%2b3kiqIv1vxteNv/Y/uUvCxQI7uFA5gk8i5vpahoKM5hEdJaxjfnLLOBLBLtUMfAM1ed8TBjv/AcA6gPfqVewaRY1%2bi7JWv0VVZ1gF0rEWYDXAh8oa/f0WGBkCuBugzxrsr6rrWaWo0W2F/lbTMD7cKNfOgrFv1cp17w5V7WAte4F%2bjrykewxPy/L/QWXvC69n6Wswva73pRg%2bfOzRQ52eq%2bNfeJ1AnKYWVoQhdPxxehsNHgdpGMvmaDRzNKgBhYnTh5Kv8g8lE/Ab0Mg7QXM/SRHoK9Jt918RAu1y8lCyTPMQzxCrHkouaePfCapUem1iUo7211%2bzdFevZuouXEjRKpVarck7wS8Qx%2bw7QULD0I2PKvFRJL4RvHgxVVdT06VtbCR1ZmnQRB9Dgt6OrChW7wCbsohIV41OUDTAO0E0dAb%2bv0N5gfrx8iL1psK0Vgmnru1WvROkjxw1%2bMhRqdTpqqvVBKqqOnX8689ufAM40EPJDhMasGCdXN6hk8kadPThJORmadCUn9JKAqtplyqF8hzDlFJpFzmG5RnswO8EMWCr4BhQka0fqSxiJ9E/zSU31Jb/Dhnf%2bdbo41BscHe6u3sfOlLAOnxKy4vvN2Ty5JWnxiINBKoOmm7zNLi3whrjfAquN3O/3wp7Rh3a98OsxItFxJjZOoisfid4%2bnjypM3rP40xtHAOGAZjLT6UBCPDGUG5diQs4DFYzMOQPwIi9wgYSCNgHcDD0P446NQU8vtcZWDwAbMlGpAT3Noq7SP02xINmp54NI4uBJnq%2beDCxxz6L3IQBggcHMQYkfKnz/JOH0s2%2b2Pn/29vVRxgQk6NAAAAAElFTkSuQmCC' /%3e%3c/svg%3e" width="884" data-src="/assets/static/number-lookup-2.3c7d887.e9bedc3e9f4ce56212cf462a97b214bb.svg" data-srcset="/assets/static/number-lookup-2.82a2fbd.e9bedc3e9f4ce56212cf462a97b214bb.svg 480w, /assets/static/number-lookup-2.3c7d887.e9bedc3e9f4ce56212cf462a97b214bb.svg 884w" data-sizes="(max-width: 884px) 100vw, 884px" class="g-image g-image--lazy g-image--loading"><noscript><img src="/assets/static/number-lookup-2.3c7d887.e9bedc3e9f4ce56212cf462a97b214bb.svg" class="g-image g-image--loaded" width="884"></noscript></p><h2 id="request--response"><a href="#request--response" aria-hidden="true">#</a>Request / Response</h2><p>For matching the response to the original request, the provider must include the original request in the response.</p><p>The returned display name may be empty if the provider does not have a display name for the number, and
may be cached for the duration specified.</p><h3 id="request"><a href="#request" aria-hidden="true">#</a>Request</h3><pre class="language-prototext"><code class="language-prototext">NumberLookupRequest {
  id: &quot;opaque string&quot;
  number {
    e164: &quot;+1234567890&quot;
  }
}</code></pre><h3 id="response"><a href="#response" aria-hidden="true">#</a>Response</h3><pre class="language-prototext"><code class="language-prototext">NumberLookupResponse {
  number_lookup_request { } # Fields omitted for brevity

  result {
    name: &quot;John Doe&quot;
  }
}</code></pre><h3 id="response-upstream-error"><a href="#response-upstream-error" aria-hidden="true">#</a>Response, upstream error</h3><pre class="language-prototext"><code class="language-prototext">NumberLookupResponse {
  number_lookup_request { } # Fields omitted for brevity

  error {
    message: &quot;Database unavailable&quot;
  }
}</code></pre><h2 id="limitations-for-display-name"><a href="#limitations-for-display-name" aria-hidden="true">#</a>Limitations for display name</h2><p>The display name returned must be max 60 characters, and may only contain the following:</p><ul><li>alphanumeric (<code>a-z</code>, <code>A-Z</code>, <code>0-9</code>)</li><li><code></code> (space), <code>-</code>, <code>_</code></li><li><code>.</code>, <code>!</code>, <code>%</code>, <code>*</code>, <code>'</code>, <code>+</code>, <code>~</code>, <code>`</code></li></ul><p>Characters not matching the above will be stripped.</p><h2 id="error-handling"><a href="#error-handling" aria-hidden="true">#</a>Error handling</h2><p>If there are no healthy connections for the provider, the provider will be ignored.</p><p>Should the provider fail to respond within the set deadline, it will be treated as if it returned an empty result.</p><p>For upstream errors, the provider must return an error, accompanied by a descriptive, human-readable message.</p><h2 id="cache"><a href="#cache" aria-hidden="true">#</a>Cache</h2><p>As part of the response, the provider can include a cache TTL.</p><p>This is the time in seconds that the display name should be cached on the wg2 side.
If not set, a default cache TTL documented in the proto file will be used.</p><pre class="language-prototext"><code class="language-prototext">NumberLookupResponse {
  number_lookup_request { } # Fields omitted for brevity

  result {
    name: &quot;John Doe&quot;
  }

  # Optional, set to default if not set
  cache_control {
    max_age {
      seconds: 3600  # 1 hour, google.protobuf.Duration
    }
  }
}</code></pre><h2 id="recommended-grpc-connection-settings"><a href="#recommended-grpc-connection-settings" aria-hidden="true">#</a>Recommended gRPC connection settings</h2><table><thead><tr><th align="left">Setting</th><th align="left">Value</th><th>Description</th></tr></thead><tbody><tr><td align="left">keep-alive period</td><td align="left">1 minute</td><td>Must be ≥ 1 minute and ≤ 5 minutes</td></tr><tr><td align="left">keep-alive timeout</td><td align="left">10 seconds</td><td></td></tr><tr><td align="left">permit keep-alive without calls</td><td align="left">true</td><td></td></tr></tbody></table><h3 id="keep-alive"><a href="#keep-alive" aria-hidden="true">#</a>Keep-Alive</h3><p>The load balancer hosting api.wgtwo.com will silently drop connections if they have been idle for 350 seconds (5m 50s).</p><p>To avoid this, the provider should send a keep-alive message every minute.</p><h2 id="continue-reading"><a href="#continue-reading" aria-hidden="true">#</a>Continue reading</h2><ul><li><a href="/number-lookup/api-reference/">API reference</a></li></ul><h2 id="concepts"><a href="#concepts" aria-hidden="true">#</a>Concepts</h2><ul><li><a href="https://grpc.io/docs/guides/concepts/" target="_blank" rel="nofollow noopener noreferrer">gRPC concepts</a></li><li><a href="https://grpc.io/docs/languages/kotlin/basics/" target="_blank" rel="nofollow noopener noreferrer">Kotlin gRPC tutorial</a></li><li><a href="https://grpc.io/docs/reference/java/generated-code/" target="_blank" rel="nofollow noopener noreferrer">Java gRPC stubs</a></li></ul></div></div><footer data-v-39f0b824 data-v-35cf879f><aside class="editthispage" data-v-39f0b824 data-v-35cf879f><a href="https://github.com/working-group-two/docs.wgtwo.com/blob/master/docs/number-lookup-how-to.md" target="_blank" icon-left="pencil" data-v-39f0b824 data-v-35cf879f><span class="icon is-small" data-v-35cf879f><i class="mdi mdi-pencil"></i></span>
          Edit page
        </a></aside><nav class="previous-next-buttons" data-v-39f0b824 data-v-35cf879f><a href="/number-lookup/overview/" class="button is-link is-inverted docs-nav__link" data-v-35cf879f>
          ← Overview
        </a><a href="/number-lookup/api-reference/" class="button is-link is-inverted docs-nav__nextlink" data-v-35cf879f>
          API reference →
        </a></nav></footer></div></div><nav class="articlenav is-hidden-touch" data-v-39f0b824><h3 data-v-39f0b824 data-v-35cf879f>ON THIS PAGE</h3><ul class="anchormenu" data-v-39f0b824 data-v-35cf879f><li data-v-39f0b824 data-v-35cf879f><a href="#prerequisites" aria-current="page" class="active--exact active" data-v-35cf879f>
          Prerequisites
        </a><ul class="anchormenu__sub-menu" data-v-39f0b824 data-v-35cf879f><li data-v-39f0b824 data-v-35cf879f><a href="#required-scope" aria-current="page" class="active--exact active" data-v-35cf879f>
              Required scope
            </a></li></ul></li><li data-v-39f0b824 data-v-35cf879f><a href="#how-to-use-the-api" aria-current="page" class="active--exact active" data-v-35cf879f>
          How to use the API
        </a><ul class="anchormenu__sub-menu" data-v-39f0b824 data-v-35cf879f></ul></li><li data-v-39f0b824 data-v-35cf879f><a href="#flow" aria-current="page" class="active--exact active" data-v-35cf879f>
          Flow
        </a><ul class="anchormenu__sub-menu" data-v-39f0b824 data-v-35cf879f></ul></li><li data-v-39f0b824 data-v-35cf879f><a href="#request--response" aria-current="page" class="active--exact active" data-v-35cf879f>
          Request / Response
        </a><ul class="anchormenu__sub-menu" data-v-39f0b824 data-v-35cf879f><li data-v-39f0b824 data-v-35cf879f><a href="#request" aria-current="page" class="active--exact active" data-v-35cf879f>
              Request
            </a></li><li data-v-39f0b824 data-v-35cf879f><a href="#response" aria-current="page" class="active--exact active" data-v-35cf879f>
              Response
            </a></li><li data-v-39f0b824 data-v-35cf879f><a href="#response-upstream-error" aria-current="page" class="active--exact active" data-v-35cf879f>
              Response, upstream error
            </a></li></ul></li><li data-v-39f0b824 data-v-35cf879f><a href="#limitations-for-display-name" aria-current="page" class="active--exact active" data-v-35cf879f>
          Limitations for display name
        </a><ul class="anchormenu__sub-menu" data-v-39f0b824 data-v-35cf879f></ul></li><li data-v-39f0b824 data-v-35cf879f><a href="#error-handling" aria-current="page" class="active--exact active" data-v-35cf879f>
          Error handling
        </a><ul class="anchormenu__sub-menu" data-v-39f0b824 data-v-35cf879f></ul></li><li data-v-39f0b824 data-v-35cf879f><a href="#cache" aria-current="page" class="active--exact active" data-v-35cf879f>
          Cache
        </a><ul class="anchormenu__sub-menu" data-v-39f0b824 data-v-35cf879f></ul></li><li data-v-39f0b824 data-v-35cf879f><a href="#recommended-grpc-connection-settings" aria-current="page" class="active--exact active" data-v-35cf879f>
          Recommended gRPC connection settings
        </a><ul class="anchormenu__sub-menu" data-v-39f0b824 data-v-35cf879f><li data-v-39f0b824 data-v-35cf879f><a href="#keep-alive" aria-current="page" class="active--exact active" data-v-35cf879f>
              Keep-Alive
            </a></li></ul></li><li data-v-39f0b824 data-v-35cf879f><a href="#continue-reading" aria-current="page" class="active--exact active" data-v-35cf879f>
          Continue reading
        </a><ul class="anchormenu__sub-menu" data-v-39f0b824 data-v-35cf879f></ul></li><li data-v-39f0b824 data-v-35cf879f><a href="#concepts" aria-current="page" class="active--exact active" data-v-35cf879f>
          Concepts
        </a><ul class="anchormenu__sub-menu" data-v-39f0b824 data-v-35cf879f></ul></li></ul></nav></div></div></div></main><footer class="footer docsnav is-hidden-desktop" data-v-39f0b824><div class="docs-nav__container" data-v-39f0b824 data-v-35cf879f><h3 class="is-uppercase" data-v-39f0b824 data-v-35cf879f>
        intro
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-35cf879f><li data-v-35cf879f><a href="/intro/get-started/" class="dosc_nav__anchor" data-v-35cf879f>Get started</a></li><li data-v-35cf879f><a href="/intro/api-structure-and-libraries/" class="dosc_nav__anchor" data-v-35cf879f>API structure and libraries</a></li><li data-v-35cf879f><a href="/intro/sandbox-environment/" class="dosc_nav__anchor" data-v-35cf879f>Sandbox Environment</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-35cf879f><h3 class="is-uppercase" data-v-39f0b824 data-v-35cf879f>
        oauth 2.0
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-35cf879f><li data-v-35cf879f><a href="/oauth-2-0/overview/" class="dosc_nav__anchor" data-v-35cf879f>Overview</a></li><li data-v-35cf879f><a href="/oauth-2-0/create-o-auth-2-0-client/" class="dosc_nav__anchor" data-v-35cf879f>Create OAuth 2.0 client</a></li><li data-v-35cf879f><a href="/oauth-2-0/get-user-access-token/" class="dosc_nav__anchor" data-v-35cf879f>Get user access token</a></li><li data-v-35cf879f><a href="/oauth-2-0/get-client-access-token/" class="dosc_nav__anchor" data-v-35cf879f>Get client access token</a></li><li data-v-35cf879f><a href="/oauth-2-0/support-revoking-consent/" class="dosc_nav__anchor" data-v-35cf879f>Support revoking consent</a></li><li data-v-35cf879f><a href="/oauth-2-0/why-support-user-revoking-of-consent/" class="dosc_nav__anchor" data-v-35cf879f>Why support user revoking of consent</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-35cf879f><h3 class="is-uppercase" data-v-39f0b824 data-v-35cf879f>
        mms
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-35cf879f><li data-v-35cf879f><a href="/mms/send-mms/" class="dosc_nav__anchor" data-v-35cf879f>Send MMS</a></li><li data-v-35cf879f><a href="/mms/mms-api-reference/" class="dosc_nav__anchor" data-v-35cf879f>MMS API reference</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-35cf879f><h3 class="is-uppercase" data-v-39f0b824 data-v-35cf879f>
        events
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-35cf879f><li data-v-35cf879f><a href="/events/listen-for-events/" class="dosc_nav__anchor" data-v-35cf879f>Listen for events</a></li><li data-v-35cf879f><a href="/events/configuration-and-types/" class="dosc_nav__anchor" data-v-35cf879f>Configuration and types</a></li><li data-v-35cf879f><a href="/events/events-api-reference/" class="dosc_nav__anchor" data-v-35cf879f>Events API reference</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-35cf879f><h3 class="is-uppercase" data-v-39f0b824 data-v-35cf879f>
        voicemail
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-35cf879f><li data-v-35cf879f><a href="/voicemail/list-play-delete-and-configure-voicemails/" class="dosc_nav__anchor" data-v-35cf879f>List, play, delete and configure voicemails</a></li><li data-v-35cf879f><a href="/voicemail/voicemail-api-reference/" class="dosc_nav__anchor" data-v-35cf879f>Voicemail API reference</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-35cf879f><h3 class="is-uppercase" data-v-39f0b824 data-v-35cf879f>
        subscription profile
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-35cf879f><li data-v-35cf879f><a href="/subscription-profile/overview/" class="dosc_nav__anchor" data-v-35cf879f>Overview</a></li><li data-v-35cf879f><a href="/subscription-profile/manage-subscriptions/" class="dosc_nav__anchor" data-v-35cf879f>Manage subscriptions</a></li><li data-v-35cf879f><a href="/subscription-profile/subscription-profile-api-reference/" class="dosc_nav__anchor" data-v-35cf879f>Subscription profile API reference</a></li><li data-v-35cf879f><a href="/subscription-profile/subscription-services/" class="dosc_nav__anchor" data-v-35cf879f>Subscription services</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-35cf879f><h3 class="is-uppercase" data-v-39f0b824 data-v-35cf879f>
        network information
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-35cf879f><li data-v-35cf879f><a href="/network-information/get-subscriber-network-information/" class="dosc_nav__anchor" data-v-35cf879f>Get subscriber network information</a></li><li data-v-35cf879f><a href="/network-information/network-info-api/" class="dosc_nav__anchor" data-v-35cf879f>Network info API</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-35cf879f><h3 class="is-uppercase" data-v-39f0b824 data-v-35cf879f>
        call forwarding
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-35cf879f><li data-v-35cf879f><a href="/call-forwarding/set-call-forwarding/" class="dosc_nav__anchor" data-v-35cf879f>Set call forwarding</a></li><li data-v-35cf879f><a href="/call-forwarding/call-forwarding-api-reference/" class="dosc_nav__anchor" data-v-35cf879f>Call forwarding API reference</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-35cf879f><h3 class="is-uppercase" data-v-39f0b824 data-v-35cf879f>
        pbx
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-35cf879f><li data-v-35cf879f><a href="/pbx/pbx-tas-integration/" class="dosc_nav__anchor" data-v-35cf879f>PBX/TAS integration</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-35cf879f><h3 class="is-uppercase" data-v-39f0b824 data-v-35cf879f>
        number lookup
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-35cf879f><li data-v-35cf879f><a href="/number-lookup/overview/" class="dosc_nav__anchor" data-v-35cf879f>Overview</a></li><li class="active--exact active" data-v-35cf879f><a href="/number-lookup/technical-guide/" aria-current="page" class="dosc_nav__anchor" data-v-35cf879f>Technical guide</a></li><li data-v-35cf879f><a href="/number-lookup/api-reference/" class="dosc_nav__anchor" data-v-35cf879f>API reference</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-35cf879f><h3 class="is-uppercase" data-v-39f0b824 data-v-35cf879f>
        metrics
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-35cf879f><li data-v-35cf879f><a href="/metrics/accessing-metrics/" class="dosc_nav__anchor" data-v-35cf879f>Accessing Metrics</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-35cf879f><h3 class="is-uppercase" data-v-39f0b824 data-v-35cf879f>
        web terminal
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-35cf879f><li data-v-35cf879f><a href="/web-terminal/create-a-web-terminal-to-make-and-receive-calls/" class="dosc_nav__anchor" data-v-35cf879f>Create a Web Terminal to make and receive calls</a></li><li data-v-35cf879f><a href="/web-terminal/web-terminal-api-reference/" class="dosc_nav__anchor" data-v-35cf879f>Web Terminal API reference</a></li></ul></div></footer></div>
    <script>window.__INITIAL_STATE__={"data":{"doc":{"title":"Technical guide","headings":[{"value":"Number Lookup API - Technical Guide"}],"subtitles":[{"depth":1,"value":"Number Lookup API - Technical Guide","anchor":"#number-lookup-api---technical-guide"},{"depth":2,"value":"Prerequisites","anchor":"#prerequisites","children":[{"depth":3,"value":"Required scope","anchor":"#required-scope","children":[]}]},{"depth":3,"value":"Required scope","anchor":"#required-scope","children":[]},{"depth":2,"value":"How to use the API","anchor":"#how-to-use-the-api","children":[]},{"depth":2,"value":"Flow","anchor":"#flow","children":[]},{"depth":2,"value":"Request \u002F Response","anchor":"#request--response","children":[{"depth":3,"value":"Request","anchor":"#request","children":[]},{"depth":3,"value":"Response","anchor":"#response","children":[]},{"depth":3,"value":"Response, upstream error","anchor":"#response-upstream-error","children":[]}]},{"depth":3,"value":"Request","anchor":"#request","children":[]},{"depth":3,"value":"Response","anchor":"#response","children":[]},{"depth":3,"value":"Response, upstream error","anchor":"#response-upstream-error","children":[]},{"depth":2,"value":"Limitations for display name","anchor":"#limitations-for-display-name","children":[]},{"depth":2,"value":"Error handling","anchor":"#error-handling","children":[]},{"depth":2,"value":"Cache","anchor":"#cache","children":[]},{"depth":2,"value":"Recommended gRPC connection settings","anchor":"#recommended-grpc-connection-settings","children":[{"depth":3,"value":"Keep-Alive","anchor":"#keep-alive","children":[]}]},{"depth":3,"value":"Keep-Alive","anchor":"#keep-alive","children":[]},{"depth":2,"value":"Continue reading","anchor":"#continue-reading","children":[]},{"depth":2,"value":"Concepts","anchor":"#concepts","children":[]}],"roles":["THIRD_PARTY_DEVELOPER"],"hideWarning":null,"sourceExamples":[{"file":"examples\u002Fgrpcurl\u002Fthirdpartydev\u002Fnumber-lookup\u002Fprovider.sh","content":"#!\u002Fusr\u002Fbin\u002Fenv bash\n\n# Download the API definition\ncurl -sL 'https:\u002F\u002Fgithub.com\u002Fworking-group-two\u002Fwgtwoapis\u002Fblob\u002Fmaster\u002Fimage.bin?raw=true' -o proto\u002Fwgtwo.bin\n\n# Access token must be obtained via the client credentials flow\nACCESS_TOKEN=$(\n  curl -s -u $CLIENT_ID:$CLIENT_SECRET \\\n    --request POST \\\n    --url 'https:\u002F\u002Fid.wgtwo.com\u002Foauth2\u002Ftoken' \\\n    --header 'content-type: application\u002Fx-www-form-urlencoded' \\\n    --data grant_type=\"client_credentials\" \\\n    --data scope=\"lookup.number:read\" \\\n  | jq -r .access_token\n)\n\n# We send data to grpcurl via a PIPE, and receive data via stdout.\nPIPE=\u002Ftmp\u002Fprovider-PIPE\nmkfifo $PIPE\nexec 3\u003C\u003E $PIPE\n\ncleanup() {\n    echo \"Cleaning up...\"\n    rm -f $PIPE\n    exec 3\u003E&-\n    exit\n}\ntrap cleanup INT TERM EXIT\n\ngrpcurl \\\n   -H \"Authorization: Bearer $ACCESS_TOKEN\" \\\n   -protoset wgtwo.bin \\\n   -d @ \\\n   api.wgtwo.com:443 \\\n   wgtwo.lookup.v0.NumberLookupService\u002FNumberLookup \u003C&3 \\\n| while IFS= read -r LINE; do\n    # grpcurl sends output line by line, so we buffer until we have a valid JSON object.\n    BUFFER+=\"$LINE\"\n    if ! jq . \u003E\u002Fdev\u002Fnull 2\u003E&1 \u003C\u003C\u003C\"$BUFFER\"; then continue; fi\n\n    # Create a JSON response that includes the request and a dummy result.\n    RESPONSE_JSON=$(jq -c -n --argjson incoming_content \"$BUFFER\" \\\n      '{\n          number_lookup_request: $incoming_content,\n          result: {\n            name: \"John Doe\"\n          }\n      }'\n    )\n\n    # Send the response to grpcurl via the PIPE.\n    echo \"$RESPONSE_JSON\" \u003E $PIPE\n\n    echo \"Sent response:\"\n    echo \"$RESPONSE_JSON\" | jq .\n    echo \"\"\n\n    # Clear the buffer.\n    BUFFER=\"\"\ndone\n"},{"file":"examples\u002Fkotlin\u002Fthirdpartydev\u002Fnumber-lookup\u002Fsrc\u002Fmain\u002Fkotlin\u002Fcom\u002Fwgtwo\u002Fexamples\u002Fthirdpartydev\u002Fprovider\u002FProvider.kt","content":"package com.wgtwo.examples.thirdpartydev.numberlookup\n\nimport com.google.protobuf.util.Durations\nimport com.wgtwo.api.v0.lookup.NumberLookupProto.NumberLookupRequest\nimport com.wgtwo.api.v0.lookup.NumberLookupProto.NumberLookupResponse\nimport com.wgtwo.api.v0.lookup.NumberLookupServiceGrpcKt\nimport com.wgtwo.api.v0.lookup.cacheControl\nimport com.wgtwo.api.v0.lookup.numberLookupResponse\nimport com.wgtwo.api.v0.lookup.result\nimport com.wgtwo.auth.BearerTokenCallCredentials\nimport io.grpc.ManagedChannelBuilder\nimport kotlinx.coroutines.channels.Channel\nimport kotlinx.coroutines.delay\nimport kotlinx.coroutines.flow.catch\nimport kotlinx.coroutines.flow.collect\nimport kotlinx.coroutines.flow.flow\nimport kotlinx.coroutines.flow.onEach\nimport kotlinx.coroutines.flow.onStart\nimport kotlinx.coroutines.runBlocking\nimport java.util.concurrent.TimeUnit\nimport kotlin.time.Duration.Companion.seconds\n\nprivate val grpcChannel = ManagedChannelBuilder.forTarget(\"api.wgtwo.com:443\")\n    .keepAliveWithoutCalls(true)\n    .keepAliveTime(1, TimeUnit.MINUTES)\n    .keepAliveTimeout(10, TimeUnit.SECONDS)\n    .idleTimeout(1, TimeUnit.HOURS)\n    .build()\n\nprivate val stub = NumberLookupServiceGrpcKt.NumberLookupServiceCoroutineStub(grpcChannel)\n    .withCallCredentials(BearerTokenCallCredentials { \"MY ACCESS TOKEN\" })\n\nval phonebook = mapOf(\n    \"+4799999999\" to \"John Doe\",\n)\n\nsuspend fun startStream() {\n    val responseQueue = Channel\u003CNumberLookupResponse\u003E()\n\n    \u002F\u002F Check queue to see if we have any responses and send them over the wire\n    val responseFlow = flow {\n        for (response in responseQueue) {\n            emit(response)\n        }\n    }\n    stub.numberLookup(responseFlow)\n        .onStart { println(\"Starting new stream\") }\n        .onEach { request: NumberLookupRequest -\u003E\n            println(\"Got request for ${request.number.e164}\")\n            val displayName = phonebook.getOrDefault(request.number.e164, \"\")\n            val response = numberLookupResponse {\n                numberLookupRequest = request\n                result = result {\n                    name = displayName\n                }\n                cacheControl = cacheControl {\n                    maxAge = Durations.fromMinutes(60)\n                }\n            }\n            println(\"Sending response for ${response.numberLookupRequest.number.e164}: ${response.result.name}\")\n            responseQueue.send(response)\n        }\n        .catch { e -\u003E\n            println(\"Got error: ${e.message} - Will reconnect in 1s\")\n            delay(1.seconds)\n        }\n        .collect()\n}\n\nfun main() = runBlocking {\n    \u002F\u002F Run forever - if the stream fails we will reconnect\n    while (true) {\n        startStream()\n    }\n}\n"}]}},"context":{}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script><script src="/assets/js/app.2b855c93.js" defer></script><script src="/assets/js/page--src--templates--doc-page-vue.6382a886.js" defer></script><script src="/assets/js/vue-remark--docs--number-lookup-how-to-md.73775d6b.js" defer></script>
  </body>
</html>
