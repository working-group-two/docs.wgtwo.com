<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>Technical guide - WGTWO API v0 docs</title><meta name="gridsome:hash" content="a622655236582ccd8c0dd86453c8d3f676ca5c21"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.23"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/svg+xml" sizes="16x16" href="/assets/static/favicon.ce0531f.eedfceace0fdf708b118964642b27e62.svg"><link data-vue-tag="ssr" rel="icon" type="image/svg+xml" sizes="32x32" href="/assets/static/favicon.ac8d93a.eedfceace0fdf708b118964642b27e62.svg"><link data-vue-tag="ssr" rel="icon" type="image/svg+xml" sizes="96x96" href="/assets/static/favicon.b9532cc.eedfceace0fdf708b118964642b27e62.svg"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/svg+xml" sizes="76x76" href="/assets/static/favicon.f22e9f3.eedfceace0fdf708b118964642b27e62.svg"><link data-vue-tag="ssr" rel="stylesheet" href="https://cdn.materialdesignicons.com/5.4.55/css/materialdesignicons.min.css"><link data-vue-tag="ssr" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swagger-ui-dist@3.25.0/swagger-ui.css"><link rel="preload" href="/assets/css/0.styles.901f9d90.css" as="style"><link rel="preload" href="/assets/js/app.9473d5b5.js" as="script"><link rel="preload" href="/assets/js/page--src--templates--doc-page-vue.75275d53.js" as="script"><link rel="preload" href="/assets/js/vue-remark--docs--number-lookup-how-to-md.8ee1e976.js" as="script"><link rel="prefetch" href="/assets/js/page--node-modules--gridsome--app--pages--404-vue.386217dd.js"><link rel="prefetch" href="/assets/js/page--src--pages--index-vue.9d981fb9.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--call-forwarding-api-reference-md.e7e3243f.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--call-forwarding-md.0cc2641e.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--events-api-reference-md.a90fb3d3.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--events-configuration-md.2f1d5604.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--events-how-to-md.cf71560d.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--intro-client-and-languages-md.fd1968ce.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--intro-get-started-md.759fc1ed.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--intro-sandbox-md.0e82b4f7.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--metrics-how-to-md.aa701470.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--mms-api-reference-md.fffbd279.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--mms-send-how-to-md.91c02f03.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--number-lookup-api-reference-md.02a9dcad.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--number-lookup-overview-md.ca82fdd2.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--oauth-2-create-client-how-to-md.89322eae.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--oauth-2-get-client-access-token-md.72a32cc5.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--oauth-2-get-user-access-token-md.e98e2f49.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--oauth-2-overview-md.b35c794a.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--oauth-2-subscriber-deauthorization-md.20042d65.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--oauth-2-why-support-user-revoking-consent-md.3f788c86.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--provision-api-reference-2-md.eaeff63f.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--provision-how-to-md.75cb61ff.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--provision-overview-md.f4d460e5.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--provision-service-list-md.1aba7ff8.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--sipbreakout-api-reference-md.4f943c03.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--sipbreakout-how-to-md.4564e6d1.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--subscriber-location-how-to-md.b3d7a0c5.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--subscriber-location-reference-md.18e59692.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--voicemail-api-reference-md.31aae007.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--voicemail-how-to-md.ebf9d04f.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--webterminal-api-reference-md.b8a2d80e.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--webterminal-how-to-md.a70c4edd.js"><link rel="stylesheet" href="/assets/css/0.styles.901f9d90.css"><script data-vue-tag="ssr" src="https://cdn.jsdelivr.net/npm/swagger-ui-dist@3.25.0/swagger-ui-bundle.js"></script><script data-vue-tag="ssr" src="https://cdn.jsdelivr.net/npm/swagger-ui-dist@3.25.0/swagger-ui-standalone-preset.js"></script><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
  </head>
  <body >
    <div data-server-rendered="true" id="app" data-v-39f0b824 data-v-35cf879f><nav role="navigation" aria-label="main navigation" class="navbar topnav" data-v-c0e19ce6 data-v-39f0b824><div class="navbar-brand"><a href="/" exact="" to="/" class="navbar-item" data-v-c0e19ce6><svg id="logo_svg__aa853218-2cb3-4a2f-8b42-cf04e6fdcfc6" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 156.46 34.11" class="topnav__logo" data-v-c0e19ce6><defs><linearGradient id="logo_svg__ed710ca4-f54a-45c1-8930-1f1a79c7c165" x1="202.25" y1="417.5" x2="257.57" y2="417.5" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#009da5"></stop><stop offset="1" stop-color="#2a4292"></stop></linearGradient><linearGradient id="logo_svg__f5345778-3256-407e-a6a4-6478c034349f" x1="229.91" y1="426.57" x2="229.91" y2="426.57" xlink:href="#logo_svg__ed710ca4-f54a-45c1-8930-1f1a79c7c165"></linearGradient><style>.logo_svg__adfa6594-0c46-4152-b161-b53ae93774c2{fill:#221f20}</style></defs><path d="M257.25 401.71a2.42 2.42 0 00-2.1-1.22h-16.84a2.41 2.41 0 00-2.09 1.21l-14.77 25.57-12.59-22h11.24l5.27 9.22 2.89-4.71-4.65-8.13a2.43 2.43 0 00-2.11-1.22h-16.82a2.43 2.43 0 00-2.11 3.63l16.77 29.26a2.43 2.43 0 002.1 1.22 2.41 2.41 0 002.09-1.21l16.17-28H251l-12.68 21.93-3.93-6.86-2.89 4.71 4.7 8.21a2.44 2.44 0 002.1 1.22 2.41 2.41 0 002.09-1.21l16.9-29.21a2.43 2.43 0 00-.04-2.41z" transform="translate(-202.25 -400.44)" fill="url(#logo_svg__ed710ca4-f54a-45c1-8930-1f1a79c7c165)"></path><path d="M268.15 411.4l.38-.52h2.84l2.63 12.27h.29l3.1-12.27h3.92l3.1 12.27h.29l2.58-12.27h2.84l.38.52-3.25 14.71h-5.13l-2.78-11.43-2.76 11.43h-5.18zM293 421.53v-6.06q0-4.59 4.59-4.59h8.35v16.45q0 4.57-4.58 4.58h-5.57l-1.51-1.13V429h6.93a1.18 1.18 0 001.34-1.33v-1.51h-5q-4.55-.05-4.55-4.63zm3.4.29a1.17 1.17 0 001.33 1.33h4.82v-9.34h-4.85a1.19 1.19 0 00-1.33 1.36zM310.06 421.53V406.1h3.39v4.78h5.16v2.93h-5.16v8a1.17 1.17 0 001.33 1.33h4.12V425l-1.51 1.13h-2.75c-3.06-.02-4.58-1.55-4.58-4.6zM320.61 411.4l.38-.52h2.84l2.58 12.27h.29l3.1-12.27h3.92l3.1 12.27h.29l2.58-12.27h2.84l.38.52-3.25 14.71h-5.13l-2.78-11.43-2.75 11.43h-5.13zM345.52 421.53v-6.06q0-4.59 4.58-4.59h4.06q4.56 0 4.56 4.59v6.06q0 4.58-4.56 4.58h-4.06q-4.57 0-4.58-4.58zm3.39.29a1.18 1.18 0 001.34 1.33H354a1.19 1.19 0 001.36-1.33v-6.65a1.2 1.2 0 00-1.36-1.36h-3.74a1.2 1.2 0 00-1.34 1.36z" transform="translate(-202.25 -400.44)" class="logo_svg__adfa6594-0c46-4152-b161-b53ae93774c2"></path></svg></a></div><div class="navbar-menu"><div class="navbar-start"></div><div class="navbar-end"><div class="navbar-item has-dropdown" data-v-39f0b824><a aria-haspopup="true" tabindex="0" class="navbar-link">v0</a><div class="navbar-dropdown"><a href="https://v1.docs.wgtwo.com/" class="navbar-item" data-v-39f0b824>v1</a></div></div><!----><div class="role-selection-container"><button type="button" class="button button is-role role-selection-button"><!----><span><span>Viewing docs</span><span class="icon"><i class="mdi mdi-chevron-down mdi-24px"></i></span></span><!----></button></div></div></div></nav><main class="main" data-v-39f0b824><nav class="docsnav-container is-hidden-touch" data-v-39f0b824><div class="docsnav" data-v-39f0b824><div class="docs-nav__container" data-v-39f0b824 data-v-35cf879f><h3 class="is-uppercase" data-v-39f0b824 data-v-35cf879f>
        intro
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-35cf879f><li data-v-35cf879f><a href="/intro/get-started/" class="dosc_nav__anchor" data-v-35cf879f>Get started</a></li><li data-v-35cf879f><a href="/intro/api-structure-and-libraries/" class="dosc_nav__anchor" data-v-35cf879f>API structure and libraries</a></li><li data-v-35cf879f><a href="/intro/sandbox-environment/" class="dosc_nav__anchor" data-v-35cf879f>Sandbox Environment</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-35cf879f><h3 class="is-uppercase" data-v-39f0b824 data-v-35cf879f>
        oauth 2.0
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-35cf879f><li data-v-35cf879f><a href="/oauth-2-0/overview/" class="dosc_nav__anchor" data-v-35cf879f>Overview</a></li><li data-v-35cf879f><a href="/oauth-2-0/create-o-auth-2-0-client/" class="dosc_nav__anchor" data-v-35cf879f>Create OAuth 2.0 client</a></li><li data-v-35cf879f><a href="/oauth-2-0/get-user-access-token/" class="dosc_nav__anchor" data-v-35cf879f>Get user access token</a></li><li data-v-35cf879f><a href="/oauth-2-0/get-client-access-token/" class="dosc_nav__anchor" data-v-35cf879f>Get client access token</a></li><li data-v-35cf879f><a href="/oauth-2-0/support-revoking-consent/" class="dosc_nav__anchor" data-v-35cf879f>Support revoking consent</a></li><li data-v-35cf879f><a href="/oauth-2-0/why-support-user-revoking-of-consent/" class="dosc_nav__anchor" data-v-35cf879f>Why support user revoking of consent</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-35cf879f><h3 class="is-uppercase" data-v-39f0b824 data-v-35cf879f>
        mms
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-35cf879f><li data-v-35cf879f><a href="/mms/send-mms/" class="dosc_nav__anchor" data-v-35cf879f>Send MMS</a></li><li data-v-35cf879f><a href="/mms/mms-api-reference/" class="dosc_nav__anchor" data-v-35cf879f>MMS API reference</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-35cf879f><h3 class="is-uppercase" data-v-39f0b824 data-v-35cf879f>
        events
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-35cf879f><li data-v-35cf879f><a href="/events/listen-for-events/" class="dosc_nav__anchor" data-v-35cf879f>Listen for events</a></li><li data-v-35cf879f><a href="/events/configuration-and-types/" class="dosc_nav__anchor" data-v-35cf879f>Configuration and types</a></li><li data-v-35cf879f><a href="/events/events-api-reference/" class="dosc_nav__anchor" data-v-35cf879f>Events API reference</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-35cf879f><h3 class="is-uppercase" data-v-39f0b824 data-v-35cf879f>
        voicemail
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-35cf879f><li data-v-35cf879f><a href="/voicemail/list-play-delete-and-configure-voicemails/" class="dosc_nav__anchor" data-v-35cf879f>List, play, delete and configure voicemails</a></li><li data-v-35cf879f><a href="/voicemail/voicemail-api-reference/" class="dosc_nav__anchor" data-v-35cf879f>Voicemail API reference</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-35cf879f><h3 class="is-uppercase" data-v-39f0b824 data-v-35cf879f>
        subscription profile
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-35cf879f><li data-v-35cf879f><a href="/subscription-profile/overview/" class="dosc_nav__anchor" data-v-35cf879f>Overview</a></li><li data-v-35cf879f><a href="/subscription-profile/manage-subscriptions/" class="dosc_nav__anchor" data-v-35cf879f>Manage subscriptions</a></li><li data-v-35cf879f><a href="/subscription-profile/subscription-profile-api-reference/" class="dosc_nav__anchor" data-v-35cf879f>Subscription profile API reference</a></li><li data-v-35cf879f><a href="/subscription-profile/subscription-services/" class="dosc_nav__anchor" data-v-35cf879f>Subscription services</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-35cf879f><h3 class="is-uppercase" data-v-39f0b824 data-v-35cf879f>
        network information
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-35cf879f><li data-v-35cf879f><a href="/network-information/get-subscriber-network-information/" class="dosc_nav__anchor" data-v-35cf879f>Get subscriber network information</a></li><li data-v-35cf879f><a href="/network-information/network-info-api/" class="dosc_nav__anchor" data-v-35cf879f>Network info API</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-35cf879f><h3 class="is-uppercase" data-v-39f0b824 data-v-35cf879f>
        call forwarding
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-35cf879f><li data-v-35cf879f><a href="/call-forwarding/set-call-forwarding/" class="dosc_nav__anchor" data-v-35cf879f>Set call forwarding</a></li><li data-v-35cf879f><a href="/call-forwarding/call-forwarding-api-reference/" class="dosc_nav__anchor" data-v-35cf879f>Call forwarding API reference</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-35cf879f><h3 class="is-uppercase" data-v-39f0b824 data-v-35cf879f>
        pbx
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-35cf879f><li data-v-35cf879f><a href="/pbx/pbx-tas-integration/" class="dosc_nav__anchor" data-v-35cf879f>PBX/TAS integration</a></li><li data-v-35cf879f><a href="/pbx/api-reference/" class="dosc_nav__anchor" data-v-35cf879f>API reference</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-35cf879f><h3 class="is-uppercase" data-v-39f0b824 data-v-35cf879f>
        number lookup
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-35cf879f><li data-v-35cf879f><a href="/number-lookup/overview/" class="dosc_nav__anchor" data-v-35cf879f>Overview</a></li><li class="active--exact active" data-v-35cf879f><a href="/number-lookup/technical-guide/" aria-current="page" class="dosc_nav__anchor" data-v-35cf879f>Technical guide</a></li><li data-v-35cf879f><a href="/number-lookup/api-reference/" class="dosc_nav__anchor" data-v-35cf879f>API reference</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-35cf879f><h3 class="is-uppercase" data-v-39f0b824 data-v-35cf879f>
        metrics
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-35cf879f><li data-v-35cf879f><a href="/metrics/accessing-metrics/" class="dosc_nav__anchor" data-v-35cf879f>Accessing Metrics</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-35cf879f><h3 class="is-uppercase" data-v-39f0b824 data-v-35cf879f>
        web terminal
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-35cf879f><li data-v-35cf879f><a href="/web-terminal/create-a-web-terminal-to-make-and-receive-calls/" class="dosc_nav__anchor" data-v-35cf879f>Create a Web Terminal to make and receive calls</a></li><li data-v-35cf879f><a href="/web-terminal/web-terminal-api-reference/" class="dosc_nav__anchor" data-v-35cf879f>Web Terminal API reference</a></li></ul></div></div></nav><div class="doc-main-container" data-v-39f0b824><div class="article-container" data-v-39f0b824><div class="is-flex" data-v-39f0b824><div class="article" data-v-39f0b824><article role="alert" class="notification is-warning is-light" data-v-35cf879f><button type="button" aria-label="Close notification" class="delete"></button><div class="media"><!----><div class="media-content"><div class="is-flex" data-v-35cf879f><span class="icon is-large" style="margin-right:16px;" data-v-35cf879f><i class="mdi mdi-information mdi-48px"></i></span><div data-v-35cf879f>
        This documentation is for v0 of our APIs and might change. See
        <a href="https://v1.docs.wgtwo.com" data-v-35cf879f>https://v1.docs.wgtwo.com</a> for
        our guaranteed stable APIs.
      </div></div></div></div><!----></article><div data-v-39f0b824 data-v-35cf879f><div id="content" class="content" data-v-39f0b824 data-v-35cf879f><div><h1 id="number-lookup-api---technical-guide"><a href="#number-lookup-api---technical-guide" aria-hidden="true">#</a>Number Lookup API - Technical Guide</h1><blockquote><p><strong>This guide will show you how to set up a Number Lookup Provider.</strong></p><p>You should have an understanding of how this works before continuing,
see <a href="number-lookup/setup-number-lookup-overview/">Overview</a>.</p></blockquote><h2 id="prerequisites"><a href="#prerequisites" aria-hidden="true">#</a>Prerequisites</h2><p>This guide assumes you are able to create a OAuth 2.0 client and get an access token.</p><p>See <a href="https://docs.wgtwo.com/guide/oauth2/get-client-access-token.html" target="_blank" rel="nofollow noopener noreferrer">Get client access token</a> for how to get the
access token.</p><blockquote><p><strong>Note:</strong><br>
For testing using our sandbox endpoint, authentication headers may be skipped.</p></blockquote><h3 id="required-scope"><a href="#required-scope" aria-hidden="true">#</a>Required scope</h3><p><code>lookup.number:read</code></p><h2 id="how-to-use-the-api"><a href="#how-to-use-the-api" aria-hidden="true">#</a>How to use the API</h2><p>When you connect to this API, you will get a stream of number lookup requests for which you should respond with
information about the number.</p><div class="language-tabs" data-v-33cce47c><div class="b-tabs" data-v-33cce47c><nav role="tablist" aria-orientation="horizontal" class="tabs"><ul></ul></nav><section class="tab-content"><div class="tab-item" role="tabpanel" id="739-content" aria-labelledby="739-label" tabindex="-1" style="display:none;" data-v-33cce47c><div><pre class="language-bash"><code class="language-bash"><span class="token shebang important">#!/usr/bin/env bash</span>

<span class="token comment"># Download the API definition</span>
<span class="token function">curl</span> -sL <span class="token string">'https://github.com/working-group-two/wgtwoapis/blob/master/image.bin?raw=true'</span> -o proto/wgtwo.bin

<span class="token comment"># Access token must be obtained via the client credentials flow</span>
<span class="token assign-left variable">ACCESS_TOKEN</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>
  <span class="token function">curl</span> -s -u $CLIENT_ID:$CLIENT_SECRET <span class="token punctuation">\</span>
    --request POST <span class="token punctuation">\</span>
    --url <span class="token string">'https://id.wgtwo.com/oauth2/token'</span> <span class="token punctuation">\</span>
    --header <span class="token string">'content-type: application/x-www-form-urlencoded'</span> <span class="token punctuation">\</span>
    --data <span class="token assign-left variable">grant_type</span><span class="token operator">=</span><span class="token string">"client_credentials"</span> <span class="token punctuation">\</span>
    --data <span class="token assign-left variable">scope</span><span class="token operator">=</span><span class="token string">"lookup.number:read"</span> <span class="token punctuation">\</span>
  <span class="token operator">|</span> jq -r .access_token
<span class="token variable">)</span></span>

<span class="token comment"># We send data to grpcurl via a PIPE, and receive data via stdout.</span>
<span class="token assign-left variable">PIPE</span><span class="token operator">=</span>/tmp/provider-PIPE
<span class="token function">mkfifo</span> <span class="token variable">$PIPE</span>
<span class="token builtin class-name">exec</span> <span class="token operator"><span class="token file-descriptor important">3</span>&lt;></span> <span class="token variable">$PIPE</span>

<span class="token function-name function">cleanup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"Cleaning up..."</span>
    <span class="token function">rm</span> -f <span class="token variable">$PIPE</span>
    <span class="token builtin class-name">exec</span> <span class="token operator"><span class="token file-descriptor important">3</span>>&amp;</span>-
    <span class="token builtin class-name">exit</span>
<span class="token punctuation">}</span>
<span class="token builtin class-name">trap</span> cleanup INT <span class="token environment constant">TERM</span> EXIT

grpcurl <span class="token punctuation">\</span>
   -H <span class="token string">"Authorization: Bearer <span class="token variable">$ACCESS_TOKEN</span>"</span> <span class="token punctuation">\</span>
   -protoset wgtwo.bin <span class="token punctuation">\</span>
   -d @ <span class="token punctuation">\</span>
   api.wgtwo.com:443 <span class="token punctuation">\</span>
   wgtwo.lookup.v0.NumberLookupService/NumberLookup <span class="token operator">&lt;</span><span class="token file-descriptor important">&amp;3</span> <span class="token punctuation">\</span>
<span class="token operator">|</span> <span class="token keyword">while</span> <span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span> <span class="token builtin class-name">read</span> -r LINE<span class="token punctuation">;</span> <span class="token keyword">do</span>
    <span class="token comment"># grpcurl sends output line by line, so we buffer until we have a valid JSON object.</span>
    <span class="token assign-left variable">BUFFER</span><span class="token operator">+=</span><span class="token string">"<span class="token variable">$LINE</span>"</span>
    <span class="token keyword">if</span> <span class="token operator">!</span> jq <span class="token builtin class-name">.</span> <span class="token operator">></span>/dev/null <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&lt;&lt;&lt;</span><span class="token string">"<span class="token variable">$BUFFER</span>"</span><span class="token punctuation">;</span> <span class="token keyword">then</span> <span class="token builtin class-name">continue</span><span class="token punctuation">;</span> <span class="token keyword">fi</span>

    <span class="token comment"># Create a JSON response that includes the request and a dummy result.</span>
    <span class="token assign-left variable">RESPONSE_JSON</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>jq -c -n --argjson incoming_content <span class="token string">"<span class="token variable">$BUFFER</span>"</span> <span class="token punctuation">\</span>
      <span class="token string">'{
          number_lookup_request: $incoming_content,
          result: {
            name: "John Doe"
          }
      }'</span>
    <span class="token variable">)</span></span>

    <span class="token comment"># Send the response to grpcurl via the PIPE.</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$RESPONSE_JSON</span>"</span> <span class="token operator">></span> <span class="token variable">$PIPE</span>

    <span class="token builtin class-name">echo</span> <span class="token string">"Sent response:"</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$RESPONSE_JSON</span>"</span> <span class="token operator">|</span> jq <span class="token builtin class-name">.</span>
    <span class="token builtin class-name">echo</span> <span class="token string">""</span>

    <span class="token comment"># Clear the buffer.</span>
    <span class="token assign-left variable">BUFFER</span><span class="token operator">=</span><span class="token string">""</span>
<span class="token keyword">done</span>
</code></pre><figcaption><a href="https://github.com/working-group-two/docs.wgtwo.com/blob/master/examples/grpcurl/thirdpartydev/number-lookup/provider.sh" target="_blank" class="github-link">provider.sh</a></figcaption></div></div><!----><div class="tab-item" role="tabpanel" id="741-content" aria-labelledby="741-label" tabindex="-1" class="content" style="display:none;" data-v-33cce47c><div class="collapse card" data-v-33cce47c><div class="collapse-trigger"><div role="button" class="card-header" data-v-33cce47c><p class="card-header-title" data-v-33cce47c>
            Install dependencies
          </p><a class="card-header-icon" data-v-33cce47c><span class="icon" data-v-33cce47c><i class="mdi mdi-menu-up mdi-24px"></i></span></a></div></div><div id="" class="collapse-content" style="display:none;"><div class="card-content" data-v-33cce47c><div data-v-33cce47c><pre class="language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.wgtwo.api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>auth<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>0.0.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.wgtwo.api.v0.grpc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>lookup<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>0.1.6<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>depenencies</span><span class="token punctuation">></span></span></code></pre></div></div></div></div><div class="is-size-4 mt-4" data-v-33cce47c>
        Snippet
      </div><div><pre class="language-kt"><code class="language-kt"><span class="token keyword">package</span> com<span class="token punctuation">.</span>wgtwo<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>thirdpartydev<span class="token punctuation">.</span>numberlookup

<span class="token keyword">import</span> com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>protobuf<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Durations
<span class="token keyword">import</span> com<span class="token punctuation">.</span>wgtwo<span class="token punctuation">.</span>api<span class="token punctuation">.</span>v0<span class="token punctuation">.</span>lookup<span class="token punctuation">.</span>NumberLookupProto<span class="token punctuation">.</span>NumberLookupRequest
<span class="token keyword">import</span> com<span class="token punctuation">.</span>wgtwo<span class="token punctuation">.</span>api<span class="token punctuation">.</span>v0<span class="token punctuation">.</span>lookup<span class="token punctuation">.</span>NumberLookupProto<span class="token punctuation">.</span>NumberLookupResponse
<span class="token keyword">import</span> com<span class="token punctuation">.</span>wgtwo<span class="token punctuation">.</span>api<span class="token punctuation">.</span>v0<span class="token punctuation">.</span>lookup<span class="token punctuation">.</span>NumberLookupServiceGrpcKt
<span class="token keyword">import</span> com<span class="token punctuation">.</span>wgtwo<span class="token punctuation">.</span>api<span class="token punctuation">.</span>v0<span class="token punctuation">.</span>lookup<span class="token punctuation">.</span>cacheControl
<span class="token keyword">import</span> com<span class="token punctuation">.</span>wgtwo<span class="token punctuation">.</span>api<span class="token punctuation">.</span>v0<span class="token punctuation">.</span>lookup<span class="token punctuation">.</span>numberLookupResponse
<span class="token keyword">import</span> com<span class="token punctuation">.</span>wgtwo<span class="token punctuation">.</span>api<span class="token punctuation">.</span>v0<span class="token punctuation">.</span>lookup<span class="token punctuation">.</span>result
<span class="token keyword">import</span> com<span class="token punctuation">.</span>wgtwo<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>BearerTokenCallCredentials
<span class="token keyword">import</span> io<span class="token punctuation">.</span>grpc<span class="token punctuation">.</span>ManagedChannelBuilder
<span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>channels<span class="token punctuation">.</span>Channel
<span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>delay
<span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>catch
<span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>collect
<span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>flow
<span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>onEach
<span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>onStart
<span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>runBlocking
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>TimeUnit
<span class="token keyword">import</span> kotlin<span class="token punctuation">.</span>time<span class="token punctuation">.</span>Duration<span class="token punctuation">.</span>Companion<span class="token punctuation">.</span>seconds

<span class="token keyword">private</span> <span class="token keyword">val</span> grpcChannel <span class="token operator">=</span> ManagedChannelBuilder<span class="token punctuation">.</span><span class="token function">forTarget</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"api.wgtwo.com:443"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">keepAliveWithoutCalls</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">keepAliveTime</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> TimeUnit<span class="token punctuation">.</span>MINUTES<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">keepAliveTimeout</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> TimeUnit<span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">idleTimeout</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> TimeUnit<span class="token punctuation">.</span>HOURS<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">private</span> <span class="token keyword">val</span> stub <span class="token operator">=</span> NumberLookupServiceGrpcKt<span class="token punctuation">.</span><span class="token function">NumberLookupServiceCoroutineStub</span><span class="token punctuation">(</span>grpcChannel<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withCallCredentials</span><span class="token punctuation">(</span>BearerTokenCallCredentials <span class="token punctuation">{</span> <span class="token string-literal singleline"><span class="token string">"MY ACCESS TOKEN"</span></span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">val</span> phonebook <span class="token operator">=</span> <span class="token function">mapOf</span><span class="token punctuation">(</span>
    <span class="token string-literal singleline"><span class="token string">"+4799999999"</span></span> <span class="token keyword">to</span> <span class="token string-literal singleline"><span class="token string">"John Doe"</span></span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>

<span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">startStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> responseQueue <span class="token operator">=</span> Channel<span class="token operator">&lt;</span>NumberLookupResponse<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// Check queue to see if we have any responses and send them over the wire</span>
    <span class="token keyword">val</span> responseFlow <span class="token operator">=</span> flow <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>response <span class="token keyword">in</span> responseQueue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">emit</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    stub<span class="token punctuation">.</span><span class="token function">numberLookup</span><span class="token punctuation">(</span>responseFlow<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">onStart</span> <span class="token punctuation">{</span> <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"Starting new stream"</span></span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
        <span class="token punctuation">.</span><span class="token function">onEach</span> <span class="token punctuation">{</span> request<span class="token operator">:</span> NumberLookupRequest <span class="token operator">-></span>
            <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"Got request for </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">request<span class="token punctuation">.</span>number<span class="token punctuation">.</span>e164</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">val</span> displayName <span class="token operator">=</span> phonebook<span class="token punctuation">.</span><span class="token function">getOrDefault</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>number<span class="token punctuation">.</span>e164<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">""</span></span><span class="token punctuation">)</span>
            <span class="token keyword">val</span> response <span class="token operator">=</span> numberLookupResponse <span class="token punctuation">{</span>
                numberLookupRequest <span class="token operator">=</span> request
                result <span class="token operator">=</span> result <span class="token punctuation">{</span>
                    name <span class="token operator">=</span> displayName
                <span class="token punctuation">}</span>
                cacheControl <span class="token operator">=</span> cacheControl <span class="token punctuation">{</span>
                    maxAge <span class="token operator">=</span> Durations<span class="token punctuation">.</span><span class="token function">fromMinutes</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"Sending response for </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">response<span class="token punctuation">.</span>numberLookupRequest<span class="token punctuation">.</span>number<span class="token punctuation">.</span>e164</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">response<span class="token punctuation">.</span>result<span class="token punctuation">.</span>name</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            responseQueue<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token punctuation">.</span><span class="token function">catch</span> <span class="token punctuation">{</span> e <span class="token operator">-></span>
            <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"Got error: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">e<span class="token punctuation">.</span>message</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> - Will reconnect in 1s"</span></span><span class="token punctuation">)</span>
            <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">.</span>seconds<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> runBlocking <span class="token punctuation">{</span>
    <span class="token comment">// Run forever - if the stream fails we will reconnect</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">startStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><figcaption><a href="https://github.com/working-group-two/docs.wgtwo.com/blob/master/examples/kotlin/thirdpartydev/number-lookup/src/main/kotlin/com/wgtwo/examples/thirdpartydev/provider/Provider.kt" target="_blank" class="github-link">Provider.kt</a></figcaption></div></div></section></div></div><h2 id="flow"><a href="#flow" aria-hidden="true">#</a>Flow</h2><p>The API is implemented as a bidirectional gRPC service, where the provider responds to requests from the server.</p><p>The Number Provider sets up one or more connections to our API. This connection should use keep-alive, and has a max
connection age of one hour +/- a 10 % jitter. Once max connection age is reached, or any exception occurs, the
connection should be re-established.</p><blockquote><p><strong>Note:</strong><br>
Although the connection is set up from the provider to wg2, all requests are initiated from wg2.</p></blockquote><p><img src="data:image/svg+xml,%3csvg fill='none' viewBox='0 0 492 214' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-19e2d937fd954ef8eb4c9be5cfe344b9'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-19e2d937fd954ef8eb4c9be5cfe344b9)' width='492' height='214' xlink:href='data:image/svg%2bxml%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAAcCAYAAADRJblSAAAACXBIWXMAAAsTAAALEwEAmpwYAAABIUlEQVRYw%2b2ZzQ7BQBCASx28ghNv4Swq3sDNyREJD8CBZ/EkEoLiIITEE4gDTn7aMo2ZpLeutduozCZf2jTdne4308usYbxHQpK/GQNgA9jAIoQ5sgLyOD%2bp8dt80SbGUIkZTOIaeEpQxvmmho3Tmk3gCGyBvSJ2wAGoUrApbugOOAI88P2ixgpI4bUnmRwRWhTMxgeOwCQPcPHe0lgBJKCDsa4YVwU3XLMeBwHdQHWqyjxVcIMFsAAWwAJYAAtgASyABbAAFsACWAALYAEs4Nc7Qo4iYtUR6mvsCbYp2CxQGl4IbkCUpbEpSlJr2MUdARNFjPEYoELBlpIGSxorINIxxMyegIsAZ/wnCxEcjHxzciV8spUBckD2A/z303HP/At9kW9/2aglUQAAAABJRU5ErkJggg==' /%3e%3c/svg%3e" width="492" data-src="/assets/static/number-lookup-flow.726e733.be2bb1c52bff4bf4ca6b4dad6ad746f4.svg" data-srcset="/assets/static/number-lookup-flow.726e733.be2bb1c52bff4bf4ca6b4dad6ad746f4.svg 492w" data-sizes="(max-width: 492px) 100vw, 492px" class="g-image g-image--lazy g-image--loading"><noscript><img src="/assets/static/number-lookup-flow.726e733.be2bb1c52bff4bf4ca6b4dad6ad746f4.svg" class="g-image g-image--loaded" width="492"></noscript></p><p>Using round-robin, wg2 will send number lookup requests
over these connections for which the provider will respond with the display name.</p><p>Responses will be cached for a period of time to avoid unnecessary requests and latency.</p><p><img src="data:image/svg+xml,%3csvg fill='none' viewBox='0 0 865 647' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-646a1681a7624e00710d04140c8dc74e'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-646a1681a7624e00710d04140c8dc74e)' width='865' height='647' xlink:href='data:image/svg%2bxml%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAAwCAYAAAChS3wfAAAACXBIWXMAAAsTAAALEwEAmpwYAAAJsElEQVRo3t1aa0wVSRbu5j4AeV10gBEGZ9AlKuOwyjDMLMQfsIy7rhsSZzabnf1FNhGiJuoSs0aN0V0fgwbfbxScVZlgNkYJuqgkKKK8QR4iTwFBzCrgExG4yN3zlVU3LXqx74WIdyo5qeru%2bqq7Tp1T55zqI0lUsrKyUEnnz583XL9%2b/bcFBQVRIGpH5eXlRV27do3V%2bfn5uB9ZWFgYffXq1bDZs2fLwJ07d47VFy5cmESYaPQRYwAL4liB/5bwXwFjMpmkjRs3SsOKzOsfiP5B5CBZX5YR/U1Vz4qKCg3qsrKyPzx69MjU2dnJ6OHDh6YnT56YHj9%2bzOru7m7T/fv3TT09PabW1taWVatWuQJXWlqqRV1ZWfmn58%2bfmx48eGAeA1hQV1cXuwa%2bt7cX%2bDqCMNzevXvfNnkXoufgEVEIv/cuRghsAMeBvIY9e7NUVVUxBpSXl8/HJOlDB4lelpSUDNFqDRUVFQ3l5OQM3blzZ4gmMghmtLe3N65du9aV47R8nO%2bfPXsG/AAxYQhUXV09RKs%2b1NzcPERjDxEDBtGH8DcJogNu//79lj4tnuhHIr2Vq4/Jrif6u6reCgb8HqtH1E8famxoaDCSdBhpEkZigrGtrc2IZ5AMatevWbPGlUuOYMB3kCDq0wc81cZbt24Zc3NzjcQ8IzHGSPf7IRGErxISsG/fPmlci2DAjRs3YgYHB00vXrxgNDAwYMK10Wg0vXz50tTf32%2bCiKPQCv6PJMCNM46tJDHqL3iGPmIMYDEGsLhW4O8ICUhKSnrte1xdXV/Ju4ODlkhnzVx0ulfdZVl2Eli9/h0CRCLKdIs2q1l1dXWnGhsbTxKlkQSk1dfX/0yUTsSu8aypqek/NTU1SYsWLdJxHMOTunxJ%2bNP0/ATwIODpXrq4pjEE/kehlwsWLLD0aR5En9gg/ii/IpqsGkU6apP0iA2MRNom/LRp05SXWuVmlZCQIMfHxzPmLl68WNV46enprM7IyJDJurCxUlNTRwZ1dHSwmnZmmCUHBclk1nQ02ASYK1ID8zO0d%2b7cyXAtLS3mcYbjMzMz9VQzGTx58iRTNR8fH19nZ%2bdQan5B9BuiML5i4coN78iRI9qUlBR2TbUqBhw6dIjVhw8f1iUnJ%2buV9ywWsuOCaxLZZ4kmLZ0%2bfVoMqDl48KAj2idOnIC4s%2bdXrlwx44HjfoSUnZ0t3b17V5o7d67E7bxM/gJEkSn2rFmzJEdHRw10lC4FeXKz5yh8A5QDBw5oifS8rYoBoh9ZFp212LcORJM3M4Bqm8Tc399/JhZebX%2byLuLdWiK9Ne8W/ajWCex4MQAbmJ%2bHh8cnkZGRbIVp1adQ7fwu4LFjx8aUATYt3BgwYCLRTCcnp88nT54M/Q4kCiYyWPFuu2aAuQidtuHd48eA2NhYVsPWx8XFYYNycHFx0ajFe3t7s3rz5s2a4OBgbIKamJgYVdjjx4%2bPPwNGWwQDUSZNmgTzNkEtdt26dePPADJVzIkgHZ5BNvuvcNiIvlNEVyOWtLQ0VpOvoCEVYJKzcOFCVe%2bmwOuDkAAtr/%2bpCC1BX6oJTUWAAz8iMTHRSelvKMoMok8VGyScos8Ukxk/BlBAwiTAzc3N393dPZKa3/APtnoTpbaThQ9x5aoBy%2bAObVGqCrmy2l27drENePr06fa1BwyzIk62fAisR21trdYazJgxYMmSJa/OlZYt0y5fvhyrIk%2bcONHhPTBAw71Gdz8/Py9yqeFQuZITZeDPRix9fX3Cm9RTPDB%2bnuAoGIAQezZUjjbir8mThNp9TvQ1V5MRS0hIiLmdlJSkLhj6wBigVAGHixcv6mzQQBeDwTAHeFxs377dvhgwdepUsYLaPXv2sFUMCgqy5vP15H5/evv2bbZ/7N69%2b70wQB4rBpDnKQ5btBTWMgbEx8erwoaFhZnbtPKjV4Hk5GQNmSI2geLi4vciAaOJBerq6li9YcMGPU189Jvgli1bNNXV1UwPw8PD3xrxcecoRBnpjRcDxjwaxIlOVFSUJz%2b5eUPX%2bKRhqj5W9lm6dKkYx74ZgEIbSjB3Wa0udi8BpEtakgKlN2ZQrDoI/wY%2b4rUrf0aRs4vMJQE7OWMA1fbHgKNHj2q2bdumFH/E9qHcMZkjvfoPh63317wGfaH8oZGVlcU%2b5NSpU/bHAKUZjIiIsHocCqVDoqOjsYdIvr6%2bsl0ygNqOShNjTfHy8vJev369s43v/rAYYMOpcDCF0gEUymIDDaKAZib39X/5h6J8D/iYIkjf4OBgX%2bwdxABvNRHdL%2b5UeBTvtl8GBAYGmh0pHx8fhLeq9wHhzyMWsFsGrFixwnyq4%2b/vP0OyPssDUZw2MTHRkTtjsl0xAD9SUfBfAFKA9rx589RAZZ1Oxxyvmpoa84my2lJaWireOzbBkK0MEHk/iCbpY5j4X7p0SVUsz52scL1eH%2bHh4RHET4wj1JwIiYANkifC4XGRgFFEgzJZEPQ3BAQEeIaGhsKJmkAWxF2NBRHHalOmTPHNyclhkkSerDqxKSoqkltaWrTt7e2a1tZWbW9vr%2bby5cuOZ8%2bedcHxEk5Y2traNPRc29jYqElISBA4VpeVlcnNzc1mfE9PjyY3N9ciXqHrlo7EZGtVQBy3k%2bR8JY7EVP2bLCkpsclkkZfH6vLyclkao%2bLp6cnGysjI0MTGxjL1MRgMqsYnv0MWk960aRNTAZKGkbEFBQWsQ15eXlBtbe1xWp3UhoaG1KamJtQ/Ef2bt48RpSBR6ubNm1vi4uJ0HOfAx5lD%2bJ/peQrwoPr6%2bp%2bIxJgCn0b4f4ljtB07dlj6NERPlfys4Y1jtxGO5aAuEMv/qrI%2blZWVIk%2bQpcn19fUxevr0KcvqBCE7FPfQRiFRfrB69Wo3LvqMEVVVVT/gGfqIMUBIj8M9pMop8O3CLbaQJ4h9AMlHkF9xIqo2U9SP4x4pTqlUZYqaEyWJBvLz843Z2dlG2geMZ86cMZIUGLu6ukZMlEQSZGdnpzlRsri42JiZmcmSLru7u9UmSoqP/Yz/I7Cl4F9CoCrJUSRKzuc5vUh1xQQG7927x6ijo2MQ12AMJkAbWcPwVNnq6urvkUYLBqAvUm6BJcYNIkUW18BDsghfLY2cKitbOnFWY0mswtLENdwa/BEiig8EIacXBPEHoY3JI/uTrMW9lStXuvINlDGgoqLiz1AhMEGMARyyQ4HFNfDIOkWytZCAEU6KnCUVKTUWio9qrPgfT%2bLuSSL7OxLpecSM14gmaW7T8/mFhYXhMTExMndwZD7OR4SfPxxP91675vhvxG69detWi394iLxtZAA2Ts93dfo/5/sDwXsUSvgAAAAASUVORK5CYII=' /%3e%3c/svg%3e" width="865" data-src="/assets/static/number-lookup-sequence.f86bfa7.c12b74c059c8d166618749f8d2acae59.svg" data-srcset="/assets/static/number-lookup-sequence.82a2fbd.c12b74c059c8d166618749f8d2acae59.svg 480w, /assets/static/number-lookup-sequence.f86bfa7.c12b74c059c8d166618749f8d2acae59.svg 865w" data-sizes="(max-width: 865px) 100vw, 865px" class="g-image g-image--lazy g-image--loading"><noscript><img src="/assets/static/number-lookup-sequence.f86bfa7.c12b74c059c8d166618749f8d2acae59.svg" class="g-image g-image--loaded" width="865"></noscript></p><h2 id="request--response"><a href="#request--response" aria-hidden="true">#</a>Request / Response</h2><p>For matching the response to the original request, the provider must include the original request in the response.</p><p>The returned display name may be empty if the provider does not have a display name for the number, and
may be cached for the duration specified.</p><h3 id="request"><a href="#request" aria-hidden="true">#</a>Request</h3><pre class="language-prototext"><code class="language-prototext">NumberLookupRequest {
  id: &quot;opaque string&quot;
  number {
    e164: &quot;+1234567890&quot;
  }
}</code></pre><h3 id="response"><a href="#response" aria-hidden="true">#</a>Response</h3><pre class="language-prototext"><code class="language-prototext">NumberLookupResponse {
  number_lookup_request { } # Fields omitted for brevity

  result {
    name: &quot;John Doe&quot;
  }
}</code></pre><h3 id="response-upstream-error"><a href="#response-upstream-error" aria-hidden="true">#</a>Response, upstream error</h3><pre class="language-prototext"><code class="language-prototext">NumberLookupResponse {
  number_lookup_request { } # Fields omitted for brevity

  error {
    message: &quot;Database unavailable&quot;
  }
}</code></pre><h2 id="limitations-for-display-name"><a href="#limitations-for-display-name" aria-hidden="true">#</a>Limitations for display name</h2><p>The display name returned must be max 60 characters, and may only contain the following:</p><ul><li>alphanumeric (<code>a-z</code>, <code>A-Z</code>, <code>0-9</code>)</li><li><code></code> (space), <code>-</code>, <code>_</code></li><li><code>.</code>, <code>!</code>, <code>%</code>, <code>*</code>, <code>'</code>, <code>+</code>, <code>~</code>, <code>`</code></li></ul><p>Characters not matching the above will be stripped.</p><h2 id="error-handling"><a href="#error-handling" aria-hidden="true">#</a>Error handling</h2><p>If there are no healthy connections for the provider, the provider will be ignored.</p><p>Should the provider fail to respond within the set deadline, it will be treated as if it returned an empty result.</p><p>For upstream errors, the provider must return an error, accompanied by a descriptive, human-readable message.</p><h2 id="cache"><a href="#cache" aria-hidden="true">#</a>Cache</h2><p>As part of the response, the provider can include a cache TTL.</p><p>This is the time in seconds that the display name should be cached on the wg2 side.
If not set, a default cache TTL documented in the proto file will be used.</p><pre class="language-prototext"><code class="language-prototext">NumberLookupResponse {
  number_lookup_request { } # Fields omitted for brevity

  result {
    name: &quot;John Doe&quot;
  }

  # Optional, set to default if not set
  cache_control {
    max_age {
      seconds: 3600  # 1 hour, google.protobuf.Duration
    }
  }
}</code></pre><h2 id="recommended-grpc-connection-settings"><a href="#recommended-grpc-connection-settings" aria-hidden="true">#</a>Recommended gRPC connection settings</h2><table><thead><tr><th align="left">Setting</th><th align="left">Value</th><th>Description</th></tr></thead><tbody><tr><td align="left">keep-alive period</td><td align="left">1 minute</td><td>Must be ≥ 1 minute and ≤ 5 minutes</td></tr><tr><td align="left">keep-alive timeout</td><td align="left">10 seconds</td><td></td></tr><tr><td align="left">permit keep-alive without calls</td><td align="left">true</td><td></td></tr></tbody></table><h3 id="keep-alive"><a href="#keep-alive" aria-hidden="true">#</a>Keep-Alive</h3><p>The load balancer hosting api.wgtwo.com will silently drop connections if they have been idle for 350 seconds (5m 50s).</p><p>To avoid this, the provider should send a keep-alive message every minute.</p><h2 id="continue-reading"><a href="#continue-reading" aria-hidden="true">#</a>Continue reading</h2><ul><li><a href="/number-lookup/api-reference/">API reference</a></li></ul><h2 id="concepts"><a href="#concepts" aria-hidden="true">#</a>Concepts</h2><ul><li><a href="https://grpc.io/docs/guides/concepts/" target="_blank" rel="nofollow noopener noreferrer">gRPC concepts</a></li><li><a href="https://grpc.io/docs/languages/kotlin/basics/" target="_blank" rel="nofollow noopener noreferrer">Kotlin gRPC tutorial</a></li><li><a href="https://grpc.io/docs/reference/java/generated-code/" target="_blank" rel="nofollow noopener noreferrer">Java gRPC stubs</a></li></ul></div></div><footer data-v-39f0b824 data-v-35cf879f><aside class="editthispage" data-v-39f0b824 data-v-35cf879f><a href="https://github.com/working-group-two/docs.wgtwo.com/blob/master/docs/number-lookup-how-to.md" target="_blank" icon-left="pencil" data-v-39f0b824 data-v-35cf879f><span class="icon is-small" data-v-35cf879f><i class="mdi mdi-pencil"></i></span>
          Edit page
        </a></aside><nav class="previous-next-buttons" data-v-39f0b824 data-v-35cf879f><a href="/number-lookup/overview/" class="button is-link is-inverted docs-nav__link" data-v-35cf879f>
          ← Overview
        </a><a href="/number-lookup/api-reference/" class="button is-link is-inverted docs-nav__nextlink" data-v-35cf879f>
          API reference →
        </a></nav></footer></div></div><nav class="articlenav is-hidden-touch" data-v-39f0b824><h3 data-v-39f0b824 data-v-35cf879f>ON THIS PAGE</h3><ul class="anchormenu" data-v-39f0b824 data-v-35cf879f><li data-v-39f0b824 data-v-35cf879f><a href="#prerequisites" aria-current="page" class="active--exact active" data-v-35cf879f>
          Prerequisites
        </a><ul class="anchormenu__sub-menu" data-v-39f0b824 data-v-35cf879f><li data-v-39f0b824 data-v-35cf879f><a href="#required-scope" aria-current="page" class="active--exact active" data-v-35cf879f>
              Required scope
            </a></li></ul></li><li data-v-39f0b824 data-v-35cf879f><a href="#how-to-use-the-api" aria-current="page" class="active--exact active" data-v-35cf879f>
          How to use the API
        </a><ul class="anchormenu__sub-menu" data-v-39f0b824 data-v-35cf879f></ul></li><li data-v-39f0b824 data-v-35cf879f><a href="#flow" aria-current="page" class="active--exact active" data-v-35cf879f>
          Flow
        </a><ul class="anchormenu__sub-menu" data-v-39f0b824 data-v-35cf879f></ul></li><li data-v-39f0b824 data-v-35cf879f><a href="#request--response" aria-current="page" class="active--exact active" data-v-35cf879f>
          Request / Response
        </a><ul class="anchormenu__sub-menu" data-v-39f0b824 data-v-35cf879f><li data-v-39f0b824 data-v-35cf879f><a href="#request" aria-current="page" class="active--exact active" data-v-35cf879f>
              Request
            </a></li><li data-v-39f0b824 data-v-35cf879f><a href="#response" aria-current="page" class="active--exact active" data-v-35cf879f>
              Response
            </a></li><li data-v-39f0b824 data-v-35cf879f><a href="#response-upstream-error" aria-current="page" class="active--exact active" data-v-35cf879f>
              Response, upstream error
            </a></li></ul></li><li data-v-39f0b824 data-v-35cf879f><a href="#limitations-for-display-name" aria-current="page" class="active--exact active" data-v-35cf879f>
          Limitations for display name
        </a><ul class="anchormenu__sub-menu" data-v-39f0b824 data-v-35cf879f></ul></li><li data-v-39f0b824 data-v-35cf879f><a href="#error-handling" aria-current="page" class="active--exact active" data-v-35cf879f>
          Error handling
        </a><ul class="anchormenu__sub-menu" data-v-39f0b824 data-v-35cf879f></ul></li><li data-v-39f0b824 data-v-35cf879f><a href="#cache" aria-current="page" class="active--exact active" data-v-35cf879f>
          Cache
        </a><ul class="anchormenu__sub-menu" data-v-39f0b824 data-v-35cf879f></ul></li><li data-v-39f0b824 data-v-35cf879f><a href="#recommended-grpc-connection-settings" aria-current="page" class="active--exact active" data-v-35cf879f>
          Recommended gRPC connection settings
        </a><ul class="anchormenu__sub-menu" data-v-39f0b824 data-v-35cf879f><li data-v-39f0b824 data-v-35cf879f><a href="#keep-alive" aria-current="page" class="active--exact active" data-v-35cf879f>
              Keep-Alive
            </a></li></ul></li><li data-v-39f0b824 data-v-35cf879f><a href="#continue-reading" aria-current="page" class="active--exact active" data-v-35cf879f>
          Continue reading
        </a><ul class="anchormenu__sub-menu" data-v-39f0b824 data-v-35cf879f></ul></li><li data-v-39f0b824 data-v-35cf879f><a href="#concepts" aria-current="page" class="active--exact active" data-v-35cf879f>
          Concepts
        </a><ul class="anchormenu__sub-menu" data-v-39f0b824 data-v-35cf879f></ul></li></ul></nav></div></div></div></main><footer class="footer docsnav is-hidden-desktop" data-v-39f0b824><div class="docs-nav__container" data-v-39f0b824 data-v-35cf879f><h3 class="is-uppercase" data-v-39f0b824 data-v-35cf879f>
        intro
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-35cf879f><li data-v-35cf879f><a href="/intro/get-started/" class="dosc_nav__anchor" data-v-35cf879f>Get started</a></li><li data-v-35cf879f><a href="/intro/api-structure-and-libraries/" class="dosc_nav__anchor" data-v-35cf879f>API structure and libraries</a></li><li data-v-35cf879f><a href="/intro/sandbox-environment/" class="dosc_nav__anchor" data-v-35cf879f>Sandbox Environment</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-35cf879f><h3 class="is-uppercase" data-v-39f0b824 data-v-35cf879f>
        oauth 2.0
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-35cf879f><li data-v-35cf879f><a href="/oauth-2-0/overview/" class="dosc_nav__anchor" data-v-35cf879f>Overview</a></li><li data-v-35cf879f><a href="/oauth-2-0/create-o-auth-2-0-client/" class="dosc_nav__anchor" data-v-35cf879f>Create OAuth 2.0 client</a></li><li data-v-35cf879f><a href="/oauth-2-0/get-user-access-token/" class="dosc_nav__anchor" data-v-35cf879f>Get user access token</a></li><li data-v-35cf879f><a href="/oauth-2-0/get-client-access-token/" class="dosc_nav__anchor" data-v-35cf879f>Get client access token</a></li><li data-v-35cf879f><a href="/oauth-2-0/support-revoking-consent/" class="dosc_nav__anchor" data-v-35cf879f>Support revoking consent</a></li><li data-v-35cf879f><a href="/oauth-2-0/why-support-user-revoking-of-consent/" class="dosc_nav__anchor" data-v-35cf879f>Why support user revoking of consent</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-35cf879f><h3 class="is-uppercase" data-v-39f0b824 data-v-35cf879f>
        mms
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-35cf879f><li data-v-35cf879f><a href="/mms/send-mms/" class="dosc_nav__anchor" data-v-35cf879f>Send MMS</a></li><li data-v-35cf879f><a href="/mms/mms-api-reference/" class="dosc_nav__anchor" data-v-35cf879f>MMS API reference</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-35cf879f><h3 class="is-uppercase" data-v-39f0b824 data-v-35cf879f>
        events
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-35cf879f><li data-v-35cf879f><a href="/events/listen-for-events/" class="dosc_nav__anchor" data-v-35cf879f>Listen for events</a></li><li data-v-35cf879f><a href="/events/configuration-and-types/" class="dosc_nav__anchor" data-v-35cf879f>Configuration and types</a></li><li data-v-35cf879f><a href="/events/events-api-reference/" class="dosc_nav__anchor" data-v-35cf879f>Events API reference</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-35cf879f><h3 class="is-uppercase" data-v-39f0b824 data-v-35cf879f>
        voicemail
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-35cf879f><li data-v-35cf879f><a href="/voicemail/list-play-delete-and-configure-voicemails/" class="dosc_nav__anchor" data-v-35cf879f>List, play, delete and configure voicemails</a></li><li data-v-35cf879f><a href="/voicemail/voicemail-api-reference/" class="dosc_nav__anchor" data-v-35cf879f>Voicemail API reference</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-35cf879f><h3 class="is-uppercase" data-v-39f0b824 data-v-35cf879f>
        subscription profile
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-35cf879f><li data-v-35cf879f><a href="/subscription-profile/overview/" class="dosc_nav__anchor" data-v-35cf879f>Overview</a></li><li data-v-35cf879f><a href="/subscription-profile/manage-subscriptions/" class="dosc_nav__anchor" data-v-35cf879f>Manage subscriptions</a></li><li data-v-35cf879f><a href="/subscription-profile/subscription-profile-api-reference/" class="dosc_nav__anchor" data-v-35cf879f>Subscription profile API reference</a></li><li data-v-35cf879f><a href="/subscription-profile/subscription-services/" class="dosc_nav__anchor" data-v-35cf879f>Subscription services</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-35cf879f><h3 class="is-uppercase" data-v-39f0b824 data-v-35cf879f>
        network information
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-35cf879f><li data-v-35cf879f><a href="/network-information/get-subscriber-network-information/" class="dosc_nav__anchor" data-v-35cf879f>Get subscriber network information</a></li><li data-v-35cf879f><a href="/network-information/network-info-api/" class="dosc_nav__anchor" data-v-35cf879f>Network info API</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-35cf879f><h3 class="is-uppercase" data-v-39f0b824 data-v-35cf879f>
        call forwarding
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-35cf879f><li data-v-35cf879f><a href="/call-forwarding/set-call-forwarding/" class="dosc_nav__anchor" data-v-35cf879f>Set call forwarding</a></li><li data-v-35cf879f><a href="/call-forwarding/call-forwarding-api-reference/" class="dosc_nav__anchor" data-v-35cf879f>Call forwarding API reference</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-35cf879f><h3 class="is-uppercase" data-v-39f0b824 data-v-35cf879f>
        pbx
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-35cf879f><li data-v-35cf879f><a href="/pbx/pbx-tas-integration/" class="dosc_nav__anchor" data-v-35cf879f>PBX/TAS integration</a></li><li data-v-35cf879f><a href="/pbx/api-reference/" class="dosc_nav__anchor" data-v-35cf879f>API reference</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-35cf879f><h3 class="is-uppercase" data-v-39f0b824 data-v-35cf879f>
        number lookup
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-35cf879f><li data-v-35cf879f><a href="/number-lookup/overview/" class="dosc_nav__anchor" data-v-35cf879f>Overview</a></li><li class="active--exact active" data-v-35cf879f><a href="/number-lookup/technical-guide/" aria-current="page" class="dosc_nav__anchor" data-v-35cf879f>Technical guide</a></li><li data-v-35cf879f><a href="/number-lookup/api-reference/" class="dosc_nav__anchor" data-v-35cf879f>API reference</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-35cf879f><h3 class="is-uppercase" data-v-39f0b824 data-v-35cf879f>
        metrics
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-35cf879f><li data-v-35cf879f><a href="/metrics/accessing-metrics/" class="dosc_nav__anchor" data-v-35cf879f>Accessing Metrics</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-35cf879f><h3 class="is-uppercase" data-v-39f0b824 data-v-35cf879f>
        web terminal
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-35cf879f><li data-v-35cf879f><a href="/web-terminal/create-a-web-terminal-to-make-and-receive-calls/" class="dosc_nav__anchor" data-v-35cf879f>Create a Web Terminal to make and receive calls</a></li><li data-v-35cf879f><a href="/web-terminal/web-terminal-api-reference/" class="dosc_nav__anchor" data-v-35cf879f>Web Terminal API reference</a></li></ul></div></footer></div>
    <script>window.__INITIAL_STATE__={"data":{"doc":{"title":"Technical guide","headings":[{"value":"Number Lookup API - Technical Guide"}],"subtitles":[{"depth":1,"value":"Number Lookup API - Technical Guide","anchor":"#number-lookup-api---technical-guide"},{"depth":2,"value":"Prerequisites","anchor":"#prerequisites","children":[{"depth":3,"value":"Required scope","anchor":"#required-scope","children":[]}]},{"depth":3,"value":"Required scope","anchor":"#required-scope","children":[]},{"depth":2,"value":"How to use the API","anchor":"#how-to-use-the-api","children":[]},{"depth":2,"value":"Flow","anchor":"#flow","children":[]},{"depth":2,"value":"Request \u002F Response","anchor":"#request--response","children":[{"depth":3,"value":"Request","anchor":"#request","children":[]},{"depth":3,"value":"Response","anchor":"#response","children":[]},{"depth":3,"value":"Response, upstream error","anchor":"#response-upstream-error","children":[]}]},{"depth":3,"value":"Request","anchor":"#request","children":[]},{"depth":3,"value":"Response","anchor":"#response","children":[]},{"depth":3,"value":"Response, upstream error","anchor":"#response-upstream-error","children":[]},{"depth":2,"value":"Limitations for display name","anchor":"#limitations-for-display-name","children":[]},{"depth":2,"value":"Error handling","anchor":"#error-handling","children":[]},{"depth":2,"value":"Cache","anchor":"#cache","children":[]},{"depth":2,"value":"Recommended gRPC connection settings","anchor":"#recommended-grpc-connection-settings","children":[{"depth":3,"value":"Keep-Alive","anchor":"#keep-alive","children":[]}]},{"depth":3,"value":"Keep-Alive","anchor":"#keep-alive","children":[]},{"depth":2,"value":"Continue reading","anchor":"#continue-reading","children":[]},{"depth":2,"value":"Concepts","anchor":"#concepts","children":[]}],"roles":["THIRD_PARTY_DEVELOPER"],"hideWarning":null,"sourceExamples":[{"file":"examples\u002Fgrpcurl\u002Fthirdpartydev\u002Fnumber-lookup\u002Fprovider.sh","content":"#!\u002Fusr\u002Fbin\u002Fenv bash\n\n# Download the API definition\ncurl -sL 'https:\u002F\u002Fgithub.com\u002Fworking-group-two\u002Fwgtwoapis\u002Fblob\u002Fmaster\u002Fimage.bin?raw=true' -o proto\u002Fwgtwo.bin\n\n# Access token must be obtained via the client credentials flow\nACCESS_TOKEN=$(\n  curl -s -u $CLIENT_ID:$CLIENT_SECRET \\\n    --request POST \\\n    --url 'https:\u002F\u002Fid.wgtwo.com\u002Foauth2\u002Ftoken' \\\n    --header 'content-type: application\u002Fx-www-form-urlencoded' \\\n    --data grant_type=\"client_credentials\" \\\n    --data scope=\"lookup.number:read\" \\\n  | jq -r .access_token\n)\n\n# We send data to grpcurl via a PIPE, and receive data via stdout.\nPIPE=\u002Ftmp\u002Fprovider-PIPE\nmkfifo $PIPE\nexec 3\u003C\u003E $PIPE\n\ncleanup() {\n    echo \"Cleaning up...\"\n    rm -f $PIPE\n    exec 3\u003E&-\n    exit\n}\ntrap cleanup INT TERM EXIT\n\ngrpcurl \\\n   -H \"Authorization: Bearer $ACCESS_TOKEN\" \\\n   -protoset wgtwo.bin \\\n   -d @ \\\n   api.wgtwo.com:443 \\\n   wgtwo.lookup.v0.NumberLookupService\u002FNumberLookup \u003C&3 \\\n| while IFS= read -r LINE; do\n    # grpcurl sends output line by line, so we buffer until we have a valid JSON object.\n    BUFFER+=\"$LINE\"\n    if ! jq . \u003E\u002Fdev\u002Fnull 2\u003E&1 \u003C\u003C\u003C\"$BUFFER\"; then continue; fi\n\n    # Create a JSON response that includes the request and a dummy result.\n    RESPONSE_JSON=$(jq -c -n --argjson incoming_content \"$BUFFER\" \\\n      '{\n          number_lookup_request: $incoming_content,\n          result: {\n            name: \"John Doe\"\n          }\n      }'\n    )\n\n    # Send the response to grpcurl via the PIPE.\n    echo \"$RESPONSE_JSON\" \u003E $PIPE\n\n    echo \"Sent response:\"\n    echo \"$RESPONSE_JSON\" | jq .\n    echo \"\"\n\n    # Clear the buffer.\n    BUFFER=\"\"\ndone\n"},{"file":"examples\u002Fkotlin\u002Fthirdpartydev\u002Fnumber-lookup\u002Fsrc\u002Fmain\u002Fkotlin\u002Fcom\u002Fwgtwo\u002Fexamples\u002Fthirdpartydev\u002Fprovider\u002FProvider.kt","content":"package com.wgtwo.examples.thirdpartydev.numberlookup\n\nimport com.google.protobuf.util.Durations\nimport com.wgtwo.api.v0.lookup.NumberLookupProto.NumberLookupRequest\nimport com.wgtwo.api.v0.lookup.NumberLookupProto.NumberLookupResponse\nimport com.wgtwo.api.v0.lookup.NumberLookupServiceGrpcKt\nimport com.wgtwo.api.v0.lookup.cacheControl\nimport com.wgtwo.api.v0.lookup.numberLookupResponse\nimport com.wgtwo.api.v0.lookup.result\nimport com.wgtwo.auth.BearerTokenCallCredentials\nimport io.grpc.ManagedChannelBuilder\nimport kotlinx.coroutines.channels.Channel\nimport kotlinx.coroutines.delay\nimport kotlinx.coroutines.flow.catch\nimport kotlinx.coroutines.flow.collect\nimport kotlinx.coroutines.flow.flow\nimport kotlinx.coroutines.flow.onEach\nimport kotlinx.coroutines.flow.onStart\nimport kotlinx.coroutines.runBlocking\nimport java.util.concurrent.TimeUnit\nimport kotlin.time.Duration.Companion.seconds\n\nprivate val grpcChannel = ManagedChannelBuilder.forTarget(\"api.wgtwo.com:443\")\n    .keepAliveWithoutCalls(true)\n    .keepAliveTime(1, TimeUnit.MINUTES)\n    .keepAliveTimeout(10, TimeUnit.SECONDS)\n    .idleTimeout(1, TimeUnit.HOURS)\n    .build()\n\nprivate val stub = NumberLookupServiceGrpcKt.NumberLookupServiceCoroutineStub(grpcChannel)\n    .withCallCredentials(BearerTokenCallCredentials { \"MY ACCESS TOKEN\" })\n\nval phonebook = mapOf(\n    \"+4799999999\" to \"John Doe\",\n)\n\nsuspend fun startStream() {\n    val responseQueue = Channel\u003CNumberLookupResponse\u003E()\n\n    \u002F\u002F Check queue to see if we have any responses and send them over the wire\n    val responseFlow = flow {\n        for (response in responseQueue) {\n            emit(response)\n        }\n    }\n    stub.numberLookup(responseFlow)\n        .onStart { println(\"Starting new stream\") }\n        .onEach { request: NumberLookupRequest -\u003E\n            println(\"Got request for ${request.number.e164}\")\n            val displayName = phonebook.getOrDefault(request.number.e164, \"\")\n            val response = numberLookupResponse {\n                numberLookupRequest = request\n                result = result {\n                    name = displayName\n                }\n                cacheControl = cacheControl {\n                    maxAge = Durations.fromMinutes(60)\n                }\n            }\n            println(\"Sending response for ${response.numberLookupRequest.number.e164}: ${response.result.name}\")\n            responseQueue.send(response)\n        }\n        .catch { e -\u003E\n            println(\"Got error: ${e.message} - Will reconnect in 1s\")\n            delay(1.seconds)\n        }\n        .collect()\n}\n\nfun main() = runBlocking {\n    \u002F\u002F Run forever - if the stream fails we will reconnect\n    while (true) {\n        startStream()\n    }\n}\n"}]}},"context":{}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script><script src="/assets/js/app.9473d5b5.js" defer></script><script src="/assets/js/page--src--templates--doc-page-vue.75275d53.js" defer></script><script src="/assets/js/vue-remark--docs--number-lookup-how-to-md.8ee1e976.js" defer></script>
  </body>
</html>
