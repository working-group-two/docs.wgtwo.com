<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>Technical guide - WGTWO API v0 docs</title><meta name="gridsome:hash" content="93a05945bb2356491581238933ccec9332b118e3"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.23"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.5b390dec4c74475da6a1fdbd51d8f12a.png"><link data-vue-tag="ssr" rel="stylesheet" href="https://cdn.materialdesignicons.com/5.4.55/css/materialdesignicons.min.css"><link data-vue-tag="ssr" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swagger-ui-dist@3.25.0/swagger-ui.css"><link rel="preload" href="/assets/css/0.styles.6c67181b.css" as="style"><link rel="preload" href="/assets/js/app.71c4068d.js" as="script"><link rel="preload" href="/assets/js/page--src--templates--doc-page-vue.44e11ace.js" as="script"><link rel="preload" href="/assets/js/vue-remark--docs--number-lookup-how-to-md.0a825c89.js" as="script"><link rel="prefetch" href="/assets/js/page--node-modules--gridsome--app--pages--404-vue.f2eac792.js"><link rel="prefetch" href="/assets/js/page--src--pages--index-vue.168920b0.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--call-forwarding-api-reference-md.3f66c4c9.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--call-forwarding-md.c14d4a4a.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--events-api-reference-md.6ba993bc.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--events-configuration-md.fee0fe44.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--events-how-to-md.7f03783b.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--intro-client-and-languages-md.40ee26ea.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--intro-get-started-md.780c7861.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--intro-sandbox-md.20d1bcef.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--metrics-how-to-md.cc43d112.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--mms-api-reference-md.3c56a7a0.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--mms-send-how-to-md.2c7373c1.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--number-lookup-api-reference-md.11b28d93.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--number-lookup-overview-md.232ffb4d.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--oauth-2-create-client-how-to-md.3a71043e.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--oauth-2-get-client-access-token-md.d8bc9c28.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--oauth-2-get-user-access-token-md.ec969bb1.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--oauth-2-overview-md.3ee4fe98.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--oauth-2-subscriber-deauthorization-md.43cdd722.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--oauth-2-why-support-user-revoking-consent-md.47944879.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--provision-api-reference-2-md.41f8fbe8.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--provision-how-to-md.937d1aaf.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--provision-overview-md.c654d1b0.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--provision-service-list-md.521ba220.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--sipbreakout-how-to-md.cfbf064d.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--subscriber-location-how-to-md.03070d66.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--subscriber-location-reference-md.714c3825.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--webterminal-api-reference-md.5c0b7513.js"><link rel="prefetch" href="/assets/js/vue-remark--docs--webterminal-how-to-md.3b240b26.js"><link rel="stylesheet" href="/assets/css/0.styles.6c67181b.css"><script data-vue-tag="ssr" src="https://cdn.jsdelivr.net/npm/swagger-ui-dist@3.25.0/swagger-ui-bundle.js"></script><script data-vue-tag="ssr" src="https://cdn.jsdelivr.net/npm/swagger-ui-dist@3.25.0/swagger-ui-standalone-preset.js"></script><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
  </head>
  <body >
    <div data-server-rendered="true" id="app" data-v-39f0b824 data-v-5e0e6af4><nav role="navigation" aria-label="main navigation" class="navbar topnav" data-v-513de838 data-v-39f0b824><div class="navbar-brand"><a href="/" exact="" to="/" class="navbar-item p-0" data-v-513de838><svg id="logo_svg__Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 111.509 77.208" class="topnav__logo" data-v-513de838><defs><style>.logo_svg__cls-1{fill:#00bceb}</style></defs><path d="M85.273 51.21a6.61 6.61 0 11-6.611-6.476 6.424 6.424 0 016.61 6.476zm-6.611-3.29a3.292 3.292 0 103.265 3.29 3.233 3.233 0 00-3.266-3.29zM68.73 48.541a5.513 5.513 0 00-2.656-.668 3.34 3.34 0 100 6.677 5.575 5.575 0 002.656-.664v3.358a10.08 10.08 0 01-2.877.445 6.48 6.48 0 110-12.955 9.646 9.646 0 012.877.449zM55.246 47.8a10.83 10.83 0 00-2.467-.382c-1.266 0-1.953.424-1.953 1.025 0 .762.927 1.028 1.447 1.192l.871.277a3.764 3.764 0 012.982 3.58c0 3.142-2.763 4.197-5.18 4.197a18.828 18.828 0 01-3.407-.341v-2.88a11.832 11.832 0 002.982.466c1.57 0 2.293-.46 2.293-1.168 0-.634-.625-1-1.408-1.246-.192-.064-.479-.154-.674-.218-1.759-.556-3.225-1.59-3.225-3.66 0-2.34 1.752-3.912 4.662-3.912a13.478 13.478 0 013.077.399zM40.117 44.956h3.157v12.511h-3.157zM35.777 48.541a5.482 5.482 0 00-2.653-.668 3.34 3.34 0 100 6.677 5.54 5.54 0 002.653-.664v3.358a10.015 10.015 0 01-2.88.445 6.48 6.48 0 110-12.955 9.617 9.617 0 012.88.449z" class="logo_svg__cls-1"></path><rect x="88.61" y="29.949" width="3.157" height="6.412" rx="1.579" class="logo_svg__cls-1"></rect><rect x="80.002" y="25.638" width="3.157" height="10.724" rx="1.579" class="logo_svg__cls-1"></rect><rect x="71.393" y="19.741" width="3.157" height="19.741" rx="1.579" class="logo_svg__cls-1"></rect><rect x="62.784" y="25.638" width="3.157" height="10.724" rx="1.579" class="logo_svg__cls-1"></rect><rect x="54.176" y="29.949" width="3.157" height="6.412" rx="1.579" class="logo_svg__cls-1"></rect><rect x="45.567" y="25.638" width="3.157" height="10.724" rx="1.579" class="logo_svg__cls-1"></rect><rect x="36.958" y="19.741" width="3.157" height="19.741" rx="1.579" class="logo_svg__cls-1"></rect><rect x="28.35" y="25.638" width="3.157" height="10.724" rx="1.579" class="logo_svg__cls-1"></rect><rect x="19.741" y="29.949" width="3.157" height="6.412" rx="1.579" class="logo_svg__cls-1"></rect></svg></a></div><div class="navbar-menu"><div class="navbar-start"></div><div class="navbar-end"><div class="navbar-item has-dropdown" data-v-39f0b824><a aria-haspopup="true" tabindex="0" class="navbar-link">v0</a><div class="navbar-dropdown"><a href="https://v1.docs.wgtwo.com/" class="navbar-item" data-v-39f0b824>v1</a></div></div><!----><div class="role-selection-container"><button type="button" class="button button is-role role-selection-button"><!----><span><span>Viewing docs</span><span class="icon"><i class="mdi mdi-chevron-down mdi-24px"></i></span></span><!----></button></div></div></div></nav><main class="main" data-v-39f0b824><nav class="docsnav-container is-hidden-touch" data-v-39f0b824><div class="docsnav" data-v-39f0b824><div class="docs-nav__container" data-v-39f0b824 data-v-5e0e6af4><h3 class="is-uppercase" data-v-39f0b824 data-v-5e0e6af4>
        intro
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-5e0e6af4><li data-v-5e0e6af4><a href="/intro/get-started/" class="dosc_nav__anchor" data-v-5e0e6af4>Get started</a></li><li data-v-5e0e6af4><a href="/intro/api-structure-and-libraries/" class="dosc_nav__anchor" data-v-5e0e6af4>API structure and libraries</a></li><li data-v-5e0e6af4><a href="/intro/sandbox-environment/" class="dosc_nav__anchor" data-v-5e0e6af4>Sandbox Environment</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-5e0e6af4><h3 class="is-uppercase" data-v-39f0b824 data-v-5e0e6af4>
        oauth 2.0
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-5e0e6af4><li data-v-5e0e6af4><a href="/oauth-2-0/overview/" class="dosc_nav__anchor" data-v-5e0e6af4>Overview</a></li><li data-v-5e0e6af4><a href="/oauth-2-0/create-o-auth-2-0-client/" class="dosc_nav__anchor" data-v-5e0e6af4>Create OAuth 2.0 client</a></li><li data-v-5e0e6af4><a href="/oauth-2-0/get-user-access-token/" class="dosc_nav__anchor" data-v-5e0e6af4>Get user access token</a></li><li data-v-5e0e6af4><a href="/oauth-2-0/get-client-access-token/" class="dosc_nav__anchor" data-v-5e0e6af4>Get client access token</a></li><li data-v-5e0e6af4><a href="/oauth-2-0/support-revoking-consent/" class="dosc_nav__anchor" data-v-5e0e6af4>Support revoking consent</a></li><li data-v-5e0e6af4><a href="/oauth-2-0/why-support-user-revoking-of-consent/" class="dosc_nav__anchor" data-v-5e0e6af4>Why support user revoking of consent</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-5e0e6af4><h3 class="is-uppercase" data-v-39f0b824 data-v-5e0e6af4>
        mms
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-5e0e6af4><li data-v-5e0e6af4><a href="/mms/send-mms/" class="dosc_nav__anchor" data-v-5e0e6af4>Send MMS</a></li><li data-v-5e0e6af4><a href="/mms/mms-api-reference/" class="dosc_nav__anchor" data-v-5e0e6af4>MMS API reference</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-5e0e6af4><h3 class="is-uppercase" data-v-39f0b824 data-v-5e0e6af4>
        events
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-5e0e6af4><li data-v-5e0e6af4><a href="/events/listen-for-events/" class="dosc_nav__anchor" data-v-5e0e6af4>Listen for events</a></li><li data-v-5e0e6af4><a href="/events/configuration-and-types/" class="dosc_nav__anchor" data-v-5e0e6af4>Configuration and types</a></li><li data-v-5e0e6af4><a href="/events/events-api-reference/" class="dosc_nav__anchor" data-v-5e0e6af4>Events API reference</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-5e0e6af4><h3 class="is-uppercase" data-v-39f0b824 data-v-5e0e6af4>
        subscription profile
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-5e0e6af4><li data-v-5e0e6af4><a href="/subscription-profile/overview/" class="dosc_nav__anchor" data-v-5e0e6af4>Overview</a></li><li data-v-5e0e6af4><a href="/subscription-profile/manage-subscriptions/" class="dosc_nav__anchor" data-v-5e0e6af4>Manage subscriptions</a></li><li data-v-5e0e6af4><a href="/subscription-profile/subscription-profile-api-reference/" class="dosc_nav__anchor" data-v-5e0e6af4>Subscription profile API reference</a></li><li data-v-5e0e6af4><a href="/subscription-profile/subscription-services/" class="dosc_nav__anchor" data-v-5e0e6af4>Subscription services</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-5e0e6af4><h3 class="is-uppercase" data-v-39f0b824 data-v-5e0e6af4>
        network information
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-5e0e6af4><li data-v-5e0e6af4><a href="/network-information/get-subscriber-network-information/" class="dosc_nav__anchor" data-v-5e0e6af4>Get subscriber network information</a></li><li data-v-5e0e6af4><a href="/network-information/network-info-api/" class="dosc_nav__anchor" data-v-5e0e6af4>Network info API</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-5e0e6af4><h3 class="is-uppercase" data-v-39f0b824 data-v-5e0e6af4>
        call forwarding
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-5e0e6af4><li data-v-5e0e6af4><a href="/call-forwarding/set-call-forwarding/" class="dosc_nav__anchor" data-v-5e0e6af4>Set call forwarding</a></li><li data-v-5e0e6af4><a href="/call-forwarding/call-forwarding-api-reference/" class="dosc_nav__anchor" data-v-5e0e6af4>Call forwarding API reference</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-5e0e6af4><h3 class="is-uppercase" data-v-39f0b824 data-v-5e0e6af4>
        pbx
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-5e0e6af4><li data-v-5e0e6af4><a href="/pbx/pbx-tas-integration/" class="dosc_nav__anchor" data-v-5e0e6af4>PBX/TAS integration</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-5e0e6af4><h3 class="is-uppercase" data-v-39f0b824 data-v-5e0e6af4>
        number lookup
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-5e0e6af4><li data-v-5e0e6af4><a href="/number-lookup/overview/" class="dosc_nav__anchor" data-v-5e0e6af4>Overview</a></li><li class="active--exact active" data-v-5e0e6af4><a href="/number-lookup/technical-guide/" aria-current="page" class="dosc_nav__anchor" data-v-5e0e6af4>Technical guide</a></li><li data-v-5e0e6af4><a href="/number-lookup/api-reference/" class="dosc_nav__anchor" data-v-5e0e6af4>API reference</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-5e0e6af4><h3 class="is-uppercase" data-v-39f0b824 data-v-5e0e6af4>
        metrics
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-5e0e6af4><li data-v-5e0e6af4><a href="/metrics/accessing-metrics/" class="dosc_nav__anchor" data-v-5e0e6af4>Accessing Metrics</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-5e0e6af4><h3 class="is-uppercase" data-v-39f0b824 data-v-5e0e6af4>
        web terminal
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-5e0e6af4><li data-v-5e0e6af4><a href="/web-terminal/create-a-web-terminal-to-make-and-receive-calls/" class="dosc_nav__anchor" data-v-5e0e6af4>Create a Web Terminal to make and receive calls</a></li><li data-v-5e0e6af4><a href="/web-terminal/web-terminal-api-reference/" class="dosc_nav__anchor" data-v-5e0e6af4>Web Terminal API reference</a></li></ul></div></div></nav><div class="doc-main-container" data-v-39f0b824><div class="article-container" data-v-39f0b824><div class="is-flex" data-v-39f0b824><div class="article" data-v-39f0b824><article role="alert" class="notification is-warning is-light" data-v-5e0e6af4><button type="button" aria-label="Close notification" class="delete"></button><div class="media"><!----><div class="media-content"><div class="is-flex" data-v-5e0e6af4><span class="icon is-large" style="margin-right:16px;" data-v-5e0e6af4><i class="mdi mdi-information mdi-48px"></i></span><div data-v-5e0e6af4>
        This documentation is for v0 of our APIs and might change. See
        <a href="https://v1.docs.wgtwo.com" data-v-5e0e6af4>https://v1.docs.wgtwo.com</a> for
        our guaranteed stable APIs.
      </div></div></div></div><!----></article><div data-v-39f0b824 data-v-5e0e6af4><div id="content" class="content" data-v-39f0b824 data-v-5e0e6af4><div><h1 id="number-lookup-api---technical-guide"><a href="#number-lookup-api---technical-guide" aria-hidden="true">#</a>Number Lookup API - Technical Guide</h1><blockquote><p><strong>This guide will show you how to set up a Number Lookup Provider.</strong></p><p>You should have an understanding of how this works before continuing,
see <a href="/number-lookup/overview/">Overview</a>.</p></blockquote><h2 id="prerequisites"><a href="#prerequisites" aria-hidden="true">#</a>Prerequisites</h2><p>This guide assumes you are able to create a OAuth 2.0 client and get an access token.</p><p>See <a href="https://docs.wgtwo.com/guide/oauth2/get-client-access-token.html" target="_blank" rel="nofollow noopener noreferrer">Get client access token</a> for how to get the
access token.</p><blockquote><p><strong>Note:</strong><br>
For testing using our sandbox endpoint or the local test application, authentication headers may be skipped.</p></blockquote><h3 id="required-scope"><a href="#required-scope" aria-hidden="true">#</a>Required scope</h3><p><code>lookup.number:read</code></p><h2 id="how-to-use-the-api"><a href="#how-to-use-the-api" aria-hidden="true">#</a>How to use the API</h2><p>When you connect to this API, you will get a stream of number lookup requests for which you should respond with
information about the number.</p><div class="language-tabs" data-v-33cce47c><div class="b-tabs" data-v-33cce47c><nav role="tablist" aria-orientation="horizontal" class="tabs"><ul></ul></nav><section class="tab-content"><div class="tab-item" role="tabpanel" id="467-content" aria-labelledby="467-label" tabindex="-1" style="display:none;" data-v-33cce47c><div><pre class="language-bash"><code class="language-bash"><span class="token shebang important">#!/usr/bin/env bash</span>

<span class="token comment"># Download the API definition</span>
<span class="token function">curl</span> -sL <span class="token string">'https://github.com/working-group-two/wgtwoapis/blob/master/image.bin?raw=true'</span> -o proto/wgtwo.bin

<span class="token comment"># Access token must be obtained via the client credentials flow</span>
<span class="token assign-left variable">ACCESS_TOKEN</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>
  <span class="token function">curl</span> -s -u $CLIENT_ID:$CLIENT_SECRET <span class="token punctuation">\</span>
    --request POST <span class="token punctuation">\</span>
    --url <span class="token string">'https://id.wgtwo.com/oauth2/token'</span> <span class="token punctuation">\</span>
    --header <span class="token string">'content-type: application/x-www-form-urlencoded'</span> <span class="token punctuation">\</span>
    --data <span class="token assign-left variable">grant_type</span><span class="token operator">=</span><span class="token string">"client_credentials"</span> <span class="token punctuation">\</span>
    --data <span class="token assign-left variable">scope</span><span class="token operator">=</span><span class="token string">"lookup.number:read"</span> <span class="token punctuation">\</span>
  <span class="token operator">|</span> jq -r .access_token
<span class="token variable">)</span></span>

<span class="token comment"># We send data to grpcurl via a PIPE, and receive data via stdout.</span>
<span class="token assign-left variable">PIPE</span><span class="token operator">=</span>/tmp/provider-PIPE
<span class="token function">mkfifo</span> <span class="token variable">$PIPE</span>
<span class="token builtin class-name">exec</span> <span class="token operator"><span class="token file-descriptor important">3</span>&lt;></span> <span class="token variable">$PIPE</span>

<span class="token function-name function">cleanup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"Cleaning up..."</span>
    <span class="token function">rm</span> -f <span class="token variable">$PIPE</span>
    <span class="token builtin class-name">exec</span> <span class="token operator"><span class="token file-descriptor important">3</span>>&amp;</span>-
    <span class="token builtin class-name">exit</span>
<span class="token punctuation">}</span>
<span class="token builtin class-name">trap</span> cleanup INT <span class="token environment constant">TERM</span> EXIT

grpcurl <span class="token punctuation">\</span>
   -H <span class="token string">"Authorization: Bearer <span class="token variable">$ACCESS_TOKEN</span>"</span> <span class="token punctuation">\</span>
   -protoset wgtwo.bin <span class="token punctuation">\</span>
   -d @ <span class="token punctuation">\</span>
   api.wgtwo.com:443 <span class="token punctuation">\</span>
   wgtwo.lookup.v0.NumberLookupService/NumberLookup <span class="token operator">&lt;</span><span class="token file-descriptor important">&amp;3</span> <span class="token punctuation">\</span>
<span class="token operator">|</span> <span class="token keyword">while</span> <span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span> <span class="token builtin class-name">read</span> -r LINE<span class="token punctuation">;</span> <span class="token keyword">do</span>
    <span class="token comment"># grpcurl sends output line by line, so we buffer until we have a valid JSON object.</span>
    <span class="token assign-left variable">BUFFER</span><span class="token operator">+=</span><span class="token string">"<span class="token variable">$LINE</span>"</span>
    <span class="token keyword">if</span> <span class="token operator">!</span> jq <span class="token builtin class-name">.</span> <span class="token operator">></span>/dev/null <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&lt;&lt;&lt;</span><span class="token string">"<span class="token variable">$BUFFER</span>"</span><span class="token punctuation">;</span> <span class="token keyword">then</span> <span class="token builtin class-name">continue</span><span class="token punctuation">;</span> <span class="token keyword">fi</span>

    <span class="token comment"># Create a JSON response that includes the request and a dummy result.</span>
    <span class="token assign-left variable">RESPONSE_JSON</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>jq -c -n --argjson incoming_content <span class="token string">"<span class="token variable">$BUFFER</span>"</span> <span class="token punctuation">\</span>
      <span class="token string">'{
          number_lookup_request: $incoming_content,
          result: {
            name: "John Doe"
          }
      }'</span>
    <span class="token variable">)</span></span>

    <span class="token comment"># Send the response to grpcurl via the PIPE.</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$RESPONSE_JSON</span>"</span> <span class="token operator">></span> <span class="token variable">$PIPE</span>

    <span class="token builtin class-name">echo</span> <span class="token string">"Sent response:"</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$RESPONSE_JSON</span>"</span> <span class="token operator">|</span> jq <span class="token builtin class-name">.</span>
    <span class="token builtin class-name">echo</span> <span class="token string">""</span>

    <span class="token comment"># Clear the buffer.</span>
    <span class="token assign-left variable">BUFFER</span><span class="token operator">=</span><span class="token string">""</span>
<span class="token keyword">done</span>
</code></pre><figcaption><a href="https://github.com/working-group-two/docs.wgtwo.com/blob/master/examples/grpcurl/thirdpartydev/number-lookup/provider.sh" target="_blank" class="github-link">provider.sh</a></figcaption></div></div><!----><div class="tab-item" role="tabpanel" id="469-content" aria-labelledby="469-label" tabindex="-1" class="content" style="display:none;" data-v-33cce47c><div class="collapse card" data-v-33cce47c><div class="collapse-trigger"><div role="button" class="card-header" data-v-33cce47c><p class="card-header-title" data-v-33cce47c>
            Install dependencies
          </p><a class="card-header-icon" data-v-33cce47c><span class="icon" data-v-33cce47c><i class="mdi mdi-menu-up mdi-24px"></i></span></a></div></div><div id="" class="collapse-content" style="display:none;"><div class="card-content" data-v-33cce47c><div data-v-33cce47c><pre class="language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.wgtwo.api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>auth<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>0.0.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.wgtwo.api.v0.grpc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>lookup<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>0.1.6<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>depenencies</span><span class="token punctuation">></span></span></code></pre></div></div></div></div><div class="is-size-4 mt-4" data-v-33cce47c>
        Snippet
      </div><div><pre class="language-kt"><code class="language-kt"><span class="token keyword">package</span> com<span class="token punctuation">.</span>wgtwo<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>thirdpartydev<span class="token punctuation">.</span>numberlookup

<span class="token keyword">import</span> com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>protobuf<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Durations
<span class="token keyword">import</span> com<span class="token punctuation">.</span>wgtwo<span class="token punctuation">.</span>api<span class="token punctuation">.</span>v0<span class="token punctuation">.</span>lookup<span class="token punctuation">.</span>NumberLookupProto<span class="token punctuation">.</span>NumberLookupRequest
<span class="token keyword">import</span> com<span class="token punctuation">.</span>wgtwo<span class="token punctuation">.</span>api<span class="token punctuation">.</span>v0<span class="token punctuation">.</span>lookup<span class="token punctuation">.</span>NumberLookupProto<span class="token punctuation">.</span>NumberLookupResponse
<span class="token keyword">import</span> com<span class="token punctuation">.</span>wgtwo<span class="token punctuation">.</span>api<span class="token punctuation">.</span>v0<span class="token punctuation">.</span>lookup<span class="token punctuation">.</span>NumberLookupServiceGrpcKt
<span class="token keyword">import</span> com<span class="token punctuation">.</span>wgtwo<span class="token punctuation">.</span>api<span class="token punctuation">.</span>v0<span class="token punctuation">.</span>lookup<span class="token punctuation">.</span>cacheControl
<span class="token keyword">import</span> com<span class="token punctuation">.</span>wgtwo<span class="token punctuation">.</span>api<span class="token punctuation">.</span>v0<span class="token punctuation">.</span>lookup<span class="token punctuation">.</span>numberLookupResponse
<span class="token keyword">import</span> com<span class="token punctuation">.</span>wgtwo<span class="token punctuation">.</span>api<span class="token punctuation">.</span>v0<span class="token punctuation">.</span>lookup<span class="token punctuation">.</span>result
<span class="token keyword">import</span> com<span class="token punctuation">.</span>wgtwo<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>BearerTokenCallCredentials
<span class="token keyword">import</span> io<span class="token punctuation">.</span>grpc<span class="token punctuation">.</span>ManagedChannelBuilder
<span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>channels<span class="token punctuation">.</span>Channel
<span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>delay
<span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>catch
<span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>collect
<span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>flow
<span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>onEach
<span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>onStart
<span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>runBlocking
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>TimeUnit
<span class="token keyword">import</span> kotlin<span class="token punctuation">.</span>time<span class="token punctuation">.</span>Duration<span class="token punctuation">.</span>Companion<span class="token punctuation">.</span>seconds

<span class="token keyword">private</span> <span class="token keyword">val</span> grpcChannel <span class="token operator">=</span> ManagedChannelBuilder<span class="token punctuation">.</span><span class="token function">forTarget</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"api.wgtwo.com:443"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">keepAliveWithoutCalls</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">keepAliveTime</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> TimeUnit<span class="token punctuation">.</span>MINUTES<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">keepAliveTimeout</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> TimeUnit<span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">idleTimeout</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> TimeUnit<span class="token punctuation">.</span>HOURS<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">private</span> <span class="token keyword">val</span> stub <span class="token operator">=</span> NumberLookupServiceGrpcKt<span class="token punctuation">.</span><span class="token function">NumberLookupServiceCoroutineStub</span><span class="token punctuation">(</span>grpcChannel<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withCallCredentials</span><span class="token punctuation">(</span>BearerTokenCallCredentials <span class="token punctuation">{</span> <span class="token string-literal singleline"><span class="token string">"MY ACCESS TOKEN"</span></span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">val</span> phonebook <span class="token operator">=</span> <span class="token function">mapOf</span><span class="token punctuation">(</span>
    <span class="token string-literal singleline"><span class="token string">"+4799999999"</span></span> <span class="token keyword">to</span> <span class="token string-literal singleline"><span class="token string">"John Doe"</span></span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>

<span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">startStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> responseQueue <span class="token operator">=</span> Channel<span class="token operator">&lt;</span>NumberLookupResponse<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// Check queue to see if we have any responses and send them over the wire</span>
    <span class="token keyword">val</span> responseFlow <span class="token operator">=</span> flow <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>response <span class="token keyword">in</span> responseQueue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">emit</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    stub<span class="token punctuation">.</span><span class="token function">numberLookup</span><span class="token punctuation">(</span>responseFlow<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">onStart</span> <span class="token punctuation">{</span> <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"Starting new stream"</span></span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
        <span class="token punctuation">.</span><span class="token function">onEach</span> <span class="token punctuation">{</span> request<span class="token operator">:</span> NumberLookupRequest <span class="token operator">-></span>
            <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"Got request for </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">request<span class="token punctuation">.</span>number<span class="token punctuation">.</span>e164</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">val</span> displayName <span class="token operator">=</span> phonebook<span class="token punctuation">.</span><span class="token function">getOrDefault</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>number<span class="token punctuation">.</span>e164<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">""</span></span><span class="token punctuation">)</span>
            <span class="token keyword">val</span> response <span class="token operator">=</span> numberLookupResponse <span class="token punctuation">{</span>
                numberLookupRequest <span class="token operator">=</span> request
                result <span class="token operator">=</span> result <span class="token punctuation">{</span>
                    name <span class="token operator">=</span> displayName
                <span class="token punctuation">}</span>
                cacheControl <span class="token operator">=</span> cacheControl <span class="token punctuation">{</span>
                    maxAge <span class="token operator">=</span> Durations<span class="token punctuation">.</span><span class="token function">fromMinutes</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"Sending response for </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">response<span class="token punctuation">.</span>numberLookupRequest<span class="token punctuation">.</span>number<span class="token punctuation">.</span>e164</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">response<span class="token punctuation">.</span>result<span class="token punctuation">.</span>name</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            responseQueue<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token punctuation">.</span><span class="token function">catch</span> <span class="token punctuation">{</span> e <span class="token operator">-></span>
            <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"Got error: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">e<span class="token punctuation">.</span>message</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> - Will reconnect in 1s"</span></span><span class="token punctuation">)</span>
            <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">.</span>seconds<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> runBlocking <span class="token punctuation">{</span>
    <span class="token comment">// Run forever - if the stream fails we will reconnect</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">startStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><figcaption><a href="https://github.com/working-group-two/docs.wgtwo.com/blob/master/examples/kotlin/thirdpartydev/number-lookup/src/main/kotlin/com/wgtwo/examples/thirdpartydev/provider/Provider.kt" target="_blank" class="github-link">Provider.kt</a></figcaption></div></div></section></div></div><h2 id="flow"><a href="#flow" aria-hidden="true">#</a>Flow</h2><p>The API is implemented as a bidirectional gRPC service, where the provider responds to requests from the server.</p><p>The Number Provider sets up one or more connections to our API. This connection should use keep-alive, and has a max
connection age of one hour +/- a 10 % jitter. Once max connection age is reached, or any exception occurs, the
connection should be re-established.</p><blockquote><p><strong>Note:</strong><br>
Although the connection is set up from the provider to wg2, all requests are initiated from wg2.</p></blockquote><p><img src="data:image/svg+xml,%3csvg fill='none' viewBox='0 0 526 204' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-5e04992fd52eafcf052de42bea1ede41'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-5e04992fd52eafcf052de42bea1ede41)' width='526' height='204' xlink:href='data:image/svg%2bxml%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAAZCAYAAACB6CjhAAAACXBIWXMAAAsTAAALEwEAmpwYAAAGCklEQVRYw82Y629TZRzHn25DwVt8YfQNXgi%2bQE1IeA46J5Dof4CJM2Aw8saYeIdATEBNVBjGgDEmRIivCCQw41gisEmQINuy0cEmvZANe1kvp9dz2q6XbT2nPc/XPKeno%2bu6tWMt%2bCSfnKen5/Z8n9/zuzxkaOiT1Wbz7qfN5l21sNps3vXswMAHTxBCyNDQp6RRze3%2blTS6hUJdhKTTgwlFsSnZrGU6m7XMVCENjEGSLnTxB2Qy5uZ6f9SZMwJxOH4x8b7VevAZr/fkTlHs3O73n35HFOvCdlE8/d7Y2BGqv5APHggC8ALwVcHDgAQmJ6%2be5/fmcmMNESCZ7NOfK4pntgEhABP83cY3Lhc3gBii0fM/6y/kM8//YMylAW62EIy5OCoQQSJx5Q9%2br6ra6y5AZycl6fSQ/txgsKsdEPngFcCtARP1QB%2bDLF88XBRgpjC7LqblnVCzDqhKGVkHGHMyBlcOiHIBzvF7fb6rLYIgkKVAKZ09lsNbR4fAl6UuQCDwuyHARM6YgHqQ4wJI0p9H5giQU10s6IshHMggLKYQFtMGKQT9GcQjIW4JOW4%2b6XSfbgEA6jbzhggmQaCmvr4TLfyc3//b24C/VADDhO8O/ozCGKLzBchOu5nfoyKeAGQZkGNz8U/IbGrKluMfJIq9PfzenTu3PSYIwsO1Qinlx4c4lNJVlNKVlNIVGzZsMFUSZWqq500%2bW4Anp2lOXYAixoCwFFEWFUCZcTPRm0UsBkiSBtmA9/m5cbuXWSwX8hMTA7h06Vg/IU0vbN68qU0QhFeqQSnVKe1TSlsNXqWUvkYp3Uwp3cLZtKntdULI2u7uQx%2bl0xZoGjdbHyssVTc0zTlHhLpZgM%2bt6rMtSXOJRoGgL8Gg%2bwAZyeTV4hJoWo7Zt7a2cn9gEgShmVsCpfQBzocfvruKELLyxImvdvl8/RgZuZCzWHpZMDgMxvhgwrpH1zSX/nsJLCyAlncxORxENBBFNDiXiBhFKuEzBLjjBNPpf5qX6gD5oNvb2xcVBoCpEGUubuXv4z4gmbQwh%2bMvDAx04uDBPYjFrhvh0QHAWQMO3dEztoAA/E/9QuYwLi7njvlMThYEyGZtzbUOvJL3rxQNWlspicf7mwtRpnPWCaozXpaIZuAYE3H0p06MmMchh1MI%2bWII%2beOLEhbjCHrjSE/emcR5AhS8rBsMC1BiPpOTf58rzNCtBuQB5WEwwNdvLiH7mc/DEIsD2SwQjwORSGF51gK/NhKIMMBRRYAFcd1XAZJxPwsFuEPWEAopkKQ85BiDLNeCBkkGpBAXwHm3Atx/C/Av2wKiC1vArA9A7T5AUZbnAyrR1kZJIjEwzwcoug%2bYgnM8iONHuzA6/C%2bkUBpBH1/niaoEvYk5jnx%2bFNBcLBYOIBqMQColFOFrZ44DKUYBSbrWvNT0lx83btxI1q9fv1gUaCoIXIwCnlwqZWVO52X093fim293Q5KG6xsFSvMAbjLleUCoJA9IpWbzANNyTZ6LQSltopS2GLnAir17319JCHnw5MmvP/f7B/Q84ObNXiaK1/TYX6gQ65wHzM8EmU4xE7xtZIIeD88Ej/cTYuKZIM/iXq4FQRCK/fJssJgJbinJBN8ghDx/9mzHx6nUTeTz3HF5G58JLloLuGWWyVh5Sgqfr0evBXbseOtxQRAeqQaldPZo9PW6wKgHePZXMaOcnu7des9qAb0a9Mb1ajA0WwkW4NVgTK8GJ%2b5FNUgGB0%2bVV4Nq/cvh3vlRIJ9zQpnh9b%2bzjMr7AR7PlZZqXr1SBKgUDfg53g4cEEgmc61kQ0Rf7/nCjlBdyPNJlOWLR/6XO0J8Sywev2yEwVPtwDhU1a4qilVTFFs9UPlyCIW6D5ftCday5%2bbRgHjD9wRHR/cTY9f5Uav1u5fs9u/X2WyH1tntdePF4eE9T5JCRTeYVFV7Lpu1ZBXFqlRhCrgNSerpLmxYDNddgGK7deuHhm%2bLu1zHCbl%2bfe9zo6NfrhkZ2bdmZGT/ooyO8uO%2btUNDnz3FH3DjxhekERbgdB7T%2bzZbB18GTYFAp0kUz9STprGxH/Uc5j%2bHArgBZZjargAAAABJRU5ErkJggg==' /%3e%3c/svg%3e" width="526" data-src="/assets/static/number-lookup-3.8623c19.1cbf28011a5f2cfd70c9e3076974c872.svg" data-srcset="/assets/static/number-lookup-3.8623c19.1cbf28011a5f2cfd70c9e3076974c872.svg 526w" data-sizes="(max-width: 526px) 100vw, 526px" class="g-image g-image--lazy g-image--loading"><noscript><img src="/assets/static/number-lookup-3.8623c19.1cbf28011a5f2cfd70c9e3076974c872.svg" class="g-image g-image--loaded" width="526"></noscript></p><p>Using round-robin, wg2 will send number lookup requests
over these connections for which the provider will respond with the display name.</p><p>Responses will be cached for a period of time to avoid unnecessary requests and latency.</p><p><img src="data:image/svg+xml,%3csvg fill='none' viewBox='0 0 884 647' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-aae163a14217bb8f8777b9f5e71d7dcf'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-aae163a14217bb8f8777b9f5e71d7dcf)' width='884' height='647' xlink:href='data:image/svg%2bxml%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAAvCAYAAABTy8xRAAAACXBIWXMAAAsTAAALEwEAmpwYAAAQRUlEQVRo3tVaCXgb1bUeyU7iNd7txEvskMR2EpJYI0tek1LSQOG98pWl7zXAFxpaXtsHhPcKBbIUEkhCs9GEpKFpAjweNJBCKdAXkgIh2I7jdSbyJnvkWLZlLaPNsjXepJF033dmkWUjecvXfuF%2b3/lm5t57ztz7zzn3njn3YBiGYYZeN8Zde9zJpj52k0nvud2kZzcadK6NfT1jG/W9Yxv7ekY3Qp1Jz0LbnUadOxd4LLQX69WMBpHB9eN4eBkukV%2bQ4fHLMAsyxKLXuiRw7e0cyzD2sW/qe9z/wvUzeSXathEsVOnpGMVsdiQR5vSIUcee6GodjhVkYRpiKDgjbfSECdeHWDdC/f0IDQwgxDAIDQ8jNDTEX6HObkNcMdPet4BncAhJ9d3uiTLYcRlAogzx2W6fKGOA4WWIxUJ7wwQwn4Z%2btNFDwDNCSKK7PhYSABHEs8%2brwswmL/cWfbfrh1Bn7GPDKMIZnNFs8oqDfxAGa7Mh1mLxemtrO3x1dZSvurrNV1nZ5DObPT6bDbldLm7wb3AADPODD5QxMgIyfKzNhrwWq9enUvX6rl5V%2b4zGMZ/djnxWqy%2boDLH0iRqgGVtq6HV/0qd1bRY1oKt1OCQAoB0DDK8B%2bm7Xk4Ze9/vatpFEQQMkMwFgM%2bPkABizWn1sV5eDVatptr2dZpub%2bwAUmNQoTNBMe0%2bHAGAzaI4oA8AE/ro6ijWbPdyz1eqbKGNoIgDk51b42lhThTWCqhtWdtQ6s8U2qtEZEgCxreJys0RTP5yjJd2FxGXTfJDVUtGPaUhmWgAeAbUZHUUIvpDXO05Q3G6EYOCC%2bp4NAcAEGcAD/D4ffw91ATLeA55unSPs2KtnMBzHOdKpPdy4ulvGkqq/6CxWVZuWwnPV3ztCTwIAIHkAwFRqLnWtOv9hfanTgCKhroMYwChiMDijSc9KBDtZazZ5XzPT3kNmk/cwbfIcNBnYk0C0kT1oNnmPmGnvQTPt/b3J4LkPeOz9SNLX5QopA/oDv1HvPinwHjGbvAetZnTCQqN7hQFPGM8zT73IXd02BAtYxu7tv0sS%2b4RU44A2hFD4XZvuS8EwbCVCaAHU1V7qnpIXvmDQ%2bi9OayM/P6WNCNY2OIRmJOPSG70RZw9eiQrWdvfd/zpv7do1CwoKCiQ4jofjOB4N9Tt%2bvY8D1KFD0WgESTlwKYRNV2zdSARBihD/9a3aafjEgdNGj8Rq9YXZbCiMNnjCoe5609BiIK7d4AmHNiAL7eUG5RxBmGAC35Bh0rOcjHbCkY4QShAHBtc77vh%2bTmlpWQGO47fiOF6M4zjc5%2bI4vjJwbPp2tKStrj%2bOU%2bPGwWk1QF3fz92rGxyx6nrHLdz7GwckbXX20Lz6Hn4B0ne7QIU5Em1NQzKpQMK9v13c92HiPdSoX8aWh3/KXQsLC7FPz1VzX3GERkmP//zp2xOSYxaXlZbH4zieIJPJEnAcTxQoCcfxxXCFeqDysg0AWOxHZyvybd0oejr1n2wGFOGMoQjnEuFegs22%2bAWRTColADCTAUCBhSywIIRi//uJHeul87HE22/7XqRMJovDcTxeJpMF0kLxHtrKyzkAYj5%2brzLfpkUxcwFAQzDZwof75wEQOPmiouLFWdnpy7b953PKQ/tOLU9KiUtTKpQr5HJ5%2bEzHYdKgTHV9f%2by3DgClUomVlZYvTE6NT9v%2bzN5bdz67f9XijJQMpbIoC8fxMLGvTCYLSmdOfMgNur1hIFtDMt8eAET7n2QCCR%2b%2b81UOhmELS0vKUnAcXxjMVCbt6dygNQSzhCL%2byQCAkM5r/CIIO0AHOZDO%2bwuecJ3GhV35uAfrVA1x/TQikQx3hTpYrbubx7Djh9/mXlx1sSN165ZfbMIwLLq4uGSRXC7nFqdCeTFWVLgB%2b%2bmWp7CCNQqsUFaKFaxRcn5BR%2bOAhB/LRAAmk4Zg%2bCvp9L9fmHQMJQAAi%2bBMP56/tFTy28mldzujUQ0Kx%2bZQvvxUhfHb10DKY48%2buTEyJiylSFkUMxNehw6JE1kCk5mDBsdQJLNE0OLZa0D/AL9fW2m0V9Nhr6qsaPnEbPKe07aO3KKuG4jTkEwSRTCJPDkTKZLhCe4JZ6IGiOvjXKghmVzkQVngmDAGFN/ROJho6UIJxw68nXF475nMv52rSd37m%2bNLXnnxZNaBPX/IMl9HCe0NDuCN1RDMrbCdUYQzjpctvJN0Cu91%2bsegEeo0pDOeIphMimBwimTCBVOaHQBDLh4AuwWd1VA2pqH%2busVC%2by5qW0Y5r7C7fURCgdoLRIEqkjxphKu4/1KEM%2b1alXER3F/4S73k3%2b/fytWHh8/LCpOGrQ0PC18qlYbJpVJpSXh4OKwV2KmjH0gF3mwAUVRl/l2iCQS8VzAF8WtTJBOlIZiVGsIZIfowswCAwYi/W3iPqs6R7%2bhFiwLb7RY0YznCwFOBAusmlW%2bo6N4XjnIAtNXZs1XVNLcGPPTjrdOqsvilKdIZRZFMPkUwC2azgIt2h6lrB8X7Fa01tiTOLh1IYuxlxX/2IF8h8MtMWJD8ABCVBmz9%2bg3YypWruLbysvWTd4wJzyM0yhB9en6HUcD2ipWUlGHFxSXfoIoLan4Nq7FGUYQzX0PyAMzSBBisq2VYHHye6Ap3tQ5LBH8f6%2bkYmRGQogZcVw2nBptgYMnLyxN9iVSFQokvvWVJ7tPbdpVveeix3PyVufmFhYVZM50D/AV2XhvK72gcnJsGaEhnIAApIjAacuYUqAGqajoN7rf98jmpQqGQBKPCQoX09ts2YXK5PLqoqHhpRmZa5u6dh/Gf/%2bypnGXLl2YqFIpUpbJIoigMzg/0o/se5EznlT0nktvq7Kt6Wt0LpjC90ACIwQWKYHIp0pkSGHCYrTOlbRpNPfvmBVjcIsrK1scWFBTETEXrCtZFbfre92HgkvMf1C4/ceQdeH9YkbIoYjpehUIZsyBKEn3Hprse%2bOKTazKE0Lwb1QCZhmRWgjtKkUyShhS3HCYRtjN1fX9Sa60tqaXGmqRucCQGtmv4/rEU4QR%2bsMdYoS5xKmpvcCQ2XTUnk1XGOHWDY426vn%2bJqtoUD%2b%2bZjlcg2KYzNSRTTBHOqLlpwLj65lEErwHgUkI9ciFQsaC825/Zy9m5YAbiNuj/pdY2jUqGTQibjrqaRiUBjhAf2m5jp%2bWDPpwHqxqJgg9HEc65rQEdhH8XyG26auYGf%2bDlk5L8lXnY6tWruMHJZLL5OI7H8v/zsjQcxzm0oR367d99nOvXWmtLo4hBTkabELCYrrQ3iK4w5wTFCiv7tHzNNRbB%2bxycsAvMGoDuFpfoxuYhhOKC9VMoFFK5XJ6O4/gKHMcLcRwPukp7%2b1Gitmk0hQ90uma2gPodmnEAYA2aCa8whyjO7AQN0MwWgM8%2bqucDk1aUs%2bWhn92XkZm2rLSkDKI3KTKZDP7oUuEqk8mSAoIayVAvUEpxcUkqFobFH3z59dU1X3ZxYbWKz9Qz8stv9G/QD8BcNaD%2bci8m2N2KAy%2bfhDhd9Hc2fDdaUPkYmUy2QCaTRchkskjhOQpMQqgHilpf/h0Y%2bIK3Xv/rLWSVgfMmRbk3PQDa5rFAE4gX2%2bRyeQSO42twHF%2bL47gC1F4IaK4VaB3Ol6gAp2RhT4s7RVzIvhUAtDcM%2bBfBuss9nBPz2KNPSiGaA6FrCGxC7A6%2bPgQ4cByPCwhyQtt8cHqA78XtB2V1X/VwGvDqK6e5ia1bt%2b4fGhC5YQCuXTEK28lw7v/%2b8W/gxESWl22AwGWsTCaLFlQ%2batJ9ZADFblh/G/zHhz/y8H888PVnbemB7ygvL7%2b5NaDz2pAoME/X5kmeS0AE1oz5kVjSp%2beqs949cz5HOh9LKC0pSy4uLsb%2b0SGxGwYg0BGCiA7cf/SnCol4fjcdCX968dk5mav%2b64kd5Tt%2bva8wOydztVJZtFycvFwuv4kBIP1B0Qk/QzMtgV8XFtE/v/0lxOdiS0u5rTTi5teAGwBAnNi7Z85L%2bBiAPu3pbbuUsI5AUBTH8ZzJAIA2iM9wbauz%2bz3BuYTFbwoALp9v5a6NFX0pm//tkR8lp8allRSXgrM0L5gGKBQKrKCggLs/tO8PUsGNziYq9FxIbOuWX0hEvlDac9OYAPfjI/gSXaqRVPAFpjo%2bE88S4EAlsLB2BAerEaH4Jsu8ruIDOc1XLXP/FxBDXIIN%2biNCGoKRaCbF4wPPBibG650TgqJEpZ7zA0699r70rdf/yoEDW23TVbOfnvzlsxIBhEVKZZFyRe6yVU89/vyGhzc/mr/61lWwgOYIpoV9%2bWnTBF6gllorprpiGo8IkeMRoVkFRQM7U4RzBfzfYzdQKMKZrCGZ2Wyl8/Lyc9MxKZa678XX1j629YnM6IXz0zKyFsXPVMCvtu2CiFB%2bT4t7egBMeo8/U8RMe8PNJp68CEk7VYy8s2kor7t9JKardThR2zqcoG0bTrjePBTHHT%2bRjJ/guVPFLIR26NcF1DYUo20ZXX7%2bw5p1L71wJOP4kf/JPnrojexjh9/MPrTv9azdOw%2bnv7Tr1fQ9u46kv7TrSPqenYfT9%2b8%2bvvjUsfdTXv3t6YTPPyHXffDOpWW/%2b%2b2ZxKMH3kzbs1PoF4x2Hknf%2b8LR9Gd/tWfxgz/%2byaOXP2stRQjNh7nBSdeUZmDSe4L%2bpV05p1945c99QX%2bHO1VDYGeRInWqmOjKP%2bnCJvereq8v9vI73bHBt7vB6PZ6R2R7w0BUe4MjCv7jwX4bq/q4/tcum5df/T9dXMVF9QKyyhDd0Qj9piZ1vWPeUCeKbrsysIyLYHe5pv4DDcjvWWk2eV8ym7y7zCbvb6wWtMNk8OynjZ79FrPveTPt3WmmvdvNtPdl2uC5MwSQeWaTd7eZ9u6A/haz93mTgX2FNsxchj9xo9stp42e60Yd%2b9xszc7Yxx6jDZ5mXefYUkFW6PNBejzD6ydiNpiHHc8Ug8RHrwchj4evEzK83gee/gEUBiF0ODj9hgyBB2T474PJcPAyxAWUNnjERMnHhUTJCnh2IcTlCQY7JAUSs0gP3HlJaqa93VyipNZ192wSJTc7hTxBi8Xjrqxqdn/9tYr96iuCvXCh2k3TbndAnuAfQ%2bYJcjJ8Y5BUCUmRkCN48WINazCMuu12ri6oDLGIyZCd15hFPdTIIW3b8B2cdhlYSccUeYKw0PmEc4du9cj93R0je9trB2N5c2VmlCcoJjm6IMmRpllWrx/hqK9vmBWyP8cgB3CqRMmhABl2O2J1uiFWo7GxYuKk1eoLKkMsbdWDXGC19vNeqa7Zt6aLHOW2YV09mjpPEAK2Jh6AnibPIroDrRZPmjsbR0KfDvnzfA2eLaA28HXGxsYTHUWCOkilFdT33fEsT1dIGUCiObjGgsvgc4Vd/vGoGxz88Vu7d/Hp43%2bRV17s4Baz%2bZFhM84T/Pi9K6v3vfj7Mt8A74BBMDZkoqRRJyyCOvci2uC5lzZ6fkAbPPeYDOw9Jv04QR1t8PyANnruN/axa7jjc4sPgwTmUDJoo4fjNfa57xGfQ8kQywM/3CJOBEBNvmvTvZGTJzkNAJLIyCiISGWKaXkfn70S9GDn/wFvb1Ucjn1FugAAAABJRU5ErkJggg==' /%3e%3c/svg%3e" width="884" data-src="/assets/static/number-lookup-2.3c7d887.e9bedc3e9f4ce56212cf462a97b214bb.svg" data-srcset="/assets/static/number-lookup-2.82a2fbd.e9bedc3e9f4ce56212cf462a97b214bb.svg 480w, /assets/static/number-lookup-2.3c7d887.e9bedc3e9f4ce56212cf462a97b214bb.svg 884w" data-sizes="(max-width: 884px) 100vw, 884px" class="g-image g-image--lazy g-image--loading"><noscript><img src="/assets/static/number-lookup-2.3c7d887.e9bedc3e9f4ce56212cf462a97b214bb.svg" class="g-image g-image--loaded" width="884"></noscript></p><h2 id="request--response"><a href="#request--response" aria-hidden="true">#</a>Request / Response</h2><p>For matching the response to the original request, the provider must include the original request in the response.</p><p>The returned display name may be empty if the provider does not have a display name for the number, and
may be cached for the duration specified.</p><h3 id="request"><a href="#request" aria-hidden="true">#</a>Request</h3><pre class="language-prototext"><code class="language-prototext">NumberLookupRequest {
  id: &quot;opaque string&quot;
  number {
    e164: &quot;+1234567890&quot;
  }
}</code></pre><h3 id="response"><a href="#response" aria-hidden="true">#</a>Response</h3><pre class="language-prototext"><code class="language-prototext">NumberLookupResponse {
  number_lookup_request { } # Fields omitted for brevity

  result {
    name: &quot;John Doe&quot;
  }
}</code></pre><h3 id="response-upstream-error"><a href="#response-upstream-error" aria-hidden="true">#</a>Response, upstream error</h3><pre class="language-prototext"><code class="language-prototext">NumberLookupResponse {
  number_lookup_request { } # Fields omitted for brevity

  error {
    message: &quot;Database unavailable&quot;
  }
}</code></pre><h2 id="limitations-for-display-name"><a href="#limitations-for-display-name" aria-hidden="true">#</a>Limitations for display name</h2><p>The display name returned must be max 60 characters, and may only contain the following:</p><ul><li>alphanumeric (<code>a-z</code>, <code>A-Z</code>, <code>0-9</code>)</li><li><code></code>(space), <code>-</code>, <code>_</code></li><li><code>.</code>, <code>!</code>, <code>%</code>, <code>*</code>, <code>'</code>, <code>+</code>, <code>~</code>, <code>`</code></li></ul><p>Characters not matching the above will be stripped.</p><h2 id="error-handling"><a href="#error-handling" aria-hidden="true">#</a>Error handling</h2><p>If there are no healthy connections for the provider, the provider will be ignored.</p><p>Should the provider fail to respond within the set deadline, it will be treated as if it returned an empty result.</p><p>For upstream errors, the provider must return an error, accompanied by a descriptive, human-readable message.</p><h2 id="cache"><a href="#cache" aria-hidden="true">#</a>Cache</h2><p>As part of the response, the provider can include a cache TTL.</p><p>This is the time in seconds that the display name should be cached on the wg2 side.
If not set, a default cache TTL documented in the proto file will be used.</p><pre class="language-prototext"><code class="language-prototext">NumberLookupResponse {
  number_lookup_request { } # Fields omitted for brevity

  result {
    name: &quot;John Doe&quot;
  }

  # Optional, set to default if not set
  cache_control {
    max_age {
      seconds: 3600  # 1 hour, google.protobuf.Duration
    }
  }
}</code></pre><h2 id="recommended-grpc-connection-settings"><a href="#recommended-grpc-connection-settings" aria-hidden="true">#</a>Recommended gRPC connection settings</h2><table><thead><tr><th align="left">Setting</th><th align="left">Value</th><th>Description</th></tr></thead><tbody><tr><td align="left">keep-alive period</td><td align="left">1 minute</td><td>Must be  1 minute and  5 minutes</td></tr><tr><td align="left">keep-alive timeout</td><td align="left">10 seconds</td><td></td></tr><tr><td align="left">permit keep-alive without calls</td><td align="left">true</td><td></td></tr></tbody></table><h3 id="keep-alive"><a href="#keep-alive" aria-hidden="true">#</a>Keep-Alive</h3><p>The load balancer hosting api.wgtwo.com will silently drop connections if they have been idle for 350 seconds (5m 50s).</p><p>To avoid this, the provider should send a keep-alive message every minute.</p><h2 id="local-testing"><a href="#local-testing" aria-hidden="true">#</a>Local testing</h2><p>For local testing, you can use our sandbox environment hosted at <code>api.sandbox.wgtwo.com</code>.</p><p>In addition to that, we do provide a test application that can be used for testing which may be useful to see
how your provider behaves under heavy load.</p><p>The test application is hosted
at <a href="https://github.com/working-group-two/number-lookup-provider-tester" target="_blank" rel="nofollow noopener noreferrer">github.com/working-group-two/number-lookup-provider-tester</a>.</p><p>By setting up a stream to this application, it will send number lookup requests at the configured rate.
It will not do any flow control, but show number of in-flight messages (requests sent - responses received).</p><h3 id="docker"><a href="#docker" aria-hidden="true">#</a>Docker</h3><p>The test application is also available as a pre-built docker image. Usage:</p><pre class="language-shell"><code class="language-shell"><span class="token function">docker</span> run --network<span class="token operator">=</span>host ghcr.io/working-group-two/number-lookup-provider-tester:latest <span class="token punctuation">\</span>
    --address :8118 <span class="token punctuation">\</span>
    --rps <span class="token number">5</span> <span class="token punctuation">\</span>
    --numbers <span class="token number">4799990001,4799990002</span>,4799990003 <span class="token punctuation">\</span>
    --print-progress <span class="token punctuation">\</span>
    --print-requests <span class="token punctuation">\</span>
    --print-responses</code></pre><h2 id="continue-reading"><a href="#continue-reading" aria-hidden="true">#</a>Continue reading</h2><ul><li><a href="/number-lookup/api-reference/">API reference</a></li></ul><h2 id="concepts"><a href="#concepts" aria-hidden="true">#</a>Concepts</h2><ul><li><a href="https://grpc.io/docs/guides/concepts/" target="_blank" rel="nofollow noopener noreferrer">gRPC concepts</a></li><li><a href="https://grpc.io/docs/languages/kotlin/basics/" target="_blank" rel="nofollow noopener noreferrer">Kotlin gRPC tutorial</a></li><li><a href="https://grpc.io/docs/reference/java/generated-code/" target="_blank" rel="nofollow noopener noreferrer">Java gRPC stubs</a></li></ul></div></div><footer data-v-39f0b824 data-v-5e0e6af4><aside class="editthispage" data-v-39f0b824 data-v-5e0e6af4><a href="https://github.com/working-group-two/docs.wgtwo.com/blob/master/docs/number-lookup-how-to.md" target="_blank" icon-left="pencil" data-v-39f0b824 data-v-5e0e6af4><span class="icon is-small" data-v-5e0e6af4><i class="mdi mdi-pencil"></i></span>
          Edit page
        </a></aside><nav class="previous-next-buttons" data-v-39f0b824 data-v-5e0e6af4><a href="/number-lookup/overview/" class="button is-link is-inverted docs-nav__link" data-v-5e0e6af4>
           Overview
        </a><a href="/number-lookup/api-reference/" class="button is-link is-inverted docs-nav__nextlink" data-v-5e0e6af4>
          API reference 
        </a></nav></footer></div></div><nav class="articlenav is-hidden-touch" data-v-39f0b824><h3 data-v-39f0b824 data-v-5e0e6af4>ON THIS PAGE</h3><ul class="anchormenu" data-v-39f0b824 data-v-5e0e6af4><li data-v-39f0b824 data-v-5e0e6af4><a href="#prerequisites" aria-current="page" class="active--exact active" data-v-5e0e6af4>
          Prerequisites
        </a><ul class="anchormenu__sub-menu" data-v-39f0b824 data-v-5e0e6af4><li data-v-39f0b824 data-v-5e0e6af4><a href="#required-scope" aria-current="page" class="active--exact active" data-v-5e0e6af4>
              Required scope
            </a></li></ul></li><li data-v-39f0b824 data-v-5e0e6af4><a href="#how-to-use-the-api" aria-current="page" class="active--exact active" data-v-5e0e6af4>
          How to use the API
        </a><ul class="anchormenu__sub-menu" data-v-39f0b824 data-v-5e0e6af4></ul></li><li data-v-39f0b824 data-v-5e0e6af4><a href="#flow" aria-current="page" class="active--exact active" data-v-5e0e6af4>
          Flow
        </a><ul class="anchormenu__sub-menu" data-v-39f0b824 data-v-5e0e6af4></ul></li><li data-v-39f0b824 data-v-5e0e6af4><a href="#request--response" aria-current="page" class="active--exact active" data-v-5e0e6af4>
          Request / Response
        </a><ul class="anchormenu__sub-menu" data-v-39f0b824 data-v-5e0e6af4><li data-v-39f0b824 data-v-5e0e6af4><a href="#request" aria-current="page" class="active--exact active" data-v-5e0e6af4>
              Request
            </a></li><li data-v-39f0b824 data-v-5e0e6af4><a href="#response" aria-current="page" class="active--exact active" data-v-5e0e6af4>
              Response
            </a></li><li data-v-39f0b824 data-v-5e0e6af4><a href="#response-upstream-error" aria-current="page" class="active--exact active" data-v-5e0e6af4>
              Response, upstream error
            </a></li></ul></li><li data-v-39f0b824 data-v-5e0e6af4><a href="#limitations-for-display-name" aria-current="page" class="active--exact active" data-v-5e0e6af4>
          Limitations for display name
        </a><ul class="anchormenu__sub-menu" data-v-39f0b824 data-v-5e0e6af4></ul></li><li data-v-39f0b824 data-v-5e0e6af4><a href="#error-handling" aria-current="page" class="active--exact active" data-v-5e0e6af4>
          Error handling
        </a><ul class="anchormenu__sub-menu" data-v-39f0b824 data-v-5e0e6af4></ul></li><li data-v-39f0b824 data-v-5e0e6af4><a href="#cache" aria-current="page" class="active--exact active" data-v-5e0e6af4>
          Cache
        </a><ul class="anchormenu__sub-menu" data-v-39f0b824 data-v-5e0e6af4></ul></li><li data-v-39f0b824 data-v-5e0e6af4><a href="#recommended-grpc-connection-settings" aria-current="page" class="active--exact active" data-v-5e0e6af4>
          Recommended gRPC connection settings
        </a><ul class="anchormenu__sub-menu" data-v-39f0b824 data-v-5e0e6af4><li data-v-39f0b824 data-v-5e0e6af4><a href="#keep-alive" aria-current="page" class="active--exact active" data-v-5e0e6af4>
              Keep-Alive
            </a></li></ul></li><li data-v-39f0b824 data-v-5e0e6af4><a href="#local-testing" aria-current="page" class="active--exact active" data-v-5e0e6af4>
          Local testing
        </a><ul class="anchormenu__sub-menu" data-v-39f0b824 data-v-5e0e6af4><li data-v-39f0b824 data-v-5e0e6af4><a href="#docker" aria-current="page" class="active--exact active" data-v-5e0e6af4>
              Docker
            </a></li></ul></li><li data-v-39f0b824 data-v-5e0e6af4><a href="#continue-reading" aria-current="page" class="active--exact active" data-v-5e0e6af4>
          Continue reading
        </a><ul class="anchormenu__sub-menu" data-v-39f0b824 data-v-5e0e6af4></ul></li><li data-v-39f0b824 data-v-5e0e6af4><a href="#concepts" aria-current="page" class="active--exact active" data-v-5e0e6af4>
          Concepts
        </a><ul class="anchormenu__sub-menu" data-v-39f0b824 data-v-5e0e6af4></ul></li></ul></nav></div></div></div></main><footer class="footer docsnav is-hidden-desktop" data-v-39f0b824><div class="docs-nav__container" data-v-39f0b824 data-v-5e0e6af4><h3 class="is-uppercase" data-v-39f0b824 data-v-5e0e6af4>
        intro
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-5e0e6af4><li data-v-5e0e6af4><a href="/intro/get-started/" class="dosc_nav__anchor" data-v-5e0e6af4>Get started</a></li><li data-v-5e0e6af4><a href="/intro/api-structure-and-libraries/" class="dosc_nav__anchor" data-v-5e0e6af4>API structure and libraries</a></li><li data-v-5e0e6af4><a href="/intro/sandbox-environment/" class="dosc_nav__anchor" data-v-5e0e6af4>Sandbox Environment</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-5e0e6af4><h3 class="is-uppercase" data-v-39f0b824 data-v-5e0e6af4>
        oauth 2.0
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-5e0e6af4><li data-v-5e0e6af4><a href="/oauth-2-0/overview/" class="dosc_nav__anchor" data-v-5e0e6af4>Overview</a></li><li data-v-5e0e6af4><a href="/oauth-2-0/create-o-auth-2-0-client/" class="dosc_nav__anchor" data-v-5e0e6af4>Create OAuth 2.0 client</a></li><li data-v-5e0e6af4><a href="/oauth-2-0/get-user-access-token/" class="dosc_nav__anchor" data-v-5e0e6af4>Get user access token</a></li><li data-v-5e0e6af4><a href="/oauth-2-0/get-client-access-token/" class="dosc_nav__anchor" data-v-5e0e6af4>Get client access token</a></li><li data-v-5e0e6af4><a href="/oauth-2-0/support-revoking-consent/" class="dosc_nav__anchor" data-v-5e0e6af4>Support revoking consent</a></li><li data-v-5e0e6af4><a href="/oauth-2-0/why-support-user-revoking-of-consent/" class="dosc_nav__anchor" data-v-5e0e6af4>Why support user revoking of consent</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-5e0e6af4><h3 class="is-uppercase" data-v-39f0b824 data-v-5e0e6af4>
        mms
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-5e0e6af4><li data-v-5e0e6af4><a href="/mms/send-mms/" class="dosc_nav__anchor" data-v-5e0e6af4>Send MMS</a></li><li data-v-5e0e6af4><a href="/mms/mms-api-reference/" class="dosc_nav__anchor" data-v-5e0e6af4>MMS API reference</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-5e0e6af4><h3 class="is-uppercase" data-v-39f0b824 data-v-5e0e6af4>
        events
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-5e0e6af4><li data-v-5e0e6af4><a href="/events/listen-for-events/" class="dosc_nav__anchor" data-v-5e0e6af4>Listen for events</a></li><li data-v-5e0e6af4><a href="/events/configuration-and-types/" class="dosc_nav__anchor" data-v-5e0e6af4>Configuration and types</a></li><li data-v-5e0e6af4><a href="/events/events-api-reference/" class="dosc_nav__anchor" data-v-5e0e6af4>Events API reference</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-5e0e6af4><h3 class="is-uppercase" data-v-39f0b824 data-v-5e0e6af4>
        subscription profile
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-5e0e6af4><li data-v-5e0e6af4><a href="/subscription-profile/overview/" class="dosc_nav__anchor" data-v-5e0e6af4>Overview</a></li><li data-v-5e0e6af4><a href="/subscription-profile/manage-subscriptions/" class="dosc_nav__anchor" data-v-5e0e6af4>Manage subscriptions</a></li><li data-v-5e0e6af4><a href="/subscription-profile/subscription-profile-api-reference/" class="dosc_nav__anchor" data-v-5e0e6af4>Subscription profile API reference</a></li><li data-v-5e0e6af4><a href="/subscription-profile/subscription-services/" class="dosc_nav__anchor" data-v-5e0e6af4>Subscription services</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-5e0e6af4><h3 class="is-uppercase" data-v-39f0b824 data-v-5e0e6af4>
        network information
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-5e0e6af4><li data-v-5e0e6af4><a href="/network-information/get-subscriber-network-information/" class="dosc_nav__anchor" data-v-5e0e6af4>Get subscriber network information</a></li><li data-v-5e0e6af4><a href="/network-information/network-info-api/" class="dosc_nav__anchor" data-v-5e0e6af4>Network info API</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-5e0e6af4><h3 class="is-uppercase" data-v-39f0b824 data-v-5e0e6af4>
        call forwarding
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-5e0e6af4><li data-v-5e0e6af4><a href="/call-forwarding/set-call-forwarding/" class="dosc_nav__anchor" data-v-5e0e6af4>Set call forwarding</a></li><li data-v-5e0e6af4><a href="/call-forwarding/call-forwarding-api-reference/" class="dosc_nav__anchor" data-v-5e0e6af4>Call forwarding API reference</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-5e0e6af4><h3 class="is-uppercase" data-v-39f0b824 data-v-5e0e6af4>
        pbx
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-5e0e6af4><li data-v-5e0e6af4><a href="/pbx/pbx-tas-integration/" class="dosc_nav__anchor" data-v-5e0e6af4>PBX/TAS integration</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-5e0e6af4><h3 class="is-uppercase" data-v-39f0b824 data-v-5e0e6af4>
        number lookup
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-5e0e6af4><li data-v-5e0e6af4><a href="/number-lookup/overview/" class="dosc_nav__anchor" data-v-5e0e6af4>Overview</a></li><li class="active--exact active" data-v-5e0e6af4><a href="/number-lookup/technical-guide/" aria-current="page" class="dosc_nav__anchor" data-v-5e0e6af4>Technical guide</a></li><li data-v-5e0e6af4><a href="/number-lookup/api-reference/" class="dosc_nav__anchor" data-v-5e0e6af4>API reference</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-5e0e6af4><h3 class="is-uppercase" data-v-39f0b824 data-v-5e0e6af4>
        metrics
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-5e0e6af4><li data-v-5e0e6af4><a href="/metrics/accessing-metrics/" class="dosc_nav__anchor" data-v-5e0e6af4>Accessing Metrics</a></li></ul></div><div class="docs-nav__container" data-v-39f0b824 data-v-5e0e6af4><h3 class="is-uppercase" data-v-39f0b824 data-v-5e0e6af4>
        web terminal
      </h3><ul class="docs-nav__list" data-v-39f0b824 data-v-5e0e6af4><li data-v-5e0e6af4><a href="/web-terminal/create-a-web-terminal-to-make-and-receive-calls/" class="dosc_nav__anchor" data-v-5e0e6af4>Create a Web Terminal to make and receive calls</a></li><li data-v-5e0e6af4><a href="/web-terminal/web-terminal-api-reference/" class="dosc_nav__anchor" data-v-5e0e6af4>Web Terminal API reference</a></li></ul></div></footer></div>
    <script>window.__INITIAL_STATE__={"data":{"doc":{"title":"Technical guide","headings":[{"value":"Number Lookup API - Technical Guide"}],"subtitles":[{"depth":1,"value":"Number Lookup API - Technical Guide","anchor":"#number-lookup-api---technical-guide"},{"depth":2,"value":"Prerequisites","anchor":"#prerequisites","children":[{"depth":3,"value":"Required scope","anchor":"#required-scope","children":[]}]},{"depth":3,"value":"Required scope","anchor":"#required-scope","children":[]},{"depth":2,"value":"How to use the API","anchor":"#how-to-use-the-api","children":[]},{"depth":2,"value":"Flow","anchor":"#flow","children":[]},{"depth":2,"value":"Request \u002F Response","anchor":"#request--response","children":[{"depth":3,"value":"Request","anchor":"#request","children":[]},{"depth":3,"value":"Response","anchor":"#response","children":[]},{"depth":3,"value":"Response, upstream error","anchor":"#response-upstream-error","children":[]}]},{"depth":3,"value":"Request","anchor":"#request","children":[]},{"depth":3,"value":"Response","anchor":"#response","children":[]},{"depth":3,"value":"Response, upstream error","anchor":"#response-upstream-error","children":[]},{"depth":2,"value":"Limitations for display name","anchor":"#limitations-for-display-name","children":[]},{"depth":2,"value":"Error handling","anchor":"#error-handling","children":[]},{"depth":2,"value":"Cache","anchor":"#cache","children":[]},{"depth":2,"value":"Recommended gRPC connection settings","anchor":"#recommended-grpc-connection-settings","children":[{"depth":3,"value":"Keep-Alive","anchor":"#keep-alive","children":[]}]},{"depth":3,"value":"Keep-Alive","anchor":"#keep-alive","children":[]},{"depth":2,"value":"Local testing","anchor":"#local-testing","children":[{"depth":3,"value":"Docker","anchor":"#docker","children":[]}]},{"depth":3,"value":"Docker","anchor":"#docker","children":[]},{"depth":2,"value":"Continue reading","anchor":"#continue-reading","children":[]},{"depth":2,"value":"Concepts","anchor":"#concepts","children":[]}],"roles":["THIRD_PARTY_DEVELOPER"],"hideWarning":null,"sourceExamples":[{"file":"examples\u002Fgrpcurl\u002Fthirdpartydev\u002Fnumber-lookup\u002Fprovider.sh","content":"#!\u002Fusr\u002Fbin\u002Fenv bash\n\n# Download the API definition\ncurl -sL 'https:\u002F\u002Fgithub.com\u002Fworking-group-two\u002Fwgtwoapis\u002Fblob\u002Fmaster\u002Fimage.bin?raw=true' -o proto\u002Fwgtwo.bin\n\n# Access token must be obtained via the client credentials flow\nACCESS_TOKEN=$(\n  curl -s -u $CLIENT_ID:$CLIENT_SECRET \\\n    --request POST \\\n    --url 'https:\u002F\u002Fid.wgtwo.com\u002Foauth2\u002Ftoken' \\\n    --header 'content-type: application\u002Fx-www-form-urlencoded' \\\n    --data grant_type=\"client_credentials\" \\\n    --data scope=\"lookup.number:read\" \\\n  | jq -r .access_token\n)\n\n# We send data to grpcurl via a PIPE, and receive data via stdout.\nPIPE=\u002Ftmp\u002Fprovider-PIPE\nmkfifo $PIPE\nexec 3\u003C\u003E $PIPE\n\ncleanup() {\n    echo \"Cleaning up...\"\n    rm -f $PIPE\n    exec 3\u003E&-\n    exit\n}\ntrap cleanup INT TERM EXIT\n\ngrpcurl \\\n   -H \"Authorization: Bearer $ACCESS_TOKEN\" \\\n   -protoset wgtwo.bin \\\n   -d @ \\\n   api.wgtwo.com:443 \\\n   wgtwo.lookup.v0.NumberLookupService\u002FNumberLookup \u003C&3 \\\n| while IFS= read -r LINE; do\n    # grpcurl sends output line by line, so we buffer until we have a valid JSON object.\n    BUFFER+=\"$LINE\"\n    if ! jq . \u003E\u002Fdev\u002Fnull 2\u003E&1 \u003C\u003C\u003C\"$BUFFER\"; then continue; fi\n\n    # Create a JSON response that includes the request and a dummy result.\n    RESPONSE_JSON=$(jq -c -n --argjson incoming_content \"$BUFFER\" \\\n      '{\n          number_lookup_request: $incoming_content,\n          result: {\n            name: \"John Doe\"\n          }\n      }'\n    )\n\n    # Send the response to grpcurl via the PIPE.\n    echo \"$RESPONSE_JSON\" \u003E $PIPE\n\n    echo \"Sent response:\"\n    echo \"$RESPONSE_JSON\" | jq .\n    echo \"\"\n\n    # Clear the buffer.\n    BUFFER=\"\"\ndone\n"},{"file":"examples\u002Fkotlin\u002Fthirdpartydev\u002Fnumber-lookup\u002Fsrc\u002Fmain\u002Fkotlin\u002Fcom\u002Fwgtwo\u002Fexamples\u002Fthirdpartydev\u002Fprovider\u002FProvider.kt","content":"package com.wgtwo.examples.thirdpartydev.numberlookup\n\nimport com.google.protobuf.util.Durations\nimport com.wgtwo.api.v0.lookup.NumberLookupProto.NumberLookupRequest\nimport com.wgtwo.api.v0.lookup.NumberLookupProto.NumberLookupResponse\nimport com.wgtwo.api.v0.lookup.NumberLookupServiceGrpcKt\nimport com.wgtwo.api.v0.lookup.cacheControl\nimport com.wgtwo.api.v0.lookup.numberLookupResponse\nimport com.wgtwo.api.v0.lookup.result\nimport com.wgtwo.auth.BearerTokenCallCredentials\nimport io.grpc.ManagedChannelBuilder\nimport kotlinx.coroutines.channels.Channel\nimport kotlinx.coroutines.delay\nimport kotlinx.coroutines.flow.catch\nimport kotlinx.coroutines.flow.collect\nimport kotlinx.coroutines.flow.flow\nimport kotlinx.coroutines.flow.onEach\nimport kotlinx.coroutines.flow.onStart\nimport kotlinx.coroutines.runBlocking\nimport java.util.concurrent.TimeUnit\nimport kotlin.time.Duration.Companion.seconds\n\nprivate val grpcChannel = ManagedChannelBuilder.forTarget(\"api.wgtwo.com:443\")\n    .keepAliveWithoutCalls(true)\n    .keepAliveTime(1, TimeUnit.MINUTES)\n    .keepAliveTimeout(10, TimeUnit.SECONDS)\n    .idleTimeout(1, TimeUnit.HOURS)\n    .build()\n\nprivate val stub = NumberLookupServiceGrpcKt.NumberLookupServiceCoroutineStub(grpcChannel)\n    .withCallCredentials(BearerTokenCallCredentials { \"MY ACCESS TOKEN\" })\n\nval phonebook = mapOf(\n    \"+4799999999\" to \"John Doe\",\n)\n\nsuspend fun startStream() {\n    val responseQueue = Channel\u003CNumberLookupResponse\u003E()\n\n    \u002F\u002F Check queue to see if we have any responses and send them over the wire\n    val responseFlow = flow {\n        for (response in responseQueue) {\n            emit(response)\n        }\n    }\n    stub.numberLookup(responseFlow)\n        .onStart { println(\"Starting new stream\") }\n        .onEach { request: NumberLookupRequest -\u003E\n            println(\"Got request for ${request.number.e164}\")\n            val displayName = phonebook.getOrDefault(request.number.e164, \"\")\n            val response = numberLookupResponse {\n                numberLookupRequest = request\n                result = result {\n                    name = displayName\n                }\n                cacheControl = cacheControl {\n                    maxAge = Durations.fromMinutes(60)\n                }\n            }\n            println(\"Sending response for ${response.numberLookupRequest.number.e164}: ${response.result.name}\")\n            responseQueue.send(response)\n        }\n        .catch { e -\u003E\n            println(\"Got error: ${e.message} - Will reconnect in 1s\")\n            delay(1.seconds)\n        }\n        .collect()\n}\n\nfun main() = runBlocking {\n    \u002F\u002F Run forever - if the stream fails we will reconnect\n    while (true) {\n        startStream()\n    }\n}\n"}]}},"context":{}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script><script src="/assets/js/app.71c4068d.js" defer></script><script src="/assets/js/page--src--templates--doc-page-vue.44e11ace.js" defer></script><script src="/assets/js/vue-remark--docs--number-lookup-how-to-md.0a825c89.js" defer></script>
  </body>
</html>
