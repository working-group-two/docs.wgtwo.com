(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{KHBt:function(e,t){e.exports={type:"image",mimeType:"image/png",src:"/assets/static/loopfork.59a4e54.08b11555ed649874268f5c046e921453.png",size:{width:1025,height:506},sizes:"(max-width: 1025px) 100vw, 1025px",srcset:["/assets/static/loopfork.82a2fbd.08b11555ed649874268f5c046e921453.png 480w","/assets/static/loopfork.59a4e54.08b11555ed649874268f5c046e921453.png 1025w"],dataUri:"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 1025 506' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-efdaaf8795dd41cfae677bbe1cf6aa29'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-efdaaf8795dd41cfae677bbe1cf6aa29)' width='1025' height='506' xlink:href='data:image/png%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAAgCAYAAACinX6EAAAACXBIWXMAAAsSAAALEgHS3X78AAAFM0lEQVRo3u2Zy05jRxCG%2bwGivFKkSLPJBCmbrCJlOcplkUijPECUZVZ5jrCMIjYjEALEZRHjGe7YGIwBY8zdNgabTn19XJ7mxMfug%2b3ZZFpqdZ9z2l1/V/1VXd029n9ezEcFeOXx8bHbDqr%2b%2bFGWD43BJAEYJdC0IMeJIT53TwY8PDzYy8tLe319ba%2burlyflnpzcxMssJfwQYvzx6rMOAZwtVqtVItPUoLxBeuHXC5ni8WiLZVK9uTkxJ6enrr%2b8fGx3drashcXF8%2bmdug45BUKBXt0dOQqGJBPf3d31x4eHj7LBRIZoB/a7bbd29vrDsjn83Z5ebmrcSzB91qt9sQq1Wq1y5i45RiblgE%2bBhS%2bsLBgz8/Puwzd2dmxt7e3XQzI7oeB9wMZoK1OXq/Xneb39/fdRM1m0x4cHDhLUO7v7x2YeOW9Vn4DcBQbEsB8BfC7RqPhWjCcnZ3Zu7s7hwnDxDHQx1BxDLwDP%2buJG6KnC6Bx6MdioRq0wyV4BgiTpikARgEhLqHvAasYkA0GsPCMcohFaYqyYGS7QL%2bClQCJlVjE7OysYxV94osCGaSEYQoKR2Eaz5aWluzq6qpTIDEEoyQygNanLH2f4lCqV%2bUbRelKwf8JaOqDWBYAg1wgjoGaBkOlUnELp%2bCGuC2YmJO6vb3txpuQgIQPUnGNfpUxUJPJiSEUFj41NdWNG8ypAS7E0jpGg1woBthXLpe7c0xPT9u1tbXuvLCxrwJUMIPQZprC1gkALA8NAc8cGktCFeCzkt/H40i/ggEwBFQHD8qBARiCurm56eYeqAAopf4SmmwAlOi9vr5uNzY2nEUAgGvQ6kLSKAAMSu/QhAd3gxEYQIMofTBoIDehETQUcNS2O1a4lMVr0vQoFjhBpa4fDQ13ATD42V9IJin8JRy6Z3A0GrpzRO8ZYkIm0gQkjc9ShATW360KBVJY%2b0RJoQzAaiEKSPpeqbRtZxlPxo1UAbqoq6uSbD%2b/SBz4Xnz%2bB/HBnyQg/WwXF7%2bWVPqVgPknlRLSKEC/NZstkf%2b7xJvvxH1eSwD8RtzxW8HyWrC9ku3wz/4u8BwFtNuRjxaLfwvdjeQDRgQb%2b/Zt1NZqRlhhZBv8rTPfwxgUECm1Wj0VHJ/Is5FgaCQeGVGAkcBsBCfvPnNsHJMC/nILZfp374zNZiMA9Xr0Lpf7NUgBz3EBVQDxplL51MnL543NZCIs5bLpvIspoNexVSvCQ87W77W/I1b%2bSqLuF0K/L6W%2bdG2pNCGCX0hEftMZ3wo642sQjO8CvTHoDnAnGH4UY7wQ2k90MLwU2RMSiz4XHH%2bEpcI86zaYJpcnAHIIJB/SynPnPOLtBGFBDAxJi036PTudL18xUKOd%2bLE3Azg56QGEhGZ%2bft4lD3pHoHtoEqCICcmV70nb4HsFNty%2brYexubk5l0cgn3xeM834EfspMwbhSHABLj1IXkgkyJ7IpEggyKlJIf0Uc9T3ef5xGNkoAvpjAFoOWuDRbFLPCyGu3AvDwAsRrM5pTrM34oGfGY7rUhQM2udANTMz484Cerjxb4SGwZF4JUbujUA9R9PHNXAJBTJOBSj19ZCj6TRV7wV6MWAk1%2bL4ODSj6uFB%2b/6WOO5rcYzgy1ZMuGBoVpiKAc9Jd4e5/h7XtfgH/WNET38%2bFYdRRloM/uVJHMNY/xob53XWsDjSYDDDCCUaE63ZNldWVv5zbzDuojsT8hcXF13V67bQy5OhFEAgymazLlGanJzsXlUPG5nT4iBYZjIZd%2b3V777xowv0KP8CWmZAGdPGLFcAAAAASUVORK5CYII=' /%3e%3c/svg%3e"}},UQSp:function(e,t,o){"use strict";t.a={name:"VueRemarkRoot",render:function(e){return e("div",null,this.$slots.default)}}},kaRs:function(e,t,o){"use strict";o.r(t);var r=o("7uw+"),a=o("UQSp"),i=o("Kw5r");function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}i.a.config.optionMergeStrategies;var n={VueRemarkRoot:a.a},l=function(e){var t=e.options.components=e.options.components||{},o=e.options.computed=e.options.computed||{};Object.keys(n).forEach((function(e){"object"===s(n[e])&&"function"==typeof n[e].render||"function"==typeof n[e]&&"function"==typeof n[e].options.render?t[e]=n[e]:o[e]=function(){return n[e]}}))},p=i.a.config.optionMergeStrategies,c="__vueRemarkFrontMatter",d={excerpt:null,title:"PBX/TAS integration",topic:"pbx",type:"how-to",roles:["THIRD_PARTY_DEVELOPER","OPERATOR"],sourceExamples:["examples/kotlin/thirdpartydev/sipbreakout/src/main/kotlin/com/wgtwo/examples/thirdpartydev/sipbreakout/sipbreakout.kt","examples/grpcurl/thirdpartydev/sipbreakout/register.sh"]};var u=function(e){e.options[c]&&(e.options[c]=d),i.a.util.defineReactive(e.options,c,d),e.options.computed=p.computed({$frontmatter:function(){return e.options[c]}},e.options.computed)},h=Object(r.a)({},(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("VueRemarkRoot",[r("h1",{attrs:{id:"plug-your-sip-enabled-pbx-or-tas-into-the-call-path"}},[r("a",{attrs:{href:"#plug-your-sip-enabled-pbx-or-tas-into-the-call-path","aria-hidden":"true"}},[e._v("#")]),e._v("Plug your SIP-enabled PBX or TAS into the call path")]),r("h2",{attrs:{id:"prerequisites"}},[r("a",{attrs:{href:"#prerequisites","aria-hidden":"true"}},[e._v("#")]),e._v("Prerequisites")]),r("ol",[r("li",[r("a",{attrs:{href:"/oauth-2-0/create-o-auth-2-0-client/"}},[e._v("An OAuth 2.0 client")])]),r("li",[r("a",{attrs:{href:"/oauth-2-0/get-user-access-token"}},[e._v("An access token")])])]),r("h2",{attrs:{id:"overview"}},[r("a",{attrs:{href:"#overview","aria-hidden":"true"}},[e._v("#")]),e._v("Overview")]),r("p",[e._v("This API enables PBX/TAS (Private Branch Exchange/Telephony Application Server) providers to plug their (SIP-enabled)\nendpoint into the call path.")]),r("p",[e._v("It enables a SIP integration between Working Group Two's core and a PBX/TAS for a given MSISDN.")]),r("p",[e._v("Virtual SIP Registrations are used to alter default call behavior and involve PBX/TAS into the SIP signaling path.\nThe registration created per single MSISDN linked to the OAuth 2.0 round trip.")]),r("p",[e._v("This API requires that you use the OAuth 2.0 Authorization Code Flow flow as shown in our "),r("a",{attrs:{href:"/oauth-2-0/get-user-access-token/"}},[e._v("docs")]),e._v(".")]),r("p",[e._v("To access this API, your credentials must include "),r("code",{pre:!0},[e._v("call.control.answer_and_initiate scope")]),e._v(".")]),r("h2",{attrs:{id:"the-api"}},[r("a",{attrs:{href:"#the-api","aria-hidden":"true"}},[e._v("#")]),e._v("The API")]),r("p",[e._v("The API is implemented as a gRPC service described below.")]),r("p",[e._v("There are two methods supported by this API:")]),r("ul",[r("li",[r("code",{pre:!0},[e._v("UpsertRegistration")])]),r("li",[r("code",{pre:!0},[e._v("DeleteRegistration")])])]),r("p",[e._v("To register a (PBX/TAS-bound) MSISDN with our core, use "),r("code",{pre:!0},[e._v("UpsertRegistration")]),e._v(".\nThe same method is used if you want to update an existing registration.")]),r("p",[e._v("Use "),r("code",{pre:!0},[e._v("DeleteRegistration")]),e._v(" when an existing registration is no longer needed.")]),r("h3",{attrs:{id:"messages"}},[r("a",{attrs:{href:"#messages","aria-hidden":"true"}},[e._v("#")]),e._v("Messages")]),r("p",[e._v("Both methods receive "),r("code",{pre:!0},[e._v("RegistrationRequest")]),e._v(" and return "),r("code",{pre:!0},[e._v("RegistrationResponse")]),e._v(" message.")]),r("ul",[r("li",[r("code",{pre:!0},[e._v("RegistrationRequest")]),e._v(" is a structure containing the URI of the endpoint you host + some additional details related to the connected MSISDN.")]),r("li",[r("code",{pre:!0},[e._v("RegistrationResponse")]),e._v(" is a simple structure conveying the status of method invocation (success/error)")])]),r("p",[e._v("You may find the proto definition of the service + the definition of the messages exchanged "),r("a",{attrs:{href:"/pbx/api-reference/"}},[e._v("here")]),e._v(".")]),r("h3",{attrs:{id:"registration-types"}},[r("a",{attrs:{href:"#registration-types","aria-hidden":"true"}},[e._v("#")]),e._v("Registration types")]),r("p",[e._v("There are three types of registrations: "),r("code",{pre:!0},[e._v("Fork")]),e._v(", "),r("code",{pre:!0},[e._v("Loop")]),e._v(" and "),r("code",{pre:!0},[e._v("Fallback")]),e._v(". It is the registration type that decides how the calls will be handled by our core.")]),r("h4",{attrs:{id:"forkloop"}},[r("a",{attrs:{href:"#forkloop","aria-hidden":"true"}},[e._v("#")]),e._v("Fork/Loop")]),r("p",[e._v("If a registration of one of these types is registered on an MSISDN, all the SIP signalling from/to that MSISDN will be replicated to the endpoint specified in the registration.")]),r("g-image",{staticClass:"desktop-frame",attrs:{src:o("KHBt"),alt:"Loop vs Fork"}}),r("ul",[r("li",[r("p",[r("strong",[e._v("Loop")]),e._v(": leg 4 is created only after the call comes back as leg 3")]),r("blockquote",[r("p",[e._v("Please note that PBX/TAS is not obliged to create leg 3 as it can answer or reject leg 2 directly.")])])]),r("li",[r("p",[r("strong",[e._v("Fork")]),e._v(": legs 2 and 3 are created simultaneously.")]),r("blockquote",[r("p",[e._v("Typically, you use "),r("code",{pre:!0},[e._v("Fork/Loop")]),e._v(" to implement your logic during a call.")])])])]),r("h4",{attrs:{id:"fallback"}},[r("a",{attrs:{href:"#fallback","aria-hidden":"true"}},[e._v("#")]),e._v("Fallback")]),r("p",[e._v("The core will action upon a "),r("code",{pre:!0},[e._v("Fallback")]),e._v(" registration if and only if:")]),r("ul",[r("li",[e._v("somebody calls the related MSISDN")]),r("li",[e._v("the MSISDN is either busy or no answer detected within the timeout (30s)  ")])]),r("p",[e._v("In such case, the core will replicate the INVITE to the endpoint specified during the registration.")]),r("blockquote",[r("p",[e._v("Typically, you use "),r("code",{pre:!0},[e._v("Fallback")]),e._v(" to implement the likes of voice mail, call forwarding etc.  ")])]),r("h3",{attrs:{id:"example-code"}},[r("a",{attrs:{href:"#example-code","aria-hidden":"true"}},[e._v("#")]),e._v("Example code")]),r("p",[e._v("The examples below demonstrate how to consume this API.")]),r("p",[e._v("For Java example, click "),r("a",{attrs:{href:"https://github.com/working-group-two/docs.wgtwo.com/blob/master/examples/kotlin/thirdpartydev/sipbreakout/src/main/kotlin/com/wgtwo/examples/thirdpartydev/sipbreakout/SipBreakout.java",target:"_blank",rel:"nofollow noopener noreferrer"}},[e._v("here")]),e._v(".")]),r("CodeSnippet",{attrs:{grpcurl:e.$sourceExamplesMap["examples/grpcurl/thirdpartydev/sipbreakout/register.sh"],kotlin:e.$sourceExamplesMap["examples/kotlin/thirdpartydev/sipbreakout/src/main/kotlin/com/wgtwo/examples/thirdpartydev/sipbreakout/sipbreakout.kt"]}}),r("h2",{attrs:{id:"concepts"}},[r("a",{attrs:{href:"#concepts","aria-hidden":"true"}},[e._v("#")]),e._v("Concepts")]),r("ul",[r("li",[r("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/WebRTC_API/Signaling_and_video_calling",target:"_blank",rel:"nofollow noopener noreferrer"}},[e._v("WebRTC basics")])]),r("li",[r("a",{attrs:{href:"https://grpc.io/docs/guides/concepts/",target:"_blank",rel:"nofollow noopener noreferrer"}},[e._v("gRPC concepts")])]),r("li",[r("a",{attrs:{href:"https://grpc.io/docs/languages/kotlin/basics/",target:"_blank",rel:"nofollow noopener noreferrer"}},[e._v("Kotlin gRPC tutorial")])]),r("li",[r("a",{attrs:{href:"https://grpc.io/docs/reference/java/generated-code/",target:"_blank",rel:"nofollow noopener noreferrer"}},[e._v("Java gRPC stubs")])])])],1)}),[],!1,null,null,null);"function"==typeof l&&l(h),"function"==typeof u&&u(h);t.default=h.exports}}]);